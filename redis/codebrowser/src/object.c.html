<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>object.c source code [codebrowser/src/object.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/src/object.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>codebrowser</a>/<a href='./'>src</a>/<a href='object.c.html'>object.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/* Redis Object implementation.</i></td></tr>
<tr><th id="2">2</th><td><i> *</i></td></tr>
<tr><th id="3">3</th><td><i> * Copyright (c) 2009-2012, Salvatore Sanfilippo &lt;antirez at gmail dot com&gt;</i></td></tr>
<tr><th id="4">4</th><td><i> * All rights reserved.</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * Redistribution and use in source and binary forms, with or without</i></td></tr>
<tr><th id="7">7</th><td><i> * modification, are permitted provided that the following conditions are met:</i></td></tr>
<tr><th id="8">8</th><td><i> *</i></td></tr>
<tr><th id="9">9</th><td><i> *   * Redistributions of source code must retain the above copyright notice,</i></td></tr>
<tr><th id="10">10</th><td><i> *     this list of conditions and the following disclaimer.</i></td></tr>
<tr><th id="11">11</th><td><i> *   * Redistributions in binary form must reproduce the above copyright</i></td></tr>
<tr><th id="12">12</th><td><i> *     notice, this list of conditions and the following disclaimer in the</i></td></tr>
<tr><th id="13">13</th><td><i> *     documentation and/or other materials provided with the distribution.</i></td></tr>
<tr><th id="14">14</th><td><i> *   * Neither the name of Redis nor the names of its contributors may be used</i></td></tr>
<tr><th id="15">15</th><td><i> *     to endorse or promote products derived from this software without</i></td></tr>
<tr><th id="16">16</th><td><i> *     specific prior written permission.</i></td></tr>
<tr><th id="17">17</th><td><i> *</i></td></tr>
<tr><th id="18">18</th><td><i> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</i></td></tr>
<tr><th id="19">19</th><td><i> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</i></td></tr>
<tr><th id="20">20</th><td><i> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</i></td></tr>
<tr><th id="21">21</th><td><i> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</i></td></tr>
<tr><th id="22">22</th><td><i> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</i></td></tr>
<tr><th id="23">23</th><td><i> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</i></td></tr>
<tr><th id="24">24</th><td><i> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</i></td></tr>
<tr><th id="25">25</th><td><i> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</i></td></tr>
<tr><th id="26">26</th><td><i> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</i></td></tr>
<tr><th id="27">27</th><td><i> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</i></td></tr>
<tr><th id="28">28</th><td><i> * POSSIBILITY OF SUCH DAMAGE.</i></td></tr>
<tr><th id="29">29</th><td><i> */</i></td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="server.h.html">"server.h"</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../../include/math.h.html">&lt;math.h&gt;</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../include/ctype.h.html">&lt;ctype.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td></td></tr>
<tr><th id="35">35</th><td><u>#<span data-ppcond="35">ifdef</span> <span class="macro" data-ref="_M/__CYGWIN__">__CYGWIN__</span></u></td></tr>
<tr><th id="36">36</th><td><u>#define strtold(a,b) ((long double)strtod((a),(b)))</u></td></tr>
<tr><th id="37">37</th><td><u>#<span data-ppcond="35">endif</span></u></td></tr>
<tr><th id="38">38</th><td></td></tr>
<tr><th id="39">39</th><td><i>/* ===================== Creation and parsing of objects ==================== */</i></td></tr>
<tr><th id="40">40</th><td></td></tr>
<tr><th id="41">41</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createObject" title='createObject' data-ref="createObject">createObject</dfn>(<em>int</em> <dfn class="local col1 decl" id="1type" title='type' data-type='int' data-ref="1type">type</dfn>, <em>void</em> *<dfn class="local col2 decl" id="2ptr" title='ptr' data-type='void *' data-ref="2ptr">ptr</dfn>) {</td></tr>
<tr><th id="42">42</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col3 decl" id="3o" title='o' data-type='robj *' data-ref="3o">o</dfn> = <a class="ref" href="zmalloc.h.html#zmalloc" title='zmalloc' data-ref="zmalloc">zmalloc</a>(<b>sizeof</b>(*<a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>));</td></tr>
<tr><th id="43">43</th><td>    <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> = <a class="local col1 ref" href="#1type" title='type' data-ref="1type">type</a>;</td></tr>
<tr><th id="44">44</th><td>    <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a>;</td></tr>
<tr><th id="45">45</th><td>    <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> = <a class="local col2 ref" href="#2ptr" title='ptr' data-ref="2ptr">ptr</a>;</td></tr>
<tr><th id="46">46</th><td>    <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> = <var>1</var>;</td></tr>
<tr><th id="47">47</th><td></td></tr>
<tr><th id="48">48</th><td>    <i>/* Set the LRU to the current lruclock (minutes resolution), or</i></td></tr>
<tr><th id="49">49</th><td><i>     * alternatively the LFU counter. */</i></td></tr>
<tr><th id="50">50</th><td>    <b>if</b> (<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::maxmemory_policy" title='redisServer::maxmemory_policy' data-ref="redisServer::maxmemory_policy">maxmemory_policy</a> &amp; <a class="macro" href="server.h.html#367" title="(1&lt;&lt;1)" data-ref="_M/MAXMEMORY_FLAG_LFU">MAXMEMORY_FLAG_LFU</a>) {</td></tr>
<tr><th id="51">51</th><td>        <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::lru" title='redisObject::lru' data-ref="redisObject::lru">lru</a> = (<a class="ref" href="server.h.html#LFUGetTimeInMinutes" title='LFUGetTimeInMinutes' data-ref="LFUGetTimeInMinutes">LFUGetTimeInMinutes</a>()&lt;&lt;<var>8</var>) | <a class="macro" href="server.h.html#1802" title="5" data-ref="_M/LFU_INIT_VAL">LFU_INIT_VAL</a>;</td></tr>
<tr><th id="52">52</th><td>    } <b>else</b> {</td></tr>
<tr><th id="53">53</th><td>        <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::lru" title='redisObject::lru' data-ref="redisObject::lru">lru</a> = <a class="ref" href="server.h.html#LRU_CLOCK" title='LRU_CLOCK' data-ref="LRU_CLOCK">LRU_CLOCK</a>();</td></tr>
<tr><th id="54">54</th><td>    }</td></tr>
<tr><th id="55">55</th><td>    <b>return</b> <a class="local col3 ref" href="#3o" title='o' data-ref="3o">o</a>;</td></tr>
<tr><th id="56">56</th><td>}</td></tr>
<tr><th id="57">57</th><td></td></tr>
<tr><th id="58">58</th><td><i>/* Set a special refcount in the object to make it "shared":</i></td></tr>
<tr><th id="59">59</th><td><i> * incrRefCount and decrRefCount() will test for this special refcount</i></td></tr>
<tr><th id="60">60</th><td><i> * and will not touch the object. This way it is free to access shared</i></td></tr>
<tr><th id="61">61</th><td><i> * objects such as small integers from different threads without any</i></td></tr>
<tr><th id="62">62</th><td><i> * mutex.</i></td></tr>
<tr><th id="63">63</th><td><i> *</i></td></tr>
<tr><th id="64">64</th><td><i> * A common patter to create shared objects:</i></td></tr>
<tr><th id="65">65</th><td><i> *</i></td></tr>
<tr><th id="66">66</th><td><i> * robj *myobject = makeObjectShared(createObject(...));</i></td></tr>
<tr><th id="67">67</th><td><i> *</i></td></tr>
<tr><th id="68">68</th><td><i> */</i></td></tr>
<tr><th id="69">69</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="makeObjectShared" title='makeObjectShared' data-ref="makeObjectShared">makeObjectShared</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col4 decl" id="4o" title='o' data-type='robj *' data-ref="4o">o</dfn>) {</td></tr>
<tr><th id="70">70</th><td>    <a class="macro" href="server.h.html#439" title="((o-&gt;refcount == 1)?(void)0 : (_serverAssert(&quot;o-&gt;refcount == 1&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,70),_exit(1)))" data-ref="_M/serverAssert">serverAssert</a>(<a class="local col4 ref" href="#4o" title='o' data-ref="4o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> == <var>1</var>);</td></tr>
<tr><th id="71">71</th><td>    <a class="local col4 ref" href="#4o" title='o' data-ref="4o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> = <a class="macro" href="server.h.html#583" title="2147483647" data-ref="_M/OBJ_SHARED_REFCOUNT">OBJ_SHARED_REFCOUNT</a>;</td></tr>
<tr><th id="72">72</th><td>    <b>return</b> <a class="local col4 ref" href="#4o" title='o' data-ref="4o">o</a>;</td></tr>
<tr><th id="73">73</th><td>}</td></tr>
<tr><th id="74">74</th><td></td></tr>
<tr><th id="75">75</th><td><i>/* Create a string object with encoding OBJ_ENCODING_RAW, that is a plain</i></td></tr>
<tr><th id="76">76</th><td><i> * string object where o-&gt;ptr points to a proper sds string. */</i></td></tr>
<tr><th id="77">77</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createRawStringObject" title='createRawStringObject' data-ref="createRawStringObject">createRawStringObject</dfn>(<em>const</em> <em>char</em> *<dfn class="local col5 decl" id="5ptr" title='ptr' data-type='const char *' data-ref="5ptr">ptr</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col6 decl" id="6len" title='len' data-type='size_t' data-ref="6len">len</dfn>) {</td></tr>
<tr><th id="78">78</th><td>    <b>return</b> <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>, <a class="ref" href="sds.h.html#sdsnewlen" title='sdsnewlen' data-ref="sdsnewlen">sdsnewlen</a>(<a class="local col5 ref" href="#5ptr" title='ptr' data-ref="5ptr">ptr</a>,<a class="local col6 ref" href="#6len" title='len' data-ref="6len">len</a>));</td></tr>
<tr><th id="79">79</th><td>}</td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><i>/* Create a string object with encoding OBJ_ENCODING_EMBSTR, that is</i></td></tr>
<tr><th id="82">82</th><td><i> * an object where the sds string is actually an unmodifiable string</i></td></tr>
<tr><th id="83">83</th><td><i> * allocated in the same chunk as the object itself. */</i></td></tr>
<tr><th id="84">84</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createEmbeddedStringObject" title='createEmbeddedStringObject' data-ref="createEmbeddedStringObject">createEmbeddedStringObject</dfn>(<em>const</em> <em>char</em> *<dfn class="local col7 decl" id="7ptr" title='ptr' data-type='const char *' data-ref="7ptr">ptr</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col8 decl" id="8len" title='len' data-type='size_t' data-ref="8len">len</dfn>) {</td></tr>
<tr><th id="85">85</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col9 decl" id="9o" title='o' data-type='robj *' data-ref="9o">o</dfn> = <a class="ref" href="zmalloc.h.html#zmalloc" title='zmalloc' data-ref="zmalloc">zmalloc</a>(<b>sizeof</b>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a>)+<b>sizeof</b>(<b>struct</b> <a class="type" href="sds.h.html#sdshdr8" title='sdshdr8' data-ref="sdshdr8">sdshdr8</a>)+<a class="local col8 ref" href="#8len" title='len' data-ref="8len">len</a>+<var>1</var>);</td></tr>
<tr><th id="86">86</th><td>    <b>struct</b> <a class="type" href="sds.h.html#sdshdr8" title='sdshdr8' data-ref="sdshdr8">sdshdr8</a> *<dfn class="local col0 decl" id="10sh" title='sh' data-type='struct sdshdr8 *' data-ref="10sh">sh</dfn> = (<em>void</em>*)(<a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>+<var>1</var>);</td></tr>
<tr><th id="87">87</th><td></td></tr>
<tr><th id="88">88</th><td>    <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> = <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>;</td></tr>
<tr><th id="89">89</th><td>    <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#576" title="8" data-ref="_M/OBJ_ENCODING_EMBSTR">OBJ_ENCODING_EMBSTR</a>;</td></tr>
<tr><th id="90">90</th><td>    <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> = <a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>+<var>1</var>;</td></tr>
<tr><th id="91">91</th><td>    <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> = <var>1</var>;</td></tr>
<tr><th id="92">92</th><td>    <b>if</b> (<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::maxmemory_policy" title='redisServer::maxmemory_policy' data-ref="redisServer::maxmemory_policy">maxmemory_policy</a> &amp; <a class="macro" href="server.h.html#367" title="(1&lt;&lt;1)" data-ref="_M/MAXMEMORY_FLAG_LFU">MAXMEMORY_FLAG_LFU</a>) {</td></tr>
<tr><th id="93">93</th><td>        <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::lru" title='redisObject::lru' data-ref="redisObject::lru">lru</a> = (<a class="ref" href="server.h.html#LFUGetTimeInMinutes" title='LFUGetTimeInMinutes' data-ref="LFUGetTimeInMinutes">LFUGetTimeInMinutes</a>()&lt;&lt;<var>8</var>) | <a class="macro" href="server.h.html#1802" title="5" data-ref="_M/LFU_INIT_VAL">LFU_INIT_VAL</a>;</td></tr>
<tr><th id="94">94</th><td>    } <b>else</b> {</td></tr>
<tr><th id="95">95</th><td>        <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::lru" title='redisObject::lru' data-ref="redisObject::lru">lru</a> = <a class="ref" href="server.h.html#LRU_CLOCK" title='LRU_CLOCK' data-ref="LRU_CLOCK">LRU_CLOCK</a>();</td></tr>
<tr><th id="96">96</th><td>    }</td></tr>
<tr><th id="97">97</th><td></td></tr>
<tr><th id="98">98</th><td>    <a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>-&gt;<a class="ref" href="sds.h.html#sdshdr8::len" title='sdshdr8::len' data-ref="sdshdr8::len">len</a> = <a class="local col8 ref" href="#8len" title='len' data-ref="8len">len</a>;</td></tr>
<tr><th id="99">99</th><td>    <a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>-&gt;<a class="ref" href="sds.h.html#sdshdr8::alloc" title='sdshdr8::alloc' data-ref="sdshdr8::alloc">alloc</a> = <a class="local col8 ref" href="#8len" title='len' data-ref="8len">len</a>;</td></tr>
<tr><th id="100">100</th><td>    <a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>-&gt;<a class="ref" href="sds.h.html#sdshdr8::flags" title='sdshdr8::flags' data-ref="sdshdr8::flags">flags</a> = <a class="macro" href="sds.h.html#76" title="1" data-ref="_M/SDS_TYPE_8">SDS_TYPE_8</a>;</td></tr>
<tr><th id="101">101</th><td>    <b>if</b> (<a class="local col7 ref" href="#7ptr" title='ptr' data-ref="7ptr">ptr</a>) {</td></tr>
<tr><th id="102">102</th><td>        <a class="ref" href="../../include/string.h.html#memcpy" title='memcpy' data-ref="memcpy">memcpy</a>(<a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>-&gt;<a class="ref" href="sds.h.html#sdshdr8::buf" title='sdshdr8::buf' data-ref="sdshdr8::buf">buf</a>,<a class="local col7 ref" href="#7ptr" title='ptr' data-ref="7ptr">ptr</a>,<a class="local col8 ref" href="#8len" title='len' data-ref="8len">len</a>);</td></tr>
<tr><th id="103">103</th><td>        <a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>-&gt;<a class="ref" href="sds.h.html#sdshdr8::buf" title='sdshdr8::buf' data-ref="sdshdr8::buf">buf</a>[<a class="local col8 ref" href="#8len" title='len' data-ref="8len">len</a>] = <kbd>'\0'</kbd>;</td></tr>
<tr><th id="104">104</th><td>    } <b>else</b> {</td></tr>
<tr><th id="105">105</th><td>        <a class="ref" href="../../include/string.h.html#memset" title='memset' data-ref="memset">memset</a>(<a class="local col0 ref" href="#10sh" title='sh' data-ref="10sh">sh</a>-&gt;<a class="ref" href="sds.h.html#sdshdr8::buf" title='sdshdr8::buf' data-ref="sdshdr8::buf">buf</a>,<var>0</var>,<a class="local col8 ref" href="#8len" title='len' data-ref="8len">len</a>+<var>1</var>);</td></tr>
<tr><th id="106">106</th><td>    }</td></tr>
<tr><th id="107">107</th><td>    <b>return</b> <a class="local col9 ref" href="#9o" title='o' data-ref="9o">o</a>;</td></tr>
<tr><th id="108">108</th><td>}</td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td><i>/* Create a string object with EMBSTR encoding if it is smaller than</i></td></tr>
<tr><th id="111">111</th><td><i> * OBJ_ENCODING_EMBSTR_SIZE_LIMIT, otherwise the RAW encoding is</i></td></tr>
<tr><th id="112">112</th><td><i> * used.</i></td></tr>
<tr><th id="113">113</th><td><i> *</i></td></tr>
<tr><th id="114">114</th><td><i> * The current limit of 39 is chosen so that the biggest string object</i></td></tr>
<tr><th id="115">115</th><td><i> * we allocate as EMBSTR will still fit into the 64 byte arena of jemalloc. */</i></td></tr>
<tr><th id="116">116</th><td><u>#define <dfn class="macro" id="_M/OBJ_ENCODING_EMBSTR_SIZE_LIMIT" data-ref="_M/OBJ_ENCODING_EMBSTR_SIZE_LIMIT">OBJ_ENCODING_EMBSTR_SIZE_LIMIT</dfn> 44</u></td></tr>
<tr><th id="117">117</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createStringObject" title='createStringObject' data-ref="createStringObject">createStringObject</dfn>(<em>const</em> <em>char</em> *<dfn class="local col1 decl" id="11ptr" title='ptr' data-type='const char *' data-ref="11ptr">ptr</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col2 decl" id="12len" title='len' data-type='size_t' data-ref="12len">len</dfn>) {</td></tr>
<tr><th id="118">118</th><td>    <b>if</b> (<a class="local col2 ref" href="#12len" title='len' data-ref="12len">len</a> &lt;= <a class="macro" href="#116" title="44" data-ref="_M/OBJ_ENCODING_EMBSTR_SIZE_LIMIT">OBJ_ENCODING_EMBSTR_SIZE_LIMIT</a>)</td></tr>
<tr><th id="119">119</th><td>        <b>return</b> <a class="ref" href="#createEmbeddedStringObject" title='createEmbeddedStringObject' data-ref="createEmbeddedStringObject">createEmbeddedStringObject</a>(<a class="local col1 ref" href="#11ptr" title='ptr' data-ref="11ptr">ptr</a>,<a class="local col2 ref" href="#12len" title='len' data-ref="12len">len</a>);</td></tr>
<tr><th id="120">120</th><td>    <b>else</b></td></tr>
<tr><th id="121">121</th><td>        <b>return</b> <a class="ref" href="#createRawStringObject" title='createRawStringObject' data-ref="createRawStringObject">createRawStringObject</a>(<a class="local col1 ref" href="#11ptr" title='ptr' data-ref="11ptr">ptr</a>,<a class="local col2 ref" href="#12len" title='len' data-ref="12len">len</a>);</td></tr>
<tr><th id="122">122</th><td>}</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createStringObjectFromLongLong" title='createStringObjectFromLongLong' data-ref="createStringObjectFromLongLong">createStringObjectFromLongLong</dfn>(<em>long</em> <em>long</em> <dfn class="local col3 decl" id="13value" title='value' data-type='long long' data-ref="13value">value</dfn>) {</td></tr>
<tr><th id="125">125</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col4 decl" id="14o" title='o' data-type='robj *' data-ref="14o">o</dfn>;</td></tr>
<tr><th id="126">126</th><td>    <b>if</b> (<a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a> &gt;= <var>0</var> &amp;&amp; <a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a> &lt; <a class="macro" href="server.h.html#92" title="10000" data-ref="_M/OBJ_SHARED_INTEGERS">OBJ_SHARED_INTEGERS</a>) {</td></tr>
<tr><th id="127">127</th><td>        <a class="ref" href="#incrRefCount" title='incrRefCount' data-ref="incrRefCount">incrRefCount</a>(<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::integers" title='sharedObjectsStruct::integers' data-ref="sharedObjectsStruct::integers">integers</a>[<a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a>]);</td></tr>
<tr><th id="128">128</th><td>        <a class="local col4 ref" href="#14o" title='o' data-ref="14o">o</a> = <a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::integers" title='sharedObjectsStruct::integers' data-ref="sharedObjectsStruct::integers">integers</a>[<a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a>];</td></tr>
<tr><th id="129">129</th><td>    } <b>else</b> {</td></tr>
<tr><th id="130">130</th><td>        <b>if</b> (<a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a> &gt;= <span class="macro" title="(-9223372036854775807L -1L)" data-ref="_M/LONG_MIN">LONG_MIN</span> &amp;&amp; <a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a> &lt;= <span class="macro" title="9223372036854775807L" data-ref="_M/LONG_MAX">LONG_MAX</span>) {</td></tr>
<tr><th id="131">131</th><td>            <a class="local col4 ref" href="#14o" title='o' data-ref="14o">o</a> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="132">132</th><td>            <a class="local col4 ref" href="#14o" title='o' data-ref="14o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>;</td></tr>
<tr><th id="133">133</th><td>            <a class="local col4 ref" href="#14o" title='o' data-ref="14o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> = (<em>void</em>*)((<em>long</em>)<a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a>);</td></tr>
<tr><th id="134">134</th><td>        } <b>else</b> {</td></tr>
<tr><th id="135">135</th><td>            <a class="local col4 ref" href="#14o" title='o' data-ref="14o">o</a> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>,<a class="ref" href="sds.h.html#sdsfromlonglong" title='sdsfromlonglong' data-ref="sdsfromlonglong">sdsfromlonglong</a>(<a class="local col3 ref" href="#13value" title='value' data-ref="13value">value</a>));</td></tr>
<tr><th id="136">136</th><td>        }</td></tr>
<tr><th id="137">137</th><td>    }</td></tr>
<tr><th id="138">138</th><td>    <b>return</b> <a class="local col4 ref" href="#14o" title='o' data-ref="14o">o</a>;</td></tr>
<tr><th id="139">139</th><td>}</td></tr>
<tr><th id="140">140</th><td></td></tr>
<tr><th id="141">141</th><td><i>/* Create a string object from a long double. If humanfriendly is non-zero</i></td></tr>
<tr><th id="142">142</th><td><i> * it does not use exponential format and trims trailing zeroes at the end,</i></td></tr>
<tr><th id="143">143</th><td><i> * however this results in loss of precision. Otherwise exp format is used</i></td></tr>
<tr><th id="144">144</th><td><i> * and the output of snprintf() is not modified.</i></td></tr>
<tr><th id="145">145</th><td><i> *</i></td></tr>
<tr><th id="146">146</th><td><i> * The 'humanfriendly' option is used for INCRBYFLOAT and HINCRBYFLOAT. */</i></td></tr>
<tr><th id="147">147</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createStringObjectFromLongDouble" title='createStringObjectFromLongDouble' data-ref="createStringObjectFromLongDouble">createStringObjectFromLongDouble</dfn>(<em>long</em> <em>double</em> <dfn class="local col5 decl" id="15value" title='value' data-type='long double' data-ref="15value">value</dfn>, <em>int</em> <dfn class="local col6 decl" id="16humanfriendly" title='humanfriendly' data-type='int' data-ref="16humanfriendly">humanfriendly</dfn>) {</td></tr>
<tr><th id="148">148</th><td>    <em>char</em> <dfn class="local col7 decl" id="17buf" title='buf' data-type='char [256]' data-ref="17buf">buf</dfn>[<var>256</var>];</td></tr>
<tr><th id="149">149</th><td>    <em>int</em> <dfn class="local col8 decl" id="18len" title='len' data-type='int' data-ref="18len">len</dfn> = <a class="ref" href="util.h.html#ld2string" title='ld2string' data-ref="ld2string">ld2string</a>(<a class="local col7 ref" href="#17buf" title='buf' data-ref="17buf">buf</a>,<b>sizeof</b>(<a class="local col7 ref" href="#17buf" title='buf' data-ref="17buf">buf</a>),<a class="local col5 ref" href="#15value" title='value' data-ref="15value">value</a>,<a class="local col6 ref" href="#16humanfriendly" title='humanfriendly' data-ref="16humanfriendly">humanfriendly</a>);</td></tr>
<tr><th id="150">150</th><td>    <b>return</b> <a class="ref" href="#createStringObject" title='createStringObject' data-ref="createStringObject">createStringObject</a>(<a class="local col7 ref" href="#17buf" title='buf' data-ref="17buf">buf</a>,<a class="local col8 ref" href="#18len" title='len' data-ref="18len">len</a>);</td></tr>
<tr><th id="151">151</th><td>}</td></tr>
<tr><th id="152">152</th><td></td></tr>
<tr><th id="153">153</th><td><i>/* Duplicate a string object, with the guarantee that the returned object</i></td></tr>
<tr><th id="154">154</th><td><i> * has the same encoding as the original one.</i></td></tr>
<tr><th id="155">155</th><td><i> *</i></td></tr>
<tr><th id="156">156</th><td><i> * This function also guarantees that duplicating a small integere object</i></td></tr>
<tr><th id="157">157</th><td><i> * (or a string object that contains a representation of a small integer)</i></td></tr>
<tr><th id="158">158</th><td><i> * will always result in a fresh object that is unshared (refcount == 1).</i></td></tr>
<tr><th id="159">159</th><td><i> *</i></td></tr>
<tr><th id="160">160</th><td><i> * The resulting object always has refcount set to 1. */</i></td></tr>
<tr><th id="161">161</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="dupStringObject" title='dupStringObject' data-ref="dupStringObject">dupStringObject</dfn>(<em>const</em> <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col9 decl" id="19o" title='o' data-type='const robj *' data-ref="19o">o</dfn>) {</td></tr>
<tr><th id="162">162</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col0 decl" id="20d" title='d' data-type='robj *' data-ref="20d">d</dfn>;</td></tr>
<tr><th id="163">163</th><td></td></tr>
<tr><th id="164">164</th><td>    <a class="macro" href="server.h.html#439" title="((o-&gt;type == 0)?(void)0 : (_serverAssert(&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,164),_exit(1)))" data-ref="_M/serverAssert">serverAssert</a>(<a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="165">165</th><td></td></tr>
<tr><th id="166">166</th><td>    <b>switch</b>(<a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a>) {</td></tr>
<tr><th id="167">167</th><td>    <b>case</b> <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a>:</td></tr>
<tr><th id="168">168</th><td>        <b>return</b> <a class="ref" href="#createRawStringObject" title='createRawStringObject' data-ref="createRawStringObject">createRawStringObject</a>(<a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>));</td></tr>
<tr><th id="169">169</th><td>    <b>case</b> <a class="macro" href="server.h.html#576" title="8" data-ref="_M/OBJ_ENCODING_EMBSTR">OBJ_ENCODING_EMBSTR</a>:</td></tr>
<tr><th id="170">170</th><td>        <b>return</b> <a class="ref" href="#createEmbeddedStringObject" title='createEmbeddedStringObject' data-ref="createEmbeddedStringObject">createEmbeddedStringObject</a>(<a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>));</td></tr>
<tr><th id="171">171</th><td>    <b>case</b> <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>:</td></tr>
<tr><th id="172">172</th><td>        <a class="local col0 ref" href="#20d" title='d' data-ref="20d">d</a> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="173">173</th><td>        <a class="local col0 ref" href="#20d" title='d' data-ref="20d">d</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>;</td></tr>
<tr><th id="174">174</th><td>        <a class="local col0 ref" href="#20d" title='d' data-ref="20d">d</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> = <a class="local col9 ref" href="#19o" title='o' data-ref="19o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="175">175</th><td>        <b>return</b> <a class="local col0 ref" href="#20d" title='d' data-ref="20d">d</a>;</td></tr>
<tr><th id="176">176</th><td>    <b>default</b>:</td></tr>
<tr><th id="177">177</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,177,&quot;Wrong encoding.&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Wrong encoding."</q>);</td></tr>
<tr><th id="178">178</th><td>        <b>break</b>;</td></tr>
<tr><th id="179">179</th><td>    }</td></tr>
<tr><th id="180">180</th><td>}</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createQuicklistObject" title='createQuicklistObject' data-ref="createQuicklistObject">createQuicklistObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="183">183</th><td>    <a class="typedef" href="quicklist.h.html#quicklist" title='quicklist' data-type='struct quicklist' data-ref="quicklist">quicklist</a> *<dfn class="local col1 decl" id="21l" title='l' data-type='quicklist *' data-ref="21l">l</dfn> = <a class="ref" href="quicklist.h.html#quicklistCreate" title='quicklistCreate' data-ref="quicklistCreate">quicklistCreate</a>();</td></tr>
<tr><th id="184">184</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col2 decl" id="22o" title='o' data-type='robj *' data-ref="22o">o</dfn> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#450" title="1" data-ref="_M/OBJ_LIST">OBJ_LIST</a>,<a class="local col1 ref" href="#21l" title='l' data-ref="21l">l</a>);</td></tr>
<tr><th id="185">185</th><td>    <a class="local col2 ref" href="#22o" title='o' data-ref="22o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#577" title="9" data-ref="_M/OBJ_ENCODING_QUICKLIST">OBJ_ENCODING_QUICKLIST</a>;</td></tr>
<tr><th id="186">186</th><td>    <b>return</b> <a class="local col2 ref" href="#22o" title='o' data-ref="22o">o</a>;</td></tr>
<tr><th id="187">187</th><td>}</td></tr>
<tr><th id="188">188</th><td></td></tr>
<tr><th id="189">189</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createZiplistObject" title='createZiplistObject' data-ref="createZiplistObject">createZiplistObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="190">190</th><td>    <em>unsigned</em> <em>char</em> *<dfn class="local col3 decl" id="23zl" title='zl' data-type='unsigned char *' data-ref="23zl">zl</dfn> = <a class="ref" href="ziplist.h.html#ziplistNew" title='ziplistNew' data-ref="ziplistNew">ziplistNew</a>();</td></tr>
<tr><th id="191">191</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col4 decl" id="24o" title='o' data-type='robj *' data-ref="24o">o</dfn> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#450" title="1" data-ref="_M/OBJ_LIST">OBJ_LIST</a>,<a class="local col3 ref" href="#23zl" title='zl' data-ref="23zl">zl</a>);</td></tr>
<tr><th id="192">192</th><td>    <a class="local col4 ref" href="#24o" title='o' data-ref="24o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>;</td></tr>
<tr><th id="193">193</th><td>    <b>return</b> <a class="local col4 ref" href="#24o" title='o' data-ref="24o">o</a>;</td></tr>
<tr><th id="194">194</th><td>}</td></tr>
<tr><th id="195">195</th><td></td></tr>
<tr><th id="196">196</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createSetObject" title='createSetObject' data-ref="createSetObject">createSetObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="197">197</th><td>    <a class="typedef" href="dict.h.html#dict" title='dict' data-type='struct dict' data-ref="dict">dict</a> *<dfn class="local col5 decl" id="25d" title='d' data-type='dict *' data-ref="25d">d</dfn> = <a class="ref" href="dict.h.html#dictCreate" title='dictCreate' data-ref="dictCreate">dictCreate</a>(&amp;<a class="ref" href="server.h.html#setDictType" title='setDictType' data-ref="setDictType">setDictType</a>,<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="198">198</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col6 decl" id="26o" title='o' data-type='robj *' data-ref="26o">o</dfn> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#451" title="2" data-ref="_M/OBJ_SET">OBJ_SET</a>,<a class="local col5 ref" href="#25d" title='d' data-ref="25d">d</a>);</td></tr>
<tr><th id="199">199</th><td>    <a class="local col6 ref" href="#26o" title='o' data-ref="26o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#570" title="2" data-ref="_M/OBJ_ENCODING_HT">OBJ_ENCODING_HT</a>;</td></tr>
<tr><th id="200">200</th><td>    <b>return</b> <a class="local col6 ref" href="#26o" title='o' data-ref="26o">o</a>;</td></tr>
<tr><th id="201">201</th><td>}</td></tr>
<tr><th id="202">202</th><td></td></tr>
<tr><th id="203">203</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createIntsetObject" title='createIntsetObject' data-ref="createIntsetObject">createIntsetObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="204">204</th><td>    <a class="typedef" href="intset.h.html#intset" title='intset' data-type='struct intset' data-ref="intset">intset</a> *<dfn class="local col7 decl" id="27is" title='is' data-type='intset *' data-ref="27is">is</dfn> = <a class="ref" href="intset.h.html#intsetNew" title='intsetNew' data-ref="intsetNew">intsetNew</a>();</td></tr>
<tr><th id="205">205</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col8 decl" id="28o" title='o' data-type='robj *' data-ref="28o">o</dfn> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#451" title="2" data-ref="_M/OBJ_SET">OBJ_SET</a>,<a class="local col7 ref" href="#27is" title='is' data-ref="27is">is</a>);</td></tr>
<tr><th id="206">206</th><td>    <a class="local col8 ref" href="#28o" title='o' data-ref="28o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#574" title="6" data-ref="_M/OBJ_ENCODING_INTSET">OBJ_ENCODING_INTSET</a>;</td></tr>
<tr><th id="207">207</th><td>    <b>return</b> <a class="local col8 ref" href="#28o" title='o' data-ref="28o">o</a>;</td></tr>
<tr><th id="208">208</th><td>}</td></tr>
<tr><th id="209">209</th><td></td></tr>
<tr><th id="210">210</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createHashObject" title='createHashObject' data-ref="createHashObject">createHashObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="211">211</th><td>    <em>unsigned</em> <em>char</em> *<dfn class="local col9 decl" id="29zl" title='zl' data-type='unsigned char *' data-ref="29zl">zl</dfn> = <a class="ref" href="ziplist.h.html#ziplistNew" title='ziplistNew' data-ref="ziplistNew">ziplistNew</a>();</td></tr>
<tr><th id="212">212</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col0 decl" id="30o" title='o' data-type='robj *' data-ref="30o">o</dfn> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#453" title="4" data-ref="_M/OBJ_HASH">OBJ_HASH</a>, <a class="local col9 ref" href="#29zl" title='zl' data-ref="29zl">zl</a>);</td></tr>
<tr><th id="213">213</th><td>    <a class="local col0 ref" href="#30o" title='o' data-ref="30o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>;</td></tr>
<tr><th id="214">214</th><td>    <b>return</b> <a class="local col0 ref" href="#30o" title='o' data-ref="30o">o</a>;</td></tr>
<tr><th id="215">215</th><td>}</td></tr>
<tr><th id="216">216</th><td></td></tr>
<tr><th id="217">217</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createZsetObject" title='createZsetObject' data-ref="createZsetObject">createZsetObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="218">218</th><td>    <a class="typedef" href="server.h.html#zset" title='zset' data-type='struct zset' data-ref="zset">zset</a> *<dfn class="local col1 decl" id="31zs" title='zs' data-type='zset *' data-ref="31zs">zs</dfn> = <a class="ref" href="zmalloc.h.html#zmalloc" title='zmalloc' data-ref="zmalloc">zmalloc</a>(<b>sizeof</b>(*<a class="local col1 ref" href="#31zs" title='zs' data-ref="31zs">zs</a>));</td></tr>
<tr><th id="219">219</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col2 decl" id="32o" title='o' data-type='robj *' data-ref="32o">o</dfn>;</td></tr>
<tr><th id="220">220</th><td></td></tr>
<tr><th id="221">221</th><td>    <a class="local col1 ref" href="#31zs" title='zs' data-ref="31zs">zs</a>-&gt;<a class="ref" href="server.h.html#zset::dict" title='zset::dict' data-ref="zset::dict">dict</a> = <a class="ref" href="dict.h.html#dictCreate" title='dictCreate' data-ref="dictCreate">dictCreate</a>(&amp;<a class="ref" href="server.h.html#zsetDictType" title='zsetDictType' data-ref="zsetDictType">zsetDictType</a>,<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="222">222</th><td>    <a class="local col1 ref" href="#31zs" title='zs' data-ref="31zs">zs</a>-&gt;<a class="ref" href="server.h.html#zset::zsl" title='zset::zsl' data-ref="zset::zsl">zsl</a> = <a class="ref" href="server.h.html#zslCreate" title='zslCreate' data-ref="zslCreate">zslCreate</a>();</td></tr>
<tr><th id="223">223</th><td>    <a class="local col2 ref" href="#32o" title='o' data-ref="32o">o</a> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#452" title="3" data-ref="_M/OBJ_ZSET">OBJ_ZSET</a>,<a class="local col1 ref" href="#31zs" title='zs' data-ref="31zs">zs</a>);</td></tr>
<tr><th id="224">224</th><td>    <a class="local col2 ref" href="#32o" title='o' data-ref="32o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#575" title="7" data-ref="_M/OBJ_ENCODING_SKIPLIST">OBJ_ENCODING_SKIPLIST</a>;</td></tr>
<tr><th id="225">225</th><td>    <b>return</b> <a class="local col2 ref" href="#32o" title='o' data-ref="32o">o</a>;</td></tr>
<tr><th id="226">226</th><td>}</td></tr>
<tr><th id="227">227</th><td></td></tr>
<tr><th id="228">228</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createZsetZiplistObject" title='createZsetZiplistObject' data-ref="createZsetZiplistObject">createZsetZiplistObject</dfn>(<em>void</em>) {</td></tr>
<tr><th id="229">229</th><td>    <em>unsigned</em> <em>char</em> *<dfn class="local col3 decl" id="33zl" title='zl' data-type='unsigned char *' data-ref="33zl">zl</dfn> = <a class="ref" href="ziplist.h.html#ziplistNew" title='ziplistNew' data-ref="ziplistNew">ziplistNew</a>();</td></tr>
<tr><th id="230">230</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col4 decl" id="34o" title='o' data-type='robj *' data-ref="34o">o</dfn> = <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#452" title="3" data-ref="_M/OBJ_ZSET">OBJ_ZSET</a>,<a class="local col3 ref" href="#33zl" title='zl' data-ref="33zl">zl</a>);</td></tr>
<tr><th id="231">231</th><td>    <a class="local col4 ref" href="#34o" title='o' data-ref="34o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>;</td></tr>
<tr><th id="232">232</th><td>    <b>return</b> <a class="local col4 ref" href="#34o" title='o' data-ref="34o">o</a>;</td></tr>
<tr><th id="233">233</th><td>}</td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="createModuleObject" title='createModuleObject' data-ref="createModuleObject">createModuleObject</dfn>(<a class="typedef" href="server.h.html#moduleType" title='moduleType' data-type='struct RedisModuleType' data-ref="moduleType">moduleType</a> *<dfn class="local col5 decl" id="35mt" title='mt' data-type='moduleType *' data-ref="35mt">mt</dfn>, <em>void</em> *<dfn class="local col6 decl" id="36value" title='value' data-type='void *' data-ref="36value">value</dfn>) {</td></tr>
<tr><th id="236">236</th><td>    <a class="typedef" href="server.h.html#moduleValue" title='moduleValue' data-type='struct moduleValue' data-ref="moduleValue">moduleValue</a> *<dfn class="local col7 decl" id="37mv" title='mv' data-type='moduleValue *' data-ref="37mv">mv</dfn> = <a class="ref" href="zmalloc.h.html#zmalloc" title='zmalloc' data-ref="zmalloc">zmalloc</a>(<b>sizeof</b>(*<a class="local col7 ref" href="#37mv" title='mv' data-ref="37mv">mv</a>));</td></tr>
<tr><th id="237">237</th><td>    <a class="local col7 ref" href="#37mv" title='mv' data-ref="37mv">mv</a>-&gt;<a class="ref" href="server.h.html#moduleValue::type" title='moduleValue::type' data-ref="moduleValue::type">type</a> = <a class="local col5 ref" href="#35mt" title='mt' data-ref="35mt">mt</a>;</td></tr>
<tr><th id="238">238</th><td>    <a class="local col7 ref" href="#37mv" title='mv' data-ref="37mv">mv</a>-&gt;<a class="ref" href="server.h.html#moduleValue::value" title='moduleValue::value' data-ref="moduleValue::value">value</a> = <a class="local col6 ref" href="#36value" title='value' data-ref="36value">value</a>;</td></tr>
<tr><th id="239">239</th><td>    <b>return</b> <a class="ref" href="#createObject" title='createObject' data-ref="createObject">createObject</a>(<a class="macro" href="server.h.html#466" title="5" data-ref="_M/OBJ_MODULE">OBJ_MODULE</a>,<a class="local col7 ref" href="#37mv" title='mv' data-ref="37mv">mv</a>);</td></tr>
<tr><th id="240">240</th><td>}</td></tr>
<tr><th id="241">241</th><td></td></tr>
<tr><th id="242">242</th><td><em>void</em> <dfn class="decl def" id="freeStringObject" title='freeStringObject' data-ref="freeStringObject">freeStringObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col8 decl" id="38o" title='o' data-type='robj *' data-ref="38o">o</dfn>) {</td></tr>
<tr><th id="243">243</th><td>    <b>if</b> (<a class="local col8 ref" href="#38o" title='o' data-ref="38o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a>) {</td></tr>
<tr><th id="244">244</th><td>        <a class="ref" href="sds.h.html#sdsfree" title='sdsfree' data-ref="sdsfree">sdsfree</a>(<a class="local col8 ref" href="#38o" title='o' data-ref="38o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="245">245</th><td>    }</td></tr>
<tr><th id="246">246</th><td>}</td></tr>
<tr><th id="247">247</th><td></td></tr>
<tr><th id="248">248</th><td><em>void</em> <dfn class="decl def" id="freeListObject" title='freeListObject' data-ref="freeListObject">freeListObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col9 decl" id="39o" title='o' data-type='robj *' data-ref="39o">o</dfn>) {</td></tr>
<tr><th id="249">249</th><td>    <b>if</b> (<a class="local col9 ref" href="#39o" title='o' data-ref="39o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#577" title="9" data-ref="_M/OBJ_ENCODING_QUICKLIST">OBJ_ENCODING_QUICKLIST</a>) {</td></tr>
<tr><th id="250">250</th><td>        <a class="ref" href="quicklist.h.html#quicklistRelease" title='quicklistRelease' data-ref="quicklistRelease">quicklistRelease</a>(<a class="local col9 ref" href="#39o" title='o' data-ref="39o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="251">251</th><td>    } <b>else</b> {</td></tr>
<tr><th id="252">252</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,252,&quot;Unknown list encoding type&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown list encoding type"</q>);</td></tr>
<tr><th id="253">253</th><td>    }</td></tr>
<tr><th id="254">254</th><td>}</td></tr>
<tr><th id="255">255</th><td></td></tr>
<tr><th id="256">256</th><td><em>void</em> <dfn class="decl def" id="freeSetObject" title='freeSetObject' data-ref="freeSetObject">freeSetObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col0 decl" id="40o" title='o' data-type='robj *' data-ref="40o">o</dfn>) {</td></tr>
<tr><th id="257">257</th><td>    <b>switch</b> (<a class="local col0 ref" href="#40o" title='o' data-ref="40o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a>) {</td></tr>
<tr><th id="258">258</th><td>    <b>case</b> <a class="macro" href="server.h.html#570" title="2" data-ref="_M/OBJ_ENCODING_HT">OBJ_ENCODING_HT</a>:</td></tr>
<tr><th id="259">259</th><td>        <a class="ref" href="dict.h.html#dictRelease" title='dictRelease' data-ref="dictRelease">dictRelease</a>((<a class="typedef" href="dict.h.html#dict" title='dict' data-type='struct dict' data-ref="dict">dict</a>*) <a class="local col0 ref" href="#40o" title='o' data-ref="40o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="260">260</th><td>        <b>break</b>;</td></tr>
<tr><th id="261">261</th><td>    <b>case</b> <a class="macro" href="server.h.html#574" title="6" data-ref="_M/OBJ_ENCODING_INTSET">OBJ_ENCODING_INTSET</a>:</td></tr>
<tr><th id="262">262</th><td>        <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col0 ref" href="#40o" title='o' data-ref="40o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="263">263</th><td>        <b>break</b>;</td></tr>
<tr><th id="264">264</th><td>    <b>default</b>:</td></tr>
<tr><th id="265">265</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,265,&quot;Unknown set encoding type&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown set encoding type"</q>);</td></tr>
<tr><th id="266">266</th><td>    }</td></tr>
<tr><th id="267">267</th><td>}</td></tr>
<tr><th id="268">268</th><td></td></tr>
<tr><th id="269">269</th><td><em>void</em> <dfn class="decl def" id="freeZsetObject" title='freeZsetObject' data-ref="freeZsetObject">freeZsetObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col1 decl" id="41o" title='o' data-type='robj *' data-ref="41o">o</dfn>) {</td></tr>
<tr><th id="270">270</th><td>    <a class="typedef" href="server.h.html#zset" title='zset' data-type='struct zset' data-ref="zset">zset</a> *<dfn class="local col2 decl" id="42zs" title='zs' data-type='zset *' data-ref="42zs">zs</dfn>;</td></tr>
<tr><th id="271">271</th><td>    <b>switch</b> (<a class="local col1 ref" href="#41o" title='o' data-ref="41o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a>) {</td></tr>
<tr><th id="272">272</th><td>    <b>case</b> <a class="macro" href="server.h.html#575" title="7" data-ref="_M/OBJ_ENCODING_SKIPLIST">OBJ_ENCODING_SKIPLIST</a>:</td></tr>
<tr><th id="273">273</th><td>        <a class="local col2 ref" href="#42zs" title='zs' data-ref="42zs">zs</a> = <a class="local col1 ref" href="#41o" title='o' data-ref="41o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="274">274</th><td>        <a class="ref" href="dict.h.html#dictRelease" title='dictRelease' data-ref="dictRelease">dictRelease</a>(<a class="local col2 ref" href="#42zs" title='zs' data-ref="42zs">zs</a>-&gt;<a class="ref" href="server.h.html#zset::dict" title='zset::dict' data-ref="zset::dict">dict</a>);</td></tr>
<tr><th id="275">275</th><td>        <a class="ref" href="server.h.html#zslFree" title='zslFree' data-ref="zslFree">zslFree</a>(<a class="local col2 ref" href="#42zs" title='zs' data-ref="42zs">zs</a>-&gt;<a class="ref" href="server.h.html#zset::zsl" title='zset::zsl' data-ref="zset::zsl">zsl</a>);</td></tr>
<tr><th id="276">276</th><td>        <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col2 ref" href="#42zs" title='zs' data-ref="42zs">zs</a>);</td></tr>
<tr><th id="277">277</th><td>        <b>break</b>;</td></tr>
<tr><th id="278">278</th><td>    <b>case</b> <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>:</td></tr>
<tr><th id="279">279</th><td>        <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col1 ref" href="#41o" title='o' data-ref="41o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="280">280</th><td>        <b>break</b>;</td></tr>
<tr><th id="281">281</th><td>    <b>default</b>:</td></tr>
<tr><th id="282">282</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,282,&quot;Unknown sorted set encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown sorted set encoding"</q>);</td></tr>
<tr><th id="283">283</th><td>    }</td></tr>
<tr><th id="284">284</th><td>}</td></tr>
<tr><th id="285">285</th><td></td></tr>
<tr><th id="286">286</th><td><em>void</em> <dfn class="decl def" id="freeHashObject" title='freeHashObject' data-ref="freeHashObject">freeHashObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col3 decl" id="43o" title='o' data-type='robj *' data-ref="43o">o</dfn>) {</td></tr>
<tr><th id="287">287</th><td>    <b>switch</b> (<a class="local col3 ref" href="#43o" title='o' data-ref="43o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a>) {</td></tr>
<tr><th id="288">288</th><td>    <b>case</b> <a class="macro" href="server.h.html#570" title="2" data-ref="_M/OBJ_ENCODING_HT">OBJ_ENCODING_HT</a>:</td></tr>
<tr><th id="289">289</th><td>        <a class="ref" href="dict.h.html#dictRelease" title='dictRelease' data-ref="dictRelease">dictRelease</a>((<a class="typedef" href="dict.h.html#dict" title='dict' data-type='struct dict' data-ref="dict">dict</a>*) <a class="local col3 ref" href="#43o" title='o' data-ref="43o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="290">290</th><td>        <b>break</b>;</td></tr>
<tr><th id="291">291</th><td>    <b>case</b> <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>:</td></tr>
<tr><th id="292">292</th><td>        <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col3 ref" href="#43o" title='o' data-ref="43o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="293">293</th><td>        <b>break</b>;</td></tr>
<tr><th id="294">294</th><td>    <b>default</b>:</td></tr>
<tr><th id="295">295</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,295,&quot;Unknown hash encoding type&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown hash encoding type"</q>);</td></tr>
<tr><th id="296">296</th><td>        <b>break</b>;</td></tr>
<tr><th id="297">297</th><td>    }</td></tr>
<tr><th id="298">298</th><td>}</td></tr>
<tr><th id="299">299</th><td></td></tr>
<tr><th id="300">300</th><td><em>void</em> <dfn class="decl def" id="freeModuleObject" title='freeModuleObject' data-ref="freeModuleObject">freeModuleObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col4 decl" id="44o" title='o' data-type='robj *' data-ref="44o">o</dfn>) {</td></tr>
<tr><th id="301">301</th><td>    <a class="typedef" href="server.h.html#moduleValue" title='moduleValue' data-type='struct moduleValue' data-ref="moduleValue">moduleValue</a> *<dfn class="local col5 decl" id="45mv" title='mv' data-type='moduleValue *' data-ref="45mv">mv</dfn> = <a class="local col4 ref" href="#44o" title='o' data-ref="44o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="302">302</th><td>    <a class="local col5 ref" href="#45mv" title='mv' data-ref="45mv">mv</a>-&gt;<a class="ref" href="server.h.html#moduleValue::type" title='moduleValue::type' data-ref="moduleValue::type">type</a>-&gt;<a class="ref" href="server.h.html#RedisModuleType::free" title='RedisModuleType::free' data-ref="RedisModuleType::free">free</a>(<a class="local col5 ref" href="#45mv" title='mv' data-ref="45mv">mv</a>-&gt;<a class="ref" href="server.h.html#moduleValue::value" title='moduleValue::value' data-ref="moduleValue::value">value</a>);</td></tr>
<tr><th id="303">303</th><td>    <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col5 ref" href="#45mv" title='mv' data-ref="45mv">mv</a>);</td></tr>
<tr><th id="304">304</th><td>}</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td><em>void</em> <dfn class="decl def" id="incrRefCount" title='incrRefCount' data-ref="incrRefCount">incrRefCount</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col6 decl" id="46o" title='o' data-type='robj *' data-ref="46o">o</dfn>) {</td></tr>
<tr><th id="307">307</th><td>    <b>if</b> (<a class="local col6 ref" href="#46o" title='o' data-ref="46o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> != <a class="macro" href="server.h.html#583" title="2147483647" data-ref="_M/OBJ_SHARED_REFCOUNT">OBJ_SHARED_REFCOUNT</a>) <a class="local col6 ref" href="#46o" title='o' data-ref="46o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a>++;</td></tr>
<tr><th id="308">308</th><td>}</td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td><em>void</em> <dfn class="decl def" id="decrRefCount" title='decrRefCount' data-ref="decrRefCount">decrRefCount</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col7 decl" id="47o" title='o' data-type='robj *' data-ref="47o">o</dfn>) {</td></tr>
<tr><th id="311">311</th><td>    <b>if</b> (<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> == <var>1</var>) {</td></tr>
<tr><th id="312">312</th><td>        <b>switch</b>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a>) {</td></tr>
<tr><th id="313">313</th><td>        <b>case</b> <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>: <a class="ref" href="#freeStringObject" title='freeStringObject' data-ref="freeStringObject">freeStringObject</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>); <b>break</b>;</td></tr>
<tr><th id="314">314</th><td>        <b>case</b> <a class="macro" href="server.h.html#450" title="1" data-ref="_M/OBJ_LIST">OBJ_LIST</a>: <a class="ref" href="#freeListObject" title='freeListObject' data-ref="freeListObject">freeListObject</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>); <b>break</b>;</td></tr>
<tr><th id="315">315</th><td>        <b>case</b> <a class="macro" href="server.h.html#451" title="2" data-ref="_M/OBJ_SET">OBJ_SET</a>: <a class="ref" href="#freeSetObject" title='freeSetObject' data-ref="freeSetObject">freeSetObject</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>); <b>break</b>;</td></tr>
<tr><th id="316">316</th><td>        <b>case</b> <a class="macro" href="server.h.html#452" title="3" data-ref="_M/OBJ_ZSET">OBJ_ZSET</a>: <a class="ref" href="#freeZsetObject" title='freeZsetObject' data-ref="freeZsetObject">freeZsetObject</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>); <b>break</b>;</td></tr>
<tr><th id="317">317</th><td>        <b>case</b> <a class="macro" href="server.h.html#453" title="4" data-ref="_M/OBJ_HASH">OBJ_HASH</a>: <a class="ref" href="#freeHashObject" title='freeHashObject' data-ref="freeHashObject">freeHashObject</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>); <b>break</b>;</td></tr>
<tr><th id="318">318</th><td>        <b>case</b> <a class="macro" href="server.h.html#466" title="5" data-ref="_M/OBJ_MODULE">OBJ_MODULE</a>: <a class="ref" href="#freeModuleObject" title='freeModuleObject' data-ref="freeModuleObject">freeModuleObject</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>); <b>break</b>;</td></tr>
<tr><th id="319">319</th><td>        <b>default</b>: <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,319,&quot;Unknown object type&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown object type"</q>); <b>break</b>;</td></tr>
<tr><th id="320">320</th><td>        }</td></tr>
<tr><th id="321">321</th><td>        <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>);</td></tr>
<tr><th id="322">322</th><td>    } <b>else</b> {</td></tr>
<tr><th id="323">323</th><td>        <b>if</b> (<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> &lt;= <var>0</var>) <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,323,&quot;decrRefCount against refcount &lt;= 0&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"decrRefCount against refcount &lt;= 0"</q>);</td></tr>
<tr><th id="324">324</th><td>        <b>if</b> (<a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> != <a class="macro" href="server.h.html#583" title="2147483647" data-ref="_M/OBJ_SHARED_REFCOUNT">OBJ_SHARED_REFCOUNT</a>) <a class="local col7 ref" href="#47o" title='o' data-ref="47o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a>--;</td></tr>
<tr><th id="325">325</th><td>    }</td></tr>
<tr><th id="326">326</th><td>}</td></tr>
<tr><th id="327">327</th><td></td></tr>
<tr><th id="328">328</th><td><i>/* This variant of decrRefCount() gets its argument as void, and is useful</i></td></tr>
<tr><th id="329">329</th><td><i> * as free method in data structures that expect a 'void free_object(void*)'</i></td></tr>
<tr><th id="330">330</th><td><i> * prototype for the free method. */</i></td></tr>
<tr><th id="331">331</th><td><em>void</em> <dfn class="decl def" id="decrRefCountVoid" title='decrRefCountVoid' data-ref="decrRefCountVoid">decrRefCountVoid</dfn>(<em>void</em> *<dfn class="local col8 decl" id="48o" title='o' data-type='void *' data-ref="48o">o</dfn>) {</td></tr>
<tr><th id="332">332</th><td>    <a class="ref" href="#decrRefCount" title='decrRefCount' data-ref="decrRefCount">decrRefCount</a>(<a class="local col8 ref" href="#48o" title='o' data-ref="48o">o</a>);</td></tr>
<tr><th id="333">333</th><td>}</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td><i>/* This function set the ref count to zero without freeing the object.</i></td></tr>
<tr><th id="336">336</th><td><i> * It is useful in order to pass a new object to functions incrementing</i></td></tr>
<tr><th id="337">337</th><td><i> * the ref count of the received object. Example:</i></td></tr>
<tr><th id="338">338</th><td><i> *</i></td></tr>
<tr><th id="339">339</th><td><i> *    functionThatWillIncrementRefCount(resetRefCount(CreateObject(...)));</i></td></tr>
<tr><th id="340">340</th><td><i> *</i></td></tr>
<tr><th id="341">341</th><td><i> * Otherwise you need to resort to the less elegant pattern:</i></td></tr>
<tr><th id="342">342</th><td><i> *</i></td></tr>
<tr><th id="343">343</th><td><i> *    *obj = createObject(...);</i></td></tr>
<tr><th id="344">344</th><td><i> *    functionThatWillIncrementRefCount(obj);</i></td></tr>
<tr><th id="345">345</th><td><i> *    decrRefCount(obj);</i></td></tr>
<tr><th id="346">346</th><td><i> */</i></td></tr>
<tr><th id="347">347</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="resetRefCount" title='resetRefCount' data-ref="resetRefCount">resetRefCount</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col9 decl" id="49obj" title='obj' data-type='robj *' data-ref="49obj">obj</dfn>) {</td></tr>
<tr><th id="348">348</th><td>    <a class="local col9 ref" href="#49obj" title='obj' data-ref="49obj">obj</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> = <var>0</var>;</td></tr>
<tr><th id="349">349</th><td>    <b>return</b> <a class="local col9 ref" href="#49obj" title='obj' data-ref="49obj">obj</a>;</td></tr>
<tr><th id="350">350</th><td>}</td></tr>
<tr><th id="351">351</th><td></td></tr>
<tr><th id="352">352</th><td><em>int</em> <dfn class="decl def" id="checkType" title='checkType' data-ref="checkType">checkType</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col0 decl" id="50c" title='c' data-type='client *' data-ref="50c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col1 decl" id="51o" title='o' data-type='robj *' data-ref="51o">o</dfn>, <em>int</em> <dfn class="local col2 decl" id="52type" title='type' data-type='int' data-ref="52type">type</dfn>) {</td></tr>
<tr><th id="353">353</th><td>    <b>if</b> (<a class="local col1 ref" href="#51o" title='o' data-ref="51o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> != <a class="local col2 ref" href="#52type" title='type' data-ref="52type">type</a>) {</td></tr>
<tr><th id="354">354</th><td>        <a class="ref" href="server.h.html#addReply" title='addReply' data-ref="addReply">addReply</a>(<a class="local col0 ref" href="#50c" title='c' data-ref="50c">c</a>,<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::wrongtypeerr" title='sharedObjectsStruct::wrongtypeerr' data-ref="sharedObjectsStruct::wrongtypeerr">wrongtypeerr</a>);</td></tr>
<tr><th id="355">355</th><td>        <b>return</b> <var>1</var>;</td></tr>
<tr><th id="356">356</th><td>    }</td></tr>
<tr><th id="357">357</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="358">358</th><td>}</td></tr>
<tr><th id="359">359</th><td></td></tr>
<tr><th id="360">360</th><td><em>int</em> <dfn class="decl def" id="isSdsRepresentableAsLongLong" title='isSdsRepresentableAsLongLong' data-ref="isSdsRepresentableAsLongLong">isSdsRepresentableAsLongLong</dfn>(<a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="local col3 decl" id="53s" title='s' data-type='sds' data-ref="53s">s</dfn>, <em>long</em> <em>long</em> *<dfn class="local col4 decl" id="54llval" title='llval' data-type='long long *' data-ref="54llval">llval</dfn>) {</td></tr>
<tr><th id="361">361</th><td>    <b>return</b> <a class="ref" href="util.h.html#string2ll" title='string2ll' data-ref="string2ll">string2ll</a>(<a class="local col3 ref" href="#53s" title='s' data-ref="53s">s</a>,<a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col3 ref" href="#53s" title='s' data-ref="53s">s</a>),<a class="local col4 ref" href="#54llval" title='llval' data-ref="54llval">llval</a>) ? <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a> : <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="362">362</th><td>}</td></tr>
<tr><th id="363">363</th><td></td></tr>
<tr><th id="364">364</th><td><em>int</em> <dfn class="decl def" id="isObjectRepresentableAsLongLong" title='isObjectRepresentableAsLongLong' data-ref="isObjectRepresentableAsLongLong">isObjectRepresentableAsLongLong</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col5 decl" id="55o" title='o' data-type='robj *' data-ref="55o">o</dfn>, <em>long</em> <em>long</em> *<dfn class="local col6 decl" id="56llval" title='llval' data-type='long long *' data-ref="56llval">llval</dfn>) {</td></tr>
<tr><th id="365">365</th><td>    <a class="macro" href="server.h.html#438" title="((o-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),o,&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,365),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col5 ref" href="#55o" title='o' data-ref="55o">o</a>,<a class="local col5 ref" href="#55o" title='o' data-ref="55o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="366">366</th><td>    <b>if</b> (<a class="local col5 ref" href="#55o" title='o' data-ref="55o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>) {</td></tr>
<tr><th id="367">367</th><td>        <b>if</b> (<a class="local col6 ref" href="#56llval" title='llval' data-ref="56llval">llval</a>) *<a class="local col6 ref" href="#56llval" title='llval' data-ref="56llval">llval</a> = (<em>long</em>) <a class="local col5 ref" href="#55o" title='o' data-ref="55o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="368">368</th><td>        <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="369">369</th><td>    } <b>else</b> {</td></tr>
<tr><th id="370">370</th><td>        <b>return</b> <a class="ref" href="#isSdsRepresentableAsLongLong" title='isSdsRepresentableAsLongLong' data-ref="isSdsRepresentableAsLongLong">isSdsRepresentableAsLongLong</a>(<a class="local col5 ref" href="#55o" title='o' data-ref="55o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<a class="local col6 ref" href="#56llval" title='llval' data-ref="56llval">llval</a>);</td></tr>
<tr><th id="371">371</th><td>    }</td></tr>
<tr><th id="372">372</th><td>}</td></tr>
<tr><th id="373">373</th><td></td></tr>
<tr><th id="374">374</th><td><i>/* Try to encode a string object in order to save space */</i></td></tr>
<tr><th id="375">375</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="tryObjectEncoding" title='tryObjectEncoding' data-ref="tryObjectEncoding">tryObjectEncoding</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col7 decl" id="57o" title='o' data-type='robj *' data-ref="57o">o</dfn>) {</td></tr>
<tr><th id="376">376</th><td>    <em>long</em> <dfn class="local col8 decl" id="58value" title='value' data-type='long' data-ref="58value">value</dfn>;</td></tr>
<tr><th id="377">377</th><td>    <a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="local col9 decl" id="59s" title='s' data-type='sds' data-ref="59s">s</dfn> = <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="378">378</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col0 decl" id="60len" title='len' data-type='size_t' data-ref="60len">len</dfn>;</td></tr>
<tr><th id="379">379</th><td></td></tr>
<tr><th id="380">380</th><td>    <i>/* Make sure this is a string object, the only type we encode</i></td></tr>
<tr><th id="381">381</th><td><i>     * in this function. Other types use encoded memory efficient</i></td></tr>
<tr><th id="382">382</th><td><i>     * representations but are handled by the commands implementing</i></td></tr>
<tr><th id="383">383</th><td><i>     * the type. */</i></td></tr>
<tr><th id="384">384</th><td>    <a class="macro" href="server.h.html#438" title="((o-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),o,&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,384),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>,<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="385">385</th><td></td></tr>
<tr><th id="386">386</th><td>    <i>/* We try some specialized encoding only for objects that are</i></td></tr>
<tr><th id="387">387</th><td><i>     * RAW or EMBSTR encoded, in other words objects that are still</i></td></tr>
<tr><th id="388">388</th><td><i>     * in represented by an actually array of chars. */</i></td></tr>
<tr><th id="389">389</th><td>    <b>if</b> (!<a class="macro" href="server.h.html#1472" title="(o-&gt;encoding == 0 || o-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>)) <b>return</b> <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>;</td></tr>
<tr><th id="390">390</th><td></td></tr>
<tr><th id="391">391</th><td>    <i>/* It's not safe to encode shared objects: shared objects can be shared</i></td></tr>
<tr><th id="392">392</th><td><i>     * everywhere in the "object space" of Redis and may end in places where</i></td></tr>
<tr><th id="393">393</th><td><i>     * they are not handled. We handle them only as values in the keyspace. */</i></td></tr>
<tr><th id="394">394</th><td>     <b>if</b> (<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a> &gt; <var>1</var>) <b>return</b> <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>;</td></tr>
<tr><th id="395">395</th><td></td></tr>
<tr><th id="396">396</th><td>    <i>/* Check if we can represent this string as a long integer.</i></td></tr>
<tr><th id="397">397</th><td><i>     * Note that we are sure that a string larger than 20 chars is not</i></td></tr>
<tr><th id="398">398</th><td><i>     * representable as a 32 nor 64 bit integer. */</i></td></tr>
<tr><th id="399">399</th><td>    <a class="local col0 ref" href="#60len" title='len' data-ref="60len">len</a> = <a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>);</td></tr>
<tr><th id="400">400</th><td>    <b>if</b> (<a class="local col0 ref" href="#60len" title='len' data-ref="60len">len</a> &lt;= <var>20</var> &amp;&amp; <a class="ref" href="util.h.html#string2l" title='string2l' data-ref="string2l">string2l</a>(<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>,<a class="local col0 ref" href="#60len" title='len' data-ref="60len">len</a>,&amp;<a class="local col8 ref" href="#58value" title='value' data-ref="58value">value</a>)) {</td></tr>
<tr><th id="401">401</th><td>        <i>/* This object is encodable as a long. Try to use a shared object.</i></td></tr>
<tr><th id="402">402</th><td><i>         * Note that we avoid using shared integers when maxmemory is used</i></td></tr>
<tr><th id="403">403</th><td><i>         * because every object needs to have a private LRU field for the LRU</i></td></tr>
<tr><th id="404">404</th><td><i>         * algorithm to work well. */</i></td></tr>
<tr><th id="405">405</th><td>        <b>if</b> ((<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::maxmemory" title='redisServer::maxmemory' data-ref="redisServer::maxmemory">maxmemory</a> == <var>0</var> ||</td></tr>
<tr><th id="406">406</th><td>            !(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::maxmemory_policy" title='redisServer::maxmemory_policy' data-ref="redisServer::maxmemory_policy">maxmemory_policy</a> &amp; <a class="macro" href="server.h.html#369" title="((1&lt;&lt;0)|(1&lt;&lt;1))" data-ref="_M/MAXMEMORY_FLAG_NO_SHARED_INTEGERS">MAXMEMORY_FLAG_NO_SHARED_INTEGERS</a>)) &amp;&amp;</td></tr>
<tr><th id="407">407</th><td>            <a class="local col8 ref" href="#58value" title='value' data-ref="58value">value</a> &gt;= <var>0</var> &amp;&amp;</td></tr>
<tr><th id="408">408</th><td>            <a class="local col8 ref" href="#58value" title='value' data-ref="58value">value</a> &lt; <a class="macro" href="server.h.html#92" title="10000" data-ref="_M/OBJ_SHARED_INTEGERS">OBJ_SHARED_INTEGERS</a>)</td></tr>
<tr><th id="409">409</th><td>        {</td></tr>
<tr><th id="410">410</th><td>            <a class="ref" href="#decrRefCount" title='decrRefCount' data-ref="decrRefCount">decrRefCount</a>(<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>);</td></tr>
<tr><th id="411">411</th><td>            <a class="ref" href="#incrRefCount" title='incrRefCount' data-ref="incrRefCount">incrRefCount</a>(<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::integers" title='sharedObjectsStruct::integers' data-ref="sharedObjectsStruct::integers">integers</a>[<a class="local col8 ref" href="#58value" title='value' data-ref="58value">value</a>]);</td></tr>
<tr><th id="412">412</th><td>            <b>return</b> <a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::integers" title='sharedObjectsStruct::integers' data-ref="sharedObjectsStruct::integers">integers</a>[<a class="local col8 ref" href="#58value" title='value' data-ref="58value">value</a>];</td></tr>
<tr><th id="413">413</th><td>        } <b>else</b> {</td></tr>
<tr><th id="414">414</th><td>            <b>if</b> (<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a>) <a class="ref" href="sds.h.html#sdsfree" title='sdsfree' data-ref="sdsfree">sdsfree</a>(<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="415">415</th><td>            <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> = <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>;</td></tr>
<tr><th id="416">416</th><td>            <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> = (<em>void</em>*) <a class="local col8 ref" href="#58value" title='value' data-ref="58value">value</a>;</td></tr>
<tr><th id="417">417</th><td>            <b>return</b> <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>;</td></tr>
<tr><th id="418">418</th><td>        }</td></tr>
<tr><th id="419">419</th><td>    }</td></tr>
<tr><th id="420">420</th><td></td></tr>
<tr><th id="421">421</th><td>    <i>/* If the string is small and is still RAW encoded,</i></td></tr>
<tr><th id="422">422</th><td><i>     * try the EMBSTR encoding which is more efficient.</i></td></tr>
<tr><th id="423">423</th><td><i>     * In this representation the object and the SDS string are allocated</i></td></tr>
<tr><th id="424">424</th><td><i>     * in the same chunk of memory to save space and cache misses. */</i></td></tr>
<tr><th id="425">425</th><td>    <b>if</b> (<a class="local col0 ref" href="#60len" title='len' data-ref="60len">len</a> &lt;= <a class="macro" href="#116" title="44" data-ref="_M/OBJ_ENCODING_EMBSTR_SIZE_LIMIT">OBJ_ENCODING_EMBSTR_SIZE_LIMIT</a>) {</td></tr>
<tr><th id="426">426</th><td>        <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col1 decl" id="61emb" title='emb' data-type='robj *' data-ref="61emb">emb</dfn>;</td></tr>
<tr><th id="427">427</th><td></td></tr>
<tr><th id="428">428</th><td>        <b>if</b> (<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#576" title="8" data-ref="_M/OBJ_ENCODING_EMBSTR">OBJ_ENCODING_EMBSTR</a>) <b>return</b> <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>;</td></tr>
<tr><th id="429">429</th><td>        <a class="local col1 ref" href="#61emb" title='emb' data-ref="61emb">emb</a> = <a class="ref" href="#createEmbeddedStringObject" title='createEmbeddedStringObject' data-ref="createEmbeddedStringObject">createEmbeddedStringObject</a>(<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>,<a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>));</td></tr>
<tr><th id="430">430</th><td>        <a class="ref" href="#decrRefCount" title='decrRefCount' data-ref="decrRefCount">decrRefCount</a>(<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>);</td></tr>
<tr><th id="431">431</th><td>        <b>return</b> <a class="local col1 ref" href="#61emb" title='emb' data-ref="61emb">emb</a>;</td></tr>
<tr><th id="432">432</th><td>    }</td></tr>
<tr><th id="433">433</th><td></td></tr>
<tr><th id="434">434</th><td>    <i>/* We can't encode the object...</i></td></tr>
<tr><th id="435">435</th><td><i>     *</i></td></tr>
<tr><th id="436">436</th><td><i>     * Do the last try, and at least optimize the SDS string inside</i></td></tr>
<tr><th id="437">437</th><td><i>     * the string object to require little space, in case there</i></td></tr>
<tr><th id="438">438</th><td><i>     * is more than 10% of free space at the end of the SDS string.</i></td></tr>
<tr><th id="439">439</th><td><i>     *</i></td></tr>
<tr><th id="440">440</th><td><i>     * We do that only for relatively large strings as this branch</i></td></tr>
<tr><th id="441">441</th><td><i>     * is only entered if the length of the string is greater than</i></td></tr>
<tr><th id="442">442</th><td><i>     * OBJ_ENCODING_EMBSTR_SIZE_LIMIT. */</i></td></tr>
<tr><th id="443">443</th><td>    <b>if</b> (<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a> &amp;&amp;</td></tr>
<tr><th id="444">444</th><td>        <a class="ref" href="sds.h.html#sdsavail" title='sdsavail' data-ref="sdsavail">sdsavail</a>(<a class="local col9 ref" href="#59s" title='s' data-ref="59s">s</a>) &gt; <a class="local col0 ref" href="#60len" title='len' data-ref="60len">len</a>/<var>10</var>)</td></tr>
<tr><th id="445">445</th><td>    {</td></tr>
<tr><th id="446">446</th><td>        <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> = <a class="ref" href="sds.h.html#sdsRemoveFreeSpace" title='sdsRemoveFreeSpace' data-ref="sdsRemoveFreeSpace">sdsRemoveFreeSpace</a>(<a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="447">447</th><td>    }</td></tr>
<tr><th id="448">448</th><td></td></tr>
<tr><th id="449">449</th><td>    <i>/* Return the original object. */</i></td></tr>
<tr><th id="450">450</th><td>    <b>return</b> <a class="local col7 ref" href="#57o" title='o' data-ref="57o">o</a>;</td></tr>
<tr><th id="451">451</th><td>}</td></tr>
<tr><th id="452">452</th><td></td></tr>
<tr><th id="453">453</th><td><i>/* Get a decoded version of an encoded object (returned as a new object).</i></td></tr>
<tr><th id="454">454</th><td><i> * If the object is already raw-encoded just increment the ref count. */</i></td></tr>
<tr><th id="455">455</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="getDecodedObject" title='getDecodedObject' data-ref="getDecodedObject">getDecodedObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col2 decl" id="62o" title='o' data-type='robj *' data-ref="62o">o</dfn>) {</td></tr>
<tr><th id="456">456</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col3 decl" id="63dec" title='dec' data-type='robj *' data-ref="63dec">dec</dfn>;</td></tr>
<tr><th id="457">457</th><td></td></tr>
<tr><th id="458">458</th><td>    <b>if</b> (<a class="macro" href="server.h.html#1472" title="(o-&gt;encoding == 0 || o-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col2 ref" href="#62o" title='o' data-ref="62o">o</a>)) {</td></tr>
<tr><th id="459">459</th><td>        <a class="ref" href="#incrRefCount" title='incrRefCount' data-ref="incrRefCount">incrRefCount</a>(<a class="local col2 ref" href="#62o" title='o' data-ref="62o">o</a>);</td></tr>
<tr><th id="460">460</th><td>        <b>return</b> <a class="local col2 ref" href="#62o" title='o' data-ref="62o">o</a>;</td></tr>
<tr><th id="461">461</th><td>    }</td></tr>
<tr><th id="462">462</th><td>    <b>if</b> (<a class="local col2 ref" href="#62o" title='o' data-ref="62o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a> &amp;&amp; <a class="local col2 ref" href="#62o" title='o' data-ref="62o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>) {</td></tr>
<tr><th id="463">463</th><td>        <em>char</em> <dfn class="local col4 decl" id="64buf" title='buf' data-type='char [32]' data-ref="64buf">buf</dfn>[<var>32</var>];</td></tr>
<tr><th id="464">464</th><td></td></tr>
<tr><th id="465">465</th><td>        <a class="ref" href="util.h.html#ll2string" title='ll2string' data-ref="ll2string">ll2string</a>(<a class="local col4 ref" href="#64buf" title='buf' data-ref="64buf">buf</a>,<var>32</var>,(<em>long</em>)<a class="local col2 ref" href="#62o" title='o' data-ref="62o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="466">466</th><td>        <a class="local col3 ref" href="#63dec" title='dec' data-ref="63dec">dec</a> = <a class="ref" href="#createStringObject" title='createStringObject' data-ref="createStringObject">createStringObject</a>(<a class="local col4 ref" href="#64buf" title='buf' data-ref="64buf">buf</a>,<a class="ref" href="../../include/string.h.html#strlen" title='strlen' data-ref="strlen">strlen</a>(<a class="local col4 ref" href="#64buf" title='buf' data-ref="64buf">buf</a>));</td></tr>
<tr><th id="467">467</th><td>        <b>return</b> <a class="local col3 ref" href="#63dec" title='dec' data-ref="63dec">dec</a>;</td></tr>
<tr><th id="468">468</th><td>    } <b>else</b> {</td></tr>
<tr><th id="469">469</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,469,&quot;Unknown encoding type&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown encoding type"</q>);</td></tr>
<tr><th id="470">470</th><td>    }</td></tr>
<tr><th id="471">471</th><td>}</td></tr>
<tr><th id="472">472</th><td></td></tr>
<tr><th id="473">473</th><td><i>/* Compare two string objects via strcmp() or strcoll() depending on flags.</i></td></tr>
<tr><th id="474">474</th><td><i> * Note that the objects may be integer-encoded. In such a case we</i></td></tr>
<tr><th id="475">475</th><td><i> * use ll2string() to get a string representation of the numbers on the stack</i></td></tr>
<tr><th id="476">476</th><td><i> * and compare the strings, it's much faster than calling getDecodedObject().</i></td></tr>
<tr><th id="477">477</th><td><i> *</i></td></tr>
<tr><th id="478">478</th><td><i> * Important note: when REDIS_COMPARE_BINARY is used a binary-safe comparison</i></td></tr>
<tr><th id="479">479</th><td><i> * is used. */</i></td></tr>
<tr><th id="480">480</th><td></td></tr>
<tr><th id="481">481</th><td><u>#define <dfn class="macro" id="_M/REDIS_COMPARE_BINARY" data-ref="_M/REDIS_COMPARE_BINARY">REDIS_COMPARE_BINARY</dfn> (1&lt;&lt;0)</u></td></tr>
<tr><th id="482">482</th><td><u>#define <dfn class="macro" id="_M/REDIS_COMPARE_COLL" data-ref="_M/REDIS_COMPARE_COLL">REDIS_COMPARE_COLL</dfn> (1&lt;&lt;1)</u></td></tr>
<tr><th id="483">483</th><td></td></tr>
<tr><th id="484">484</th><td><em>int</em> <dfn class="decl def" id="compareStringObjectsWithFlags" title='compareStringObjectsWithFlags' data-ref="compareStringObjectsWithFlags">compareStringObjectsWithFlags</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col5 decl" id="65a" title='a' data-type='robj *' data-ref="65a">a</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col6 decl" id="66b" title='b' data-type='robj *' data-ref="66b">b</dfn>, <em>int</em> <dfn class="local col7 decl" id="67flags" title='flags' data-type='int' data-ref="67flags">flags</dfn>) {</td></tr>
<tr><th id="485">485</th><td>    <a class="macro" href="server.h.html#438" title="((a-&gt;type == 0 &amp;&amp; b-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),a,&quot;a-&gt;type == OBJ_STRING &amp;&amp; b-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,485),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col5 ref" href="#65a" title='a' data-ref="65a">a</a>,<a class="local col5 ref" href="#65a" title='a' data-ref="65a">a</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a> &amp;&amp; <a class="local col6 ref" href="#66b" title='b' data-ref="66b">b</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="486">486</th><td>    <em>char</em> <dfn class="local col8 decl" id="68bufa" title='bufa' data-type='char [128]' data-ref="68bufa">bufa</dfn>[<var>128</var>], <dfn class="local col9 decl" id="69bufb" title='bufb' data-type='char [128]' data-ref="69bufb">bufb</dfn>[<var>128</var>], *<dfn class="local col0 decl" id="70astr" title='astr' data-type='char *' data-ref="70astr">astr</dfn>, *<dfn class="local col1 decl" id="71bstr" title='bstr' data-type='char *' data-ref="71bstr">bstr</dfn>;</td></tr>
<tr><th id="487">487</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col2 decl" id="72alen" title='alen' data-type='size_t' data-ref="72alen">alen</dfn>, <dfn class="local col3 decl" id="73blen" title='blen' data-type='size_t' data-ref="73blen">blen</dfn>, <dfn class="local col4 decl" id="74minlen" title='minlen' data-type='size_t' data-ref="74minlen">minlen</dfn>;</td></tr>
<tr><th id="488">488</th><td></td></tr>
<tr><th id="489">489</th><td>    <b>if</b> (<a class="local col5 ref" href="#65a" title='a' data-ref="65a">a</a> == <a class="local col6 ref" href="#66b" title='b' data-ref="66b">b</a>) <b>return</b> <var>0</var>;</td></tr>
<tr><th id="490">490</th><td>    <b>if</b> (<a class="macro" href="server.h.html#1472" title="(a-&gt;encoding == 0 || a-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col5 ref" href="#65a" title='a' data-ref="65a">a</a>)) {</td></tr>
<tr><th id="491">491</th><td>        <a class="local col0 ref" href="#70astr" title='astr' data-ref="70astr">astr</a> = <a class="local col5 ref" href="#65a" title='a' data-ref="65a">a</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="492">492</th><td>        <a class="local col2 ref" href="#72alen" title='alen' data-ref="72alen">alen</a> = <a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col0 ref" href="#70astr" title='astr' data-ref="70astr">astr</a>);</td></tr>
<tr><th id="493">493</th><td>    } <b>else</b> {</td></tr>
<tr><th id="494">494</th><td>        <a class="local col2 ref" href="#72alen" title='alen' data-ref="72alen">alen</a> = <a class="ref" href="util.h.html#ll2string" title='ll2string' data-ref="ll2string">ll2string</a>(<a class="local col8 ref" href="#68bufa" title='bufa' data-ref="68bufa">bufa</a>,<b>sizeof</b>(<a class="local col8 ref" href="#68bufa" title='bufa' data-ref="68bufa">bufa</a>),(<em>long</em>) <a class="local col5 ref" href="#65a" title='a' data-ref="65a">a</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="495">495</th><td>        <a class="local col0 ref" href="#70astr" title='astr' data-ref="70astr">astr</a> = <a class="local col8 ref" href="#68bufa" title='bufa' data-ref="68bufa">bufa</a>;</td></tr>
<tr><th id="496">496</th><td>    }</td></tr>
<tr><th id="497">497</th><td>    <b>if</b> (<a class="macro" href="server.h.html#1472" title="(b-&gt;encoding == 0 || b-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col6 ref" href="#66b" title='b' data-ref="66b">b</a>)) {</td></tr>
<tr><th id="498">498</th><td>        <a class="local col1 ref" href="#71bstr" title='bstr' data-ref="71bstr">bstr</a> = <a class="local col6 ref" href="#66b" title='b' data-ref="66b">b</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="499">499</th><td>        <a class="local col3 ref" href="#73blen" title='blen' data-ref="73blen">blen</a> = <a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col1 ref" href="#71bstr" title='bstr' data-ref="71bstr">bstr</a>);</td></tr>
<tr><th id="500">500</th><td>    } <b>else</b> {</td></tr>
<tr><th id="501">501</th><td>        <a class="local col3 ref" href="#73blen" title='blen' data-ref="73blen">blen</a> = <a class="ref" href="util.h.html#ll2string" title='ll2string' data-ref="ll2string">ll2string</a>(<a class="local col9 ref" href="#69bufb" title='bufb' data-ref="69bufb">bufb</a>,<b>sizeof</b>(<a class="local col9 ref" href="#69bufb" title='bufb' data-ref="69bufb">bufb</a>),(<em>long</em>) <a class="local col6 ref" href="#66b" title='b' data-ref="66b">b</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="502">502</th><td>        <a class="local col1 ref" href="#71bstr" title='bstr' data-ref="71bstr">bstr</a> = <a class="local col9 ref" href="#69bufb" title='bufb' data-ref="69bufb">bufb</a>;</td></tr>
<tr><th id="503">503</th><td>    }</td></tr>
<tr><th id="504">504</th><td>    <b>if</b> (<a class="local col7 ref" href="#67flags" title='flags' data-ref="67flags">flags</a> &amp; <a class="macro" href="#482" title="(1&lt;&lt;1)" data-ref="_M/REDIS_COMPARE_COLL">REDIS_COMPARE_COLL</a>) {</td></tr>
<tr><th id="505">505</th><td>        <b>return</b> <a class="ref" href="../../include/string.h.html#strcoll" title='strcoll' data-ref="strcoll">strcoll</a>(<a class="local col0 ref" href="#70astr" title='astr' data-ref="70astr">astr</a>,<a class="local col1 ref" href="#71bstr" title='bstr' data-ref="71bstr">bstr</a>);</td></tr>
<tr><th id="506">506</th><td>    } <b>else</b> {</td></tr>
<tr><th id="507">507</th><td>        <em>int</em> <dfn class="local col5 decl" id="75cmp" title='cmp' data-type='int' data-ref="75cmp">cmp</dfn>;</td></tr>
<tr><th id="508">508</th><td></td></tr>
<tr><th id="509">509</th><td>        <a class="local col4 ref" href="#74minlen" title='minlen' data-ref="74minlen">minlen</a> = (<a class="local col2 ref" href="#72alen" title='alen' data-ref="72alen">alen</a> &lt; <a class="local col3 ref" href="#73blen" title='blen' data-ref="73blen">blen</a>) ? <a class="local col2 ref" href="#72alen" title='alen' data-ref="72alen">alen</a> : <a class="local col3 ref" href="#73blen" title='blen' data-ref="73blen">blen</a>;</td></tr>
<tr><th id="510">510</th><td>        <a class="local col5 ref" href="#75cmp" title='cmp' data-ref="75cmp">cmp</a> = <a class="ref" href="../../include/string.h.html#memcmp" title='memcmp' data-ref="memcmp">memcmp</a>(<a class="local col0 ref" href="#70astr" title='astr' data-ref="70astr">astr</a>,<a class="local col1 ref" href="#71bstr" title='bstr' data-ref="71bstr">bstr</a>,<a class="local col4 ref" href="#74minlen" title='minlen' data-ref="74minlen">minlen</a>);</td></tr>
<tr><th id="511">511</th><td>        <b>if</b> (<a class="local col5 ref" href="#75cmp" title='cmp' data-ref="75cmp">cmp</a> == <var>0</var>) <b>return</b> <a class="local col2 ref" href="#72alen" title='alen' data-ref="72alen">alen</a>-<a class="local col3 ref" href="#73blen" title='blen' data-ref="73blen">blen</a>;</td></tr>
<tr><th id="512">512</th><td>        <b>return</b> <a class="local col5 ref" href="#75cmp" title='cmp' data-ref="75cmp">cmp</a>;</td></tr>
<tr><th id="513">513</th><td>    }</td></tr>
<tr><th id="514">514</th><td>}</td></tr>
<tr><th id="515">515</th><td></td></tr>
<tr><th id="516">516</th><td><i>/* Wrapper for compareStringObjectsWithFlags() using binary comparison. */</i></td></tr>
<tr><th id="517">517</th><td><em>int</em> <dfn class="decl def" id="compareStringObjects" title='compareStringObjects' data-ref="compareStringObjects">compareStringObjects</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col6 decl" id="76a" title='a' data-type='robj *' data-ref="76a">a</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col7 decl" id="77b" title='b' data-type='robj *' data-ref="77b">b</dfn>) {</td></tr>
<tr><th id="518">518</th><td>    <b>return</b> <a class="ref" href="#compareStringObjectsWithFlags" title='compareStringObjectsWithFlags' data-ref="compareStringObjectsWithFlags">compareStringObjectsWithFlags</a>(<a class="local col6 ref" href="#76a" title='a' data-ref="76a">a</a>,<a class="local col7 ref" href="#77b" title='b' data-ref="77b">b</a>,<a class="macro" href="#481" title="(1&lt;&lt;0)" data-ref="_M/REDIS_COMPARE_BINARY">REDIS_COMPARE_BINARY</a>);</td></tr>
<tr><th id="519">519</th><td>}</td></tr>
<tr><th id="520">520</th><td></td></tr>
<tr><th id="521">521</th><td><i>/* Wrapper for compareStringObjectsWithFlags() using collation. */</i></td></tr>
<tr><th id="522">522</th><td><em>int</em> <dfn class="decl def" id="collateStringObjects" title='collateStringObjects' data-ref="collateStringObjects">collateStringObjects</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col8 decl" id="78a" title='a' data-type='robj *' data-ref="78a">a</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col9 decl" id="79b" title='b' data-type='robj *' data-ref="79b">b</dfn>) {</td></tr>
<tr><th id="523">523</th><td>    <b>return</b> <a class="ref" href="#compareStringObjectsWithFlags" title='compareStringObjectsWithFlags' data-ref="compareStringObjectsWithFlags">compareStringObjectsWithFlags</a>(<a class="local col8 ref" href="#78a" title='a' data-ref="78a">a</a>,<a class="local col9 ref" href="#79b" title='b' data-ref="79b">b</a>,<a class="macro" href="#482" title="(1&lt;&lt;1)" data-ref="_M/REDIS_COMPARE_COLL">REDIS_COMPARE_COLL</a>);</td></tr>
<tr><th id="524">524</th><td>}</td></tr>
<tr><th id="525">525</th><td></td></tr>
<tr><th id="526">526</th><td><i>/* Equal string objects return 1 if the two objects are the same from the</i></td></tr>
<tr><th id="527">527</th><td><i> * point of view of a string comparison, otherwise 0 is returned. Note that</i></td></tr>
<tr><th id="528">528</th><td><i> * this function is faster then checking for (compareStringObject(a,b) == 0)</i></td></tr>
<tr><th id="529">529</th><td><i> * because it can perform some more optimization. */</i></td></tr>
<tr><th id="530">530</th><td><em>int</em> <dfn class="decl def" id="equalStringObjects" title='equalStringObjects' data-ref="equalStringObjects">equalStringObjects</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col0 decl" id="80a" title='a' data-type='robj *' data-ref="80a">a</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col1 decl" id="81b" title='b' data-type='robj *' data-ref="81b">b</dfn>) {</td></tr>
<tr><th id="531">531</th><td>    <b>if</b> (<a class="local col0 ref" href="#80a" title='a' data-ref="80a">a</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a> &amp;&amp;</td></tr>
<tr><th id="532">532</th><td>        <a class="local col1 ref" href="#81b" title='b' data-ref="81b">b</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>){</td></tr>
<tr><th id="533">533</th><td>        <i>/* If both strings are integer encoded just check if the stored</i></td></tr>
<tr><th id="534">534</th><td><i>         * long is the same. */</i></td></tr>
<tr><th id="535">535</th><td>        <b>return</b> <a class="local col0 ref" href="#80a" title='a' data-ref="80a">a</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a> == <a class="local col1 ref" href="#81b" title='b' data-ref="81b">b</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="536">536</th><td>    } <b>else</b> {</td></tr>
<tr><th id="537">537</th><td>        <b>return</b> <a class="ref" href="#compareStringObjects" title='compareStringObjects' data-ref="compareStringObjects">compareStringObjects</a>(<a class="local col0 ref" href="#80a" title='a' data-ref="80a">a</a>,<a class="local col1 ref" href="#81b" title='b' data-ref="81b">b</a>) == <var>0</var>;</td></tr>
<tr><th id="538">538</th><td>    }</td></tr>
<tr><th id="539">539</th><td>}</td></tr>
<tr><th id="540">540</th><td></td></tr>
<tr><th id="541">541</th><td><span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="decl def" id="stringObjectLen" title='stringObjectLen' data-ref="stringObjectLen">stringObjectLen</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col2 decl" id="82o" title='o' data-type='robj *' data-ref="82o">o</dfn>) {</td></tr>
<tr><th id="542">542</th><td>    <a class="macro" href="server.h.html#438" title="((o-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),o,&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,542),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col2 ref" href="#82o" title='o' data-ref="82o">o</a>,<a class="local col2 ref" href="#82o" title='o' data-ref="82o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="543">543</th><td>    <b>if</b> (<a class="macro" href="server.h.html#1472" title="(o-&gt;encoding == 0 || o-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col2 ref" href="#82o" title='o' data-ref="82o">o</a>)) {</td></tr>
<tr><th id="544">544</th><td>        <b>return</b> <a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col2 ref" href="#82o" title='o' data-ref="82o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="545">545</th><td>    } <b>else</b> {</td></tr>
<tr><th id="546">546</th><td>        <b>return</b> <a class="ref" href="util.h.html#sdigits10" title='sdigits10' data-ref="sdigits10">sdigits10</a>((<em>long</em>)<a class="local col2 ref" href="#82o" title='o' data-ref="82o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="547">547</th><td>    }</td></tr>
<tr><th id="548">548</th><td>}</td></tr>
<tr><th id="549">549</th><td></td></tr>
<tr><th id="550">550</th><td><em>int</em> <dfn class="decl def" id="getDoubleFromObject" title='getDoubleFromObject' data-ref="getDoubleFromObject">getDoubleFromObject</dfn>(<em>const</em> <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col3 decl" id="83o" title='o' data-type='const robj *' data-ref="83o">o</dfn>, <em>double</em> *<dfn class="local col4 decl" id="84target" title='target' data-type='double *' data-ref="84target">target</dfn>) {</td></tr>
<tr><th id="551">551</th><td>    <em>double</em> <dfn class="local col5 decl" id="85value" title='value' data-type='double' data-ref="85value">value</dfn>;</td></tr>
<tr><th id="552">552</th><td>    <em>char</em> *<dfn class="local col6 decl" id="86eptr" title='eptr' data-type='char *' data-ref="86eptr">eptr</dfn>;</td></tr>
<tr><th id="553">553</th><td></td></tr>
<tr><th id="554">554</th><td>    <b>if</b> (<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="555">555</th><td>        <a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a> = <var>0</var>;</td></tr>
<tr><th id="556">556</th><td>    } <b>else</b> {</td></tr>
<tr><th id="557">557</th><td>        <a class="macro" href="server.h.html#438" title="((o-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),o,&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,557),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>,<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="558">558</th><td>        <b>if</b> (<a class="macro" href="server.h.html#1472" title="(o-&gt;encoding == 0 || o-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>)) {</td></tr>
<tr><th id="559">559</th><td>            <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> = <var>0</var>;</td></tr>
<tr><th id="560">560</th><td>            <a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a> = <a class="ref" href="../../include/stdlib.h.html#strtod" title='strtod' data-ref="strtod">strtod</a>(<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>, &amp;<a class="local col6 ref" href="#86eptr" title='eptr' data-ref="86eptr">eptr</a>);</td></tr>
<tr><th id="561">561</th><td>            <b>if</b> (<a class="macro" href="../../include/ctype.h.html#205" title="((*__ctype_b_loc ())[(int) ((((const char*)o-&gt;ptr)[0]))] &amp; (unsigned short int) _ISspace)" data-ref="_M/isspace">isspace</a>(((<em>const</em> <em>char</em>*)<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)[<var>0</var>]) ||</td></tr>
<tr><th id="562">562</th><td>                <a class="local col6 ref" href="#86eptr" title='eptr' data-ref="86eptr">eptr</a>[<var>0</var>] != <kbd>'\0'</kbd> ||</td></tr>
<tr><th id="563">563</th><td>                (<a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> == <a class="macro" href="../../include/asm-generic/errno-base.h.html#37" title="34" data-ref="_M/ERANGE">ERANGE</a> &amp;&amp;</td></tr>
<tr><th id="564">564</th><td>                    (<a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a> == <a class="macro" href="../../include/x86_64-linux-gnu/bits/huge_val.h.html#27" title="(__builtin_huge_val())" data-ref="_M/HUGE_VAL">HUGE_VAL</a> || <a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a> == -<a class="macro" href="../../include/x86_64-linux-gnu/bits/huge_val.h.html#27" title="(__builtin_huge_val())" data-ref="_M/HUGE_VAL">HUGE_VAL</a> || <a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a> == <var>0</var>)) ||</td></tr>
<tr><th id="565">565</th><td>                <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> == <a class="macro" href="../../include/asm-generic/errno-base.h.html#25" title="22" data-ref="_M/EINVAL">EINVAL</a> ||</td></tr>
<tr><th id="566">566</th><td>                <a class="macro" href="../../include/math.h.html#297" title="(sizeof (value) == sizeof (float) ? __isnanf (value) : sizeof (value) == sizeof (double) ? __isnan (value) : __isnanl (value))" data-ref="_M/isnan">isnan</a>(<a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a>))</td></tr>
<tr><th id="567">567</th><td>                <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="568">568</th><td>        } <b>else</b> <b>if</b> (<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>) {</td></tr>
<tr><th id="569">569</th><td>            <a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a> = (<em>long</em>)<a class="local col3 ref" href="#83o" title='o' data-ref="83o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="570">570</th><td>        } <b>else</b> {</td></tr>
<tr><th id="571">571</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,571,&quot;Unknown string encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown string encoding"</q>);</td></tr>
<tr><th id="572">572</th><td>        }</td></tr>
<tr><th id="573">573</th><td>    }</td></tr>
<tr><th id="574">574</th><td>    *<a class="local col4 ref" href="#84target" title='target' data-ref="84target">target</a> = <a class="local col5 ref" href="#85value" title='value' data-ref="85value">value</a>;</td></tr>
<tr><th id="575">575</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="576">576</th><td>}</td></tr>
<tr><th id="577">577</th><td></td></tr>
<tr><th id="578">578</th><td><em>int</em> <dfn class="decl def" id="getDoubleFromObjectOrReply" title='getDoubleFromObjectOrReply' data-ref="getDoubleFromObjectOrReply">getDoubleFromObjectOrReply</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col7 decl" id="87c" title='c' data-type='client *' data-ref="87c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col8 decl" id="88o" title='o' data-type='robj *' data-ref="88o">o</dfn>, <em>double</em> *<dfn class="local col9 decl" id="89target" title='target' data-type='double *' data-ref="89target">target</dfn>, <em>const</em> <em>char</em> *<dfn class="local col0 decl" id="90msg" title='msg' data-type='const char *' data-ref="90msg">msg</dfn>) {</td></tr>
<tr><th id="579">579</th><td>    <em>double</em> <dfn class="local col1 decl" id="91value" title='value' data-type='double' data-ref="91value">value</dfn>;</td></tr>
<tr><th id="580">580</th><td>    <b>if</b> (<a class="ref" href="#getDoubleFromObject" title='getDoubleFromObject' data-ref="getDoubleFromObject">getDoubleFromObject</a>(<a class="local col8 ref" href="#88o" title='o' data-ref="88o">o</a>, &amp;<a class="local col1 ref" href="#91value" title='value' data-ref="91value">value</a>) != <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>) {</td></tr>
<tr><th id="581">581</th><td>        <b>if</b> (<a class="local col0 ref" href="#90msg" title='msg' data-ref="90msg">msg</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="582">582</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col7 ref" href="#87c" title='c' data-ref="87c">c</a>,(<em>char</em>*)<a class="local col0 ref" href="#90msg" title='msg' data-ref="90msg">msg</a>);</td></tr>
<tr><th id="583">583</th><td>        } <b>else</b> {</td></tr>
<tr><th id="584">584</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col7 ref" href="#87c" title='c' data-ref="87c">c</a>,<q>"value is not a valid float"</q>);</td></tr>
<tr><th id="585">585</th><td>        }</td></tr>
<tr><th id="586">586</th><td>        <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="587">587</th><td>    }</td></tr>
<tr><th id="588">588</th><td>    *<a class="local col9 ref" href="#89target" title='target' data-ref="89target">target</a> = <a class="local col1 ref" href="#91value" title='value' data-ref="91value">value</a>;</td></tr>
<tr><th id="589">589</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="590">590</th><td>}</td></tr>
<tr><th id="591">591</th><td></td></tr>
<tr><th id="592">592</th><td><em>int</em> <dfn class="decl def" id="getLongDoubleFromObject" title='getLongDoubleFromObject' data-ref="getLongDoubleFromObject">getLongDoubleFromObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col2 decl" id="92o" title='o' data-type='robj *' data-ref="92o">o</dfn>, <em>long</em> <em>double</em> *<dfn class="local col3 decl" id="93target" title='target' data-type='long double *' data-ref="93target">target</dfn>) {</td></tr>
<tr><th id="593">593</th><td>    <em>long</em> <em>double</em> <dfn class="local col4 decl" id="94value" title='value' data-type='long double' data-ref="94value">value</dfn>;</td></tr>
<tr><th id="594">594</th><td>    <em>char</em> *<dfn class="local col5 decl" id="95eptr" title='eptr' data-type='char *' data-ref="95eptr">eptr</dfn>;</td></tr>
<tr><th id="595">595</th><td></td></tr>
<tr><th id="596">596</th><td>    <b>if</b> (<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="597">597</th><td>        <a class="local col4 ref" href="#94value" title='value' data-ref="94value">value</a> = <var>0</var>;</td></tr>
<tr><th id="598">598</th><td>    } <b>else</b> {</td></tr>
<tr><th id="599">599</th><td>        <a class="macro" href="server.h.html#438" title="((o-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),o,&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,599),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>,<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="600">600</th><td>        <b>if</b> (<a class="macro" href="server.h.html#1472" title="(o-&gt;encoding == 0 || o-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>)) {</td></tr>
<tr><th id="601">601</th><td>            <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> = <var>0</var>;</td></tr>
<tr><th id="602">602</th><td>            <a class="local col4 ref" href="#94value" title='value' data-ref="94value">value</a> = <a class="ref" href="../../include/stdlib.h.html#strtold" title='strtold' data-ref="strtold">strtold</a>(<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>, &amp;<a class="local col5 ref" href="#95eptr" title='eptr' data-ref="95eptr">eptr</a>);</td></tr>
<tr><th id="603">603</th><td>            <b>if</b> (<a class="macro" href="../../include/ctype.h.html#205" title="((*__ctype_b_loc ())[(int) ((((char*)o-&gt;ptr)[0]))] &amp; (unsigned short int) _ISspace)" data-ref="_M/isspace">isspace</a>(((<em>char</em>*)<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)[<var>0</var>]) || <a class="local col5 ref" href="#95eptr" title='eptr' data-ref="95eptr">eptr</a>[<var>0</var>] != <kbd>'\0'</kbd> ||</td></tr>
<tr><th id="604">604</th><td>                <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> == <a class="macro" href="../../include/asm-generic/errno-base.h.html#37" title="34" data-ref="_M/ERANGE">ERANGE</a> || <a class="macro" href="../../include/math.h.html#297" title="(sizeof (value) == sizeof (float) ? __isnanf (value) : sizeof (value) == sizeof (double) ? __isnan (value) : __isnanl (value))" data-ref="_M/isnan">isnan</a>(<a class="local col4 ref" href="#94value" title='value' data-ref="94value">value</a>))</td></tr>
<tr><th id="605">605</th><td>                <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="606">606</th><td>        } <b>else</b> <b>if</b> (<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>) {</td></tr>
<tr><th id="607">607</th><td>            <a class="local col4 ref" href="#94value" title='value' data-ref="94value">value</a> = (<em>long</em>)<a class="local col2 ref" href="#92o" title='o' data-ref="92o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="608">608</th><td>        } <b>else</b> {</td></tr>
<tr><th id="609">609</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,609,&quot;Unknown string encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown string encoding"</q>);</td></tr>
<tr><th id="610">610</th><td>        }</td></tr>
<tr><th id="611">611</th><td>    }</td></tr>
<tr><th id="612">612</th><td>    *<a class="local col3 ref" href="#93target" title='target' data-ref="93target">target</a> = <a class="local col4 ref" href="#94value" title='value' data-ref="94value">value</a>;</td></tr>
<tr><th id="613">613</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="614">614</th><td>}</td></tr>
<tr><th id="615">615</th><td></td></tr>
<tr><th id="616">616</th><td><em>int</em> <dfn class="decl def" id="getLongDoubleFromObjectOrReply" title='getLongDoubleFromObjectOrReply' data-ref="getLongDoubleFromObjectOrReply">getLongDoubleFromObjectOrReply</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col6 decl" id="96c" title='c' data-type='client *' data-ref="96c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col7 decl" id="97o" title='o' data-type='robj *' data-ref="97o">o</dfn>, <em>long</em> <em>double</em> *<dfn class="local col8 decl" id="98target" title='target' data-type='long double *' data-ref="98target">target</dfn>, <em>const</em> <em>char</em> *<dfn class="local col9 decl" id="99msg" title='msg' data-type='const char *' data-ref="99msg">msg</dfn>) {</td></tr>
<tr><th id="617">617</th><td>    <em>long</em> <em>double</em> <dfn class="local col0 decl" id="100value" title='value' data-type='long double' data-ref="100value">value</dfn>;</td></tr>
<tr><th id="618">618</th><td>    <b>if</b> (<a class="ref" href="#getLongDoubleFromObject" title='getLongDoubleFromObject' data-ref="getLongDoubleFromObject">getLongDoubleFromObject</a>(<a class="local col7 ref" href="#97o" title='o' data-ref="97o">o</a>, &amp;<a class="local col0 ref" href="#100value" title='value' data-ref="100value">value</a>) != <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>) {</td></tr>
<tr><th id="619">619</th><td>        <b>if</b> (<a class="local col9 ref" href="#99msg" title='msg' data-ref="99msg">msg</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="620">620</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col6 ref" href="#96c" title='c' data-ref="96c">c</a>,(<em>char</em>*)<a class="local col9 ref" href="#99msg" title='msg' data-ref="99msg">msg</a>);</td></tr>
<tr><th id="621">621</th><td>        } <b>else</b> {</td></tr>
<tr><th id="622">622</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col6 ref" href="#96c" title='c' data-ref="96c">c</a>,<q>"value is not a valid float"</q>);</td></tr>
<tr><th id="623">623</th><td>        }</td></tr>
<tr><th id="624">624</th><td>        <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="625">625</th><td>    }</td></tr>
<tr><th id="626">626</th><td>    *<a class="local col8 ref" href="#98target" title='target' data-ref="98target">target</a> = <a class="local col0 ref" href="#100value" title='value' data-ref="100value">value</a>;</td></tr>
<tr><th id="627">627</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="628">628</th><td>}</td></tr>
<tr><th id="629">629</th><td></td></tr>
<tr><th id="630">630</th><td><em>int</em> <dfn class="decl def" id="getLongLongFromObject" title='getLongLongFromObject' data-ref="getLongLongFromObject">getLongLongFromObject</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col1 decl" id="101o" title='o' data-type='robj *' data-ref="101o">o</dfn>, <em>long</em> <em>long</em> *<dfn class="local col2 decl" id="102target" title='target' data-type='long long *' data-ref="102target">target</dfn>) {</td></tr>
<tr><th id="631">631</th><td>    <em>long</em> <em>long</em> <dfn class="local col3 decl" id="103value" title='value' data-type='long long' data-ref="103value">value</dfn>;</td></tr>
<tr><th id="632">632</th><td></td></tr>
<tr><th id="633">633</th><td>    <b>if</b> (<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="634">634</th><td>        <a class="local col3 ref" href="#103value" title='value' data-ref="103value">value</a> = <var>0</var>;</td></tr>
<tr><th id="635">635</th><td>    } <b>else</b> {</td></tr>
<tr><th id="636">636</th><td>        <a class="macro" href="server.h.html#438" title="((o-&gt;type == 0)?(void)0 : (_serverAssertWithInfo(((void*)0),o,&quot;o-&gt;type == OBJ_STRING&quot;,&quot;/home/jon/workspace/redis/src/object.c&quot;,636),_exit(1)))" data-ref="_M/serverAssertWithInfo">serverAssertWithInfo</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>,<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>);</td></tr>
<tr><th id="637">637</th><td>        <b>if</b> (<a class="macro" href="server.h.html#1472" title="(o-&gt;encoding == 0 || o-&gt;encoding == 8)" data-ref="_M/sdsEncodedObject">sdsEncodedObject</a>(<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>)) {</td></tr>
<tr><th id="638">638</th><td>            <b>if</b> (<a class="ref" href="util.h.html#string2ll" title='string2ll' data-ref="string2ll">string2ll</a>(<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>),&amp;<a class="local col3 ref" href="#103value" title='value' data-ref="103value">value</a>) == <var>0</var>) <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="639">639</th><td>        } <b>else</b> <b>if</b> (<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>) {</td></tr>
<tr><th id="640">640</th><td>            <a class="local col3 ref" href="#103value" title='value' data-ref="103value">value</a> = (<em>long</em>)<a class="local col1 ref" href="#101o" title='o' data-ref="101o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="641">641</th><td>        } <b>else</b> {</td></tr>
<tr><th id="642">642</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,642,&quot;Unknown string encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown string encoding"</q>);</td></tr>
<tr><th id="643">643</th><td>        }</td></tr>
<tr><th id="644">644</th><td>    }</td></tr>
<tr><th id="645">645</th><td>    <b>if</b> (<a class="local col2 ref" href="#102target" title='target' data-ref="102target">target</a>) *<a class="local col2 ref" href="#102target" title='target' data-ref="102target">target</a> = <a class="local col3 ref" href="#103value" title='value' data-ref="103value">value</a>;</td></tr>
<tr><th id="646">646</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="647">647</th><td>}</td></tr>
<tr><th id="648">648</th><td></td></tr>
<tr><th id="649">649</th><td><em>int</em> <dfn class="decl def" id="getLongLongFromObjectOrReply" title='getLongLongFromObjectOrReply' data-ref="getLongLongFromObjectOrReply">getLongLongFromObjectOrReply</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col4 decl" id="104c" title='c' data-type='client *' data-ref="104c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col5 decl" id="105o" title='o' data-type='robj *' data-ref="105o">o</dfn>, <em>long</em> <em>long</em> *<dfn class="local col6 decl" id="106target" title='target' data-type='long long *' data-ref="106target">target</dfn>, <em>const</em> <em>char</em> *<dfn class="local col7 decl" id="107msg" title='msg' data-type='const char *' data-ref="107msg">msg</dfn>) {</td></tr>
<tr><th id="650">650</th><td>    <em>long</em> <em>long</em> <dfn class="local col8 decl" id="108value" title='value' data-type='long long' data-ref="108value">value</dfn>;</td></tr>
<tr><th id="651">651</th><td>    <b>if</b> (<a class="ref" href="#getLongLongFromObject" title='getLongLongFromObject' data-ref="getLongLongFromObject">getLongLongFromObject</a>(<a class="local col5 ref" href="#105o" title='o' data-ref="105o">o</a>, &amp;<a class="local col8 ref" href="#108value" title='value' data-ref="108value">value</a>) != <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>) {</td></tr>
<tr><th id="652">652</th><td>        <b>if</b> (<a class="local col7 ref" href="#107msg" title='msg' data-ref="107msg">msg</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="653">653</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col4 ref" href="#104c" title='c' data-ref="104c">c</a>,(<em>char</em>*)<a class="local col7 ref" href="#107msg" title='msg' data-ref="107msg">msg</a>);</td></tr>
<tr><th id="654">654</th><td>        } <b>else</b> {</td></tr>
<tr><th id="655">655</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col4 ref" href="#104c" title='c' data-ref="104c">c</a>,<q>"value is not an integer or out of range"</q>);</td></tr>
<tr><th id="656">656</th><td>        }</td></tr>
<tr><th id="657">657</th><td>        <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="658">658</th><td>    }</td></tr>
<tr><th id="659">659</th><td>    *<a class="local col6 ref" href="#106target" title='target' data-ref="106target">target</a> = <a class="local col8 ref" href="#108value" title='value' data-ref="108value">value</a>;</td></tr>
<tr><th id="660">660</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="661">661</th><td>}</td></tr>
<tr><th id="662">662</th><td></td></tr>
<tr><th id="663">663</th><td><em>int</em> <dfn class="decl def" id="getLongFromObjectOrReply" title='getLongFromObjectOrReply' data-ref="getLongFromObjectOrReply">getLongFromObjectOrReply</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col9 decl" id="109c" title='c' data-type='client *' data-ref="109c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col0 decl" id="110o" title='o' data-type='robj *' data-ref="110o">o</dfn>, <em>long</em> *<dfn class="local col1 decl" id="111target" title='target' data-type='long *' data-ref="111target">target</dfn>, <em>const</em> <em>char</em> *<dfn class="local col2 decl" id="112msg" title='msg' data-type='const char *' data-ref="112msg">msg</dfn>) {</td></tr>
<tr><th id="664">664</th><td>    <em>long</em> <em>long</em> <dfn class="local col3 decl" id="113value" title='value' data-type='long long' data-ref="113value">value</dfn>;</td></tr>
<tr><th id="665">665</th><td></td></tr>
<tr><th id="666">666</th><td>    <b>if</b> (<a class="ref" href="#getLongLongFromObjectOrReply" title='getLongLongFromObjectOrReply' data-ref="getLongLongFromObjectOrReply">getLongLongFromObjectOrReply</a>(<a class="local col9 ref" href="#109c" title='c' data-ref="109c">c</a>, <a class="local col0 ref" href="#110o" title='o' data-ref="110o">o</a>, &amp;<a class="local col3 ref" href="#113value" title='value' data-ref="113value">value</a>, <a class="local col2 ref" href="#112msg" title='msg' data-ref="112msg">msg</a>) != <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>) <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="667">667</th><td>    <b>if</b> (<a class="local col3 ref" href="#113value" title='value' data-ref="113value">value</a> &lt; <span class="macro" title="(-9223372036854775807L -1L)" data-ref="_M/LONG_MIN">LONG_MIN</span> || <a class="local col3 ref" href="#113value" title='value' data-ref="113value">value</a> &gt; <span class="macro" title="9223372036854775807L" data-ref="_M/LONG_MAX">LONG_MAX</span>) {</td></tr>
<tr><th id="668">668</th><td>        <b>if</b> (<a class="local col2 ref" href="#112msg" title='msg' data-ref="112msg">msg</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="669">669</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col9 ref" href="#109c" title='c' data-ref="109c">c</a>,(<em>char</em>*)<a class="local col2 ref" href="#112msg" title='msg' data-ref="112msg">msg</a>);</td></tr>
<tr><th id="670">670</th><td>        } <b>else</b> {</td></tr>
<tr><th id="671">671</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col9 ref" href="#109c" title='c' data-ref="109c">c</a>,<q>"value is out of range"</q>);</td></tr>
<tr><th id="672">672</th><td>        }</td></tr>
<tr><th id="673">673</th><td>        <b>return</b> <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>;</td></tr>
<tr><th id="674">674</th><td>    }</td></tr>
<tr><th id="675">675</th><td>    *<a class="local col1 ref" href="#111target" title='target' data-ref="111target">target</a> = <a class="local col3 ref" href="#113value" title='value' data-ref="113value">value</a>;</td></tr>
<tr><th id="676">676</th><td>    <b>return</b> <a class="macro" href="server.h.html#77" title="0" data-ref="_M/C_OK">C_OK</a>;</td></tr>
<tr><th id="677">677</th><td>}</td></tr>
<tr><th id="678">678</th><td></td></tr>
<tr><th id="679">679</th><td><em>char</em> *<dfn class="decl def" id="strEncoding" title='strEncoding' data-ref="strEncoding">strEncoding</dfn>(<em>int</em> <dfn class="local col4 decl" id="114encoding" title='encoding' data-type='int' data-ref="114encoding">encoding</dfn>) {</td></tr>
<tr><th id="680">680</th><td>    <b>switch</b>(<a class="local col4 ref" href="#114encoding" title='encoding' data-ref="114encoding">encoding</a>) {</td></tr>
<tr><th id="681">681</th><td>    <b>case</b> <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a>: <b>return</b> <q>"raw"</q>;</td></tr>
<tr><th id="682">682</th><td>    <b>case</b> <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>: <b>return</b> <q>"int"</q>;</td></tr>
<tr><th id="683">683</th><td>    <b>case</b> <a class="macro" href="server.h.html#570" title="2" data-ref="_M/OBJ_ENCODING_HT">OBJ_ENCODING_HT</a>: <b>return</b> <q>"hashtable"</q>;</td></tr>
<tr><th id="684">684</th><td>    <b>case</b> <a class="macro" href="server.h.html#577" title="9" data-ref="_M/OBJ_ENCODING_QUICKLIST">OBJ_ENCODING_QUICKLIST</a>: <b>return</b> <q>"quicklist"</q>;</td></tr>
<tr><th id="685">685</th><td>    <b>case</b> <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>: <b>return</b> <q>"ziplist"</q>;</td></tr>
<tr><th id="686">686</th><td>    <b>case</b> <a class="macro" href="server.h.html#574" title="6" data-ref="_M/OBJ_ENCODING_INTSET">OBJ_ENCODING_INTSET</a>: <b>return</b> <q>"intset"</q>;</td></tr>
<tr><th id="687">687</th><td>    <b>case</b> <a class="macro" href="server.h.html#575" title="7" data-ref="_M/OBJ_ENCODING_SKIPLIST">OBJ_ENCODING_SKIPLIST</a>: <b>return</b> <q>"skiplist"</q>;</td></tr>
<tr><th id="688">688</th><td>    <b>case</b> <a class="macro" href="server.h.html#576" title="8" data-ref="_M/OBJ_ENCODING_EMBSTR">OBJ_ENCODING_EMBSTR</a>: <b>return</b> <q>"embstr"</q>;</td></tr>
<tr><th id="689">689</th><td>    <b>default</b>: <b>return</b> <q>"unknown"</q>;</td></tr>
<tr><th id="690">690</th><td>    }</td></tr>
<tr><th id="691">691</th><td>}</td></tr>
<tr><th id="692">692</th><td></td></tr>
<tr><th id="693">693</th><td><i>/* =========================== Memory introspection ========================== */</i></td></tr>
<tr><th id="694">694</th><td></td></tr>
<tr><th id="695">695</th><td><i>/* Returns the size in bytes consumed by the key's value in RAM.</i></td></tr>
<tr><th id="696">696</th><td><i> * Note that the returned value is just an approximation, especially in the</i></td></tr>
<tr><th id="697">697</th><td><i> * case of aggregated data types where only "sample_size" elements</i></td></tr>
<tr><th id="698">698</th><td><i> * are checked and averaged to estimate the total size. */</i></td></tr>
<tr><th id="699">699</th><td><u>#define <dfn class="macro" id="_M/OBJ_COMPUTE_SIZE_DEF_SAMPLES" data-ref="_M/OBJ_COMPUTE_SIZE_DEF_SAMPLES">OBJ_COMPUTE_SIZE_DEF_SAMPLES</dfn> 5 /* Default sample size. */</u></td></tr>
<tr><th id="700">700</th><td><span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="decl def" id="objectComputeSize" title='objectComputeSize' data-ref="objectComputeSize">objectComputeSize</dfn>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col5 decl" id="115o" title='o' data-type='robj *' data-ref="115o">o</dfn>, <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col6 decl" id="116sample_size" title='sample_size' data-type='size_t' data-ref="116sample_size">sample_size</dfn>) {</td></tr>
<tr><th id="701">701</th><td>    <a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="local col7 decl" id="117ele" title='ele' data-type='sds' data-ref="117ele">ele</dfn>, <dfn class="local col8 decl" id="118ele2" title='ele2' data-type='sds' data-ref="118ele2">ele2</dfn>;</td></tr>
<tr><th id="702">702</th><td>    <a class="typedef" href="dict.h.html#dict" title='dict' data-type='struct dict' data-ref="dict">dict</a> *<dfn class="local col9 decl" id="119d" title='d' data-type='dict *' data-ref="119d">d</dfn>;</td></tr>
<tr><th id="703">703</th><td>    <a class="typedef" href="dict.h.html#dictIterator" title='dictIterator' data-type='struct dictIterator' data-ref="dictIterator">dictIterator</a> *<dfn class="local col0 decl" id="120di" title='di' data-type='dictIterator *' data-ref="120di">di</dfn>;</td></tr>
<tr><th id="704">704</th><td>    <b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a> *<dfn class="local col1 decl" id="121de" title='de' data-type='struct dictEntry *' data-ref="121de">de</dfn>;</td></tr>
<tr><th id="705">705</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col2 decl" id="122asize" title='asize' data-type='size_t' data-ref="122asize">asize</dfn> = <var>0</var>, <dfn class="local col3 decl" id="123elesize" title='elesize' data-type='size_t' data-ref="123elesize">elesize</dfn> = <var>0</var>, <dfn class="local col4 decl" id="124samples" title='samples' data-type='size_t' data-ref="124samples">samples</dfn> = <var>0</var>;</td></tr>
<tr><th id="706">706</th><td></td></tr>
<tr><th id="707">707</th><td>    <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#449" title="0" data-ref="_M/OBJ_STRING">OBJ_STRING</a>) {</td></tr>
<tr><th id="708">708</th><td>        <b>if</b>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#569" title="1" data-ref="_M/OBJ_ENCODING_INT">OBJ_ENCODING_INT</a>) {</td></tr>
<tr><th id="709">709</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>);</td></tr>
<tr><th id="710">710</th><td>        } <b>else</b> <b>if</b>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#568" title="0" data-ref="_M/OBJ_ENCODING_RAW">OBJ_ENCODING_RAW</a>) {</td></tr>
<tr><th id="711">711</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)+<b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>);</td></tr>
<tr><th id="712">712</th><td>        } <b>else</b> <b>if</b>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#576" title="8" data-ref="_M/OBJ_ENCODING_EMBSTR">OBJ_ENCODING_EMBSTR</a>) {</td></tr>
<tr><th id="713">713</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)+<var>2</var>+<b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>);</td></tr>
<tr><th id="714">714</th><td>        } <b>else</b> {</td></tr>
<tr><th id="715">715</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,715,&quot;Unknown string encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown string encoding"</q>);</td></tr>
<tr><th id="716">716</th><td>        }</td></tr>
<tr><th id="717">717</th><td>    } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#450" title="1" data-ref="_M/OBJ_LIST">OBJ_LIST</a>) {</td></tr>
<tr><th id="718">718</th><td>        <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#577" title="9" data-ref="_M/OBJ_ENCODING_QUICKLIST">OBJ_ENCODING_QUICKLIST</a>) {</td></tr>
<tr><th id="719">719</th><td>            <a class="typedef" href="quicklist.h.html#quicklist" title='quicklist' data-type='struct quicklist' data-ref="quicklist">quicklist</a> *<dfn class="local col5 decl" id="125ql" title='ql' data-type='quicklist *' data-ref="125ql">ql</dfn> = <a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="720">720</th><td>            <a class="typedef" href="quicklist.h.html#quicklistNode" title='quicklistNode' data-type='struct quicklistNode' data-ref="quicklistNode">quicklistNode</a> *<dfn class="local col6 decl" id="126node" title='node' data-type='quicklistNode *' data-ref="126node">node</dfn> = <a class="local col5 ref" href="#125ql" title='ql' data-ref="125ql">ql</a>-&gt;<a class="ref" href="quicklist.h.html#quicklist::head" title='quicklist::head' data-ref="quicklist::head">head</a>;</td></tr>
<tr><th id="721">721</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+<b>sizeof</b>(<a class="typedef" href="quicklist.h.html#quicklist" title='quicklist' data-type='struct quicklist' data-ref="quicklist">quicklist</a>);</td></tr>
<tr><th id="722">722</th><td>            <b>do</b> {</td></tr>
<tr><th id="723">723</th><td>                <a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a> += <b>sizeof</b>(<a class="typedef" href="quicklist.h.html#quicklistNode" title='quicklistNode' data-type='struct quicklistNode' data-ref="quicklistNode">quicklistNode</a>)+<a class="ref" href="ziplist.h.html#ziplistBlobLen" title='ziplistBlobLen' data-ref="ziplistBlobLen">ziplistBlobLen</a>(<a class="local col6 ref" href="#126node" title='node' data-ref="126node">node</a>-&gt;<a class="ref" href="quicklist.h.html#quicklistNode::zl" title='quicklistNode::zl' data-ref="quicklistNode::zl">zl</a>);</td></tr>
<tr><th id="724">724</th><td>                <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>++;</td></tr>
<tr><th id="725">725</th><td>            } <b>while</b> ((<a class="local col6 ref" href="#126node" title='node' data-ref="126node">node</a> = <a class="local col6 ref" href="#126node" title='node' data-ref="126node">node</a>-&gt;<a class="ref" href="quicklist.h.html#quicklistNode::next" title='quicklistNode::next' data-ref="quicklistNode::next">next</a>) &amp;&amp; <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a> &lt; <a class="local col6 ref" href="#116sample_size" title='sample_size' data-ref="116sample_size">sample_size</a>);</td></tr>
<tr><th id="726">726</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> += (<em>double</em>)<a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a>/<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>*<a class="ref" href="server.h.html#listTypeLength" title='listTypeLength' data-ref="listTypeLength">listTypeLength</a>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>);</td></tr>
<tr><th id="727">727</th><td>        } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>) {</td></tr>
<tr><th id="728">728</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+<a class="ref" href="ziplist.h.html#ziplistBlobLen" title='ziplistBlobLen' data-ref="ziplistBlobLen">ziplistBlobLen</a>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="729">729</th><td>        } <b>else</b> {</td></tr>
<tr><th id="730">730</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,730,&quot;Unknown list encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown list encoding"</q>);</td></tr>
<tr><th id="731">731</th><td>        }</td></tr>
<tr><th id="732">732</th><td>    } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#451" title="2" data-ref="_M/OBJ_SET">OBJ_SET</a>) {</td></tr>
<tr><th id="733">733</th><td>        <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#570" title="2" data-ref="_M/OBJ_ENCODING_HT">OBJ_ENCODING_HT</a>) {</td></tr>
<tr><th id="734">734</th><td>            <a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a> = <a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="735">735</th><td>            <a class="local col0 ref" href="#120di" title='di' data-ref="120di">di</a> = <a class="ref" href="dict.h.html#dictGetIterator" title='dictGetIterator' data-ref="dictGetIterator">dictGetIterator</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>);</td></tr>
<tr><th id="736">736</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+<b>sizeof</b>(<a class="typedef" href="dict.h.html#dict" title='dict' data-type='struct dict' data-ref="dict">dict</a>)+(<b>sizeof</b>(<b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a>*)*<a class="macro" href="dict.h.html#146" title="((d)-&gt;ht[0].size+(d)-&gt;ht[1].size)" data-ref="_M/dictSlots">dictSlots</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>));</td></tr>
<tr><th id="737">737</th><td>            <b>while</b>((<a class="local col1 ref" href="#121de" title='de' data-ref="121de">de</a> = <a class="ref" href="dict.h.html#dictNext" title='dictNext' data-ref="dictNext">dictNext</a>(<a class="local col0 ref" href="#120di" title='di' data-ref="120di">di</a>)) != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> &amp;&amp; <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a> &lt; <a class="local col6 ref" href="#116sample_size" title='sample_size' data-ref="116sample_size">sample_size</a>) {</td></tr>
<tr><th id="738">738</th><td>                <a class="local col7 ref" href="#117ele" title='ele' data-ref="117ele">ele</a> = <a class="macro" href="dict.h.html#141" title="((de)-&gt;key)" data-ref="_M/dictGetKey">dictGetKey</a>(<a class="local col1 ref" href="#121de" title='de' data-ref="121de">de</a>);</td></tr>
<tr><th id="739">739</th><td>                <a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a> += <b>sizeof</b>(<b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a>) + <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col7 ref" href="#117ele" title='ele' data-ref="117ele">ele</a>);</td></tr>
<tr><th id="740">740</th><td>                <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>++;</td></tr>
<tr><th id="741">741</th><td>            }</td></tr>
<tr><th id="742">742</th><td>            <a class="ref" href="dict.h.html#dictReleaseIterator" title='dictReleaseIterator' data-ref="dictReleaseIterator">dictReleaseIterator</a>(<a class="local col0 ref" href="#120di" title='di' data-ref="120di">di</a>);</td></tr>
<tr><th id="743">743</th><td>            <b>if</b> (<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>) <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> += (<em>double</em>)<a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a>/<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>*<a class="macro" href="dict.h.html#147" title="((d)-&gt;ht[0].used+(d)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>);</td></tr>
<tr><th id="744">744</th><td>        } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#574" title="6" data-ref="_M/OBJ_ENCODING_INTSET">OBJ_ENCODING_INTSET</a>) {</td></tr>
<tr><th id="745">745</th><td>            <a class="typedef" href="intset.h.html#intset" title='intset' data-type='struct intset' data-ref="intset">intset</a> *<dfn class="local col7 decl" id="127is" title='is' data-type='intset *' data-ref="127is">is</dfn> = <a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="746">746</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+<b>sizeof</b>(*<a class="local col7 ref" href="#127is" title='is' data-ref="127is">is</a>)+<a class="local col7 ref" href="#127is" title='is' data-ref="127is">is</a>-&gt;<a class="ref" href="intset.h.html#intset::encoding" title='intset::encoding' data-ref="intset::encoding">encoding</a>*<a class="local col7 ref" href="#127is" title='is' data-ref="127is">is</a>-&gt;<a class="ref" href="intset.h.html#intset::length" title='intset::length' data-ref="intset::length">length</a>;</td></tr>
<tr><th id="747">747</th><td>        } <b>else</b> {</td></tr>
<tr><th id="748">748</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,748,&quot;Unknown set encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown set encoding"</q>);</td></tr>
<tr><th id="749">749</th><td>        }</td></tr>
<tr><th id="750">750</th><td>    } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#452" title="3" data-ref="_M/OBJ_ZSET">OBJ_ZSET</a>) {</td></tr>
<tr><th id="751">751</th><td>        <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>) {</td></tr>
<tr><th id="752">752</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+(<a class="ref" href="ziplist.h.html#ziplistBlobLen" title='ziplistBlobLen' data-ref="ziplistBlobLen">ziplistBlobLen</a>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>));</td></tr>
<tr><th id="753">753</th><td>        } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#575" title="7" data-ref="_M/OBJ_ENCODING_SKIPLIST">OBJ_ENCODING_SKIPLIST</a>) {</td></tr>
<tr><th id="754">754</th><td>            <a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a> = ((<a class="typedef" href="server.h.html#zset" title='zset' data-type='struct zset' data-ref="zset">zset</a>*)<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)-&gt;<a class="ref" href="server.h.html#zset::dict" title='zset::dict' data-ref="zset::dict">dict</a>;</td></tr>
<tr><th id="755">755</th><td>            <a class="typedef" href="server.h.html#zskiplist" title='zskiplist' data-type='struct zskiplist' data-ref="zskiplist">zskiplist</a> *<dfn class="local col8 decl" id="128zsl" title='zsl' data-type='zskiplist *' data-ref="128zsl">zsl</dfn> = ((<a class="typedef" href="server.h.html#zset" title='zset' data-type='struct zset' data-ref="zset">zset</a>*)<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)-&gt;<a class="ref" href="server.h.html#zset::zsl" title='zset::zsl' data-ref="zset::zsl">zsl</a>;</td></tr>
<tr><th id="756">756</th><td>            <a class="typedef" href="server.h.html#zskiplistNode" title='zskiplistNode' data-type='struct zskiplistNode' data-ref="zskiplistNode">zskiplistNode</a> *<dfn class="local col9 decl" id="129znode" title='znode' data-type='zskiplistNode *' data-ref="129znode">znode</dfn> = <a class="local col8 ref" href="#128zsl" title='zsl' data-ref="128zsl">zsl</a>-&gt;<a class="ref" href="server.h.html#zskiplist::header" title='zskiplist::header' data-ref="zskiplist::header">header</a>-&gt;<a class="ref" href="server.h.html#zskiplistNode::level" title='zskiplistNode::level' data-ref="zskiplistNode::level">level</a>[<var>0</var>].<a class="ref" href="server.h.html#zskiplistLevel::forward" title='zskiplistLevel::forward' data-ref="zskiplistLevel::forward">forward</a>;</td></tr>
<tr><th id="757">757</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+<b>sizeof</b>(<a class="typedef" href="server.h.html#zset" title='zset' data-type='struct zset' data-ref="zset">zset</a>)+(<b>sizeof</b>(<b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a>*)*<a class="macro" href="dict.h.html#146" title="((d)-&gt;ht[0].size+(d)-&gt;ht[1].size)" data-ref="_M/dictSlots">dictSlots</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>));</td></tr>
<tr><th id="758">758</th><td>            <b>while</b>(<a class="local col9 ref" href="#129znode" title='znode' data-ref="129znode">znode</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> &amp;&amp; <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a> &lt; <a class="local col6 ref" href="#116sample_size" title='sample_size' data-ref="116sample_size">sample_size</a>) {</td></tr>
<tr><th id="759">759</th><td>                <a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a> += <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col9 ref" href="#129znode" title='znode' data-ref="129znode">znode</a>-&gt;<a class="ref" href="server.h.html#zskiplistNode::ele" title='zskiplistNode::ele' data-ref="zskiplistNode::ele">ele</a>);</td></tr>
<tr><th id="760">760</th><td>                <a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a> += <b>sizeof</b>(<b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a>) + <a class="macro" href="zmalloc.h.html#53" title="je_malloc_usable_size(znode)" data-ref="_M/zmalloc_size">zmalloc_size</a>(<a class="local col9 ref" href="#129znode" title='znode' data-ref="129znode">znode</a>);</td></tr>
<tr><th id="761">761</th><td>                <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>++;</td></tr>
<tr><th id="762">762</th><td>                <a class="local col9 ref" href="#129znode" title='znode' data-ref="129znode">znode</a> = <a class="local col9 ref" href="#129znode" title='znode' data-ref="129znode">znode</a>-&gt;<a class="ref" href="server.h.html#zskiplistNode::level" title='zskiplistNode::level' data-ref="zskiplistNode::level">level</a>[<var>0</var>].<a class="ref" href="server.h.html#zskiplistLevel::forward" title='zskiplistLevel::forward' data-ref="zskiplistLevel::forward">forward</a>;</td></tr>
<tr><th id="763">763</th><td>            }</td></tr>
<tr><th id="764">764</th><td>            <b>if</b> (<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>) <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> += (<em>double</em>)<a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a>/<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>*<a class="macro" href="dict.h.html#147" title="((d)-&gt;ht[0].used+(d)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>);</td></tr>
<tr><th id="765">765</th><td>        } <b>else</b> {</td></tr>
<tr><th id="766">766</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,766,&quot;Unknown sorted set encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown sorted set encoding"</q>);</td></tr>
<tr><th id="767">767</th><td>        }</td></tr>
<tr><th id="768">768</th><td>    } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#453" title="4" data-ref="_M/OBJ_HASH">OBJ_HASH</a>) {</td></tr>
<tr><th id="769">769</th><td>        <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#573" title="5" data-ref="_M/OBJ_ENCODING_ZIPLIST">OBJ_ENCODING_ZIPLIST</a>) {</td></tr>
<tr><th id="770">770</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+(<a class="ref" href="ziplist.h.html#ziplistBlobLen" title='ziplistBlobLen' data-ref="ziplistBlobLen">ziplistBlobLen</a>(<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>));</td></tr>
<tr><th id="771">771</th><td>        } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a> == <a class="macro" href="server.h.html#570" title="2" data-ref="_M/OBJ_ENCODING_HT">OBJ_ENCODING_HT</a>) {</td></tr>
<tr><th id="772">772</th><td>            <a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a> = <a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="773">773</th><td>            <a class="local col0 ref" href="#120di" title='di' data-ref="120di">di</a> = <a class="ref" href="dict.h.html#dictGetIterator" title='dictGetIterator' data-ref="dictGetIterator">dictGetIterator</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>);</td></tr>
<tr><th id="774">774</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <b>sizeof</b>(*<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>)+<b>sizeof</b>(<a class="typedef" href="dict.h.html#dict" title='dict' data-type='struct dict' data-ref="dict">dict</a>)+(<b>sizeof</b>(<b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a>*)*<a class="macro" href="dict.h.html#146" title="((d)-&gt;ht[0].size+(d)-&gt;ht[1].size)" data-ref="_M/dictSlots">dictSlots</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>));</td></tr>
<tr><th id="775">775</th><td>            <b>while</b>((<a class="local col1 ref" href="#121de" title='de' data-ref="121de">de</a> = <a class="ref" href="dict.h.html#dictNext" title='dictNext' data-ref="dictNext">dictNext</a>(<a class="local col0 ref" href="#120di" title='di' data-ref="120di">di</a>)) != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> &amp;&amp; <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a> &lt; <a class="local col6 ref" href="#116sample_size" title='sample_size' data-ref="116sample_size">sample_size</a>) {</td></tr>
<tr><th id="776">776</th><td>                <a class="local col7 ref" href="#117ele" title='ele' data-ref="117ele">ele</a> = <a class="macro" href="dict.h.html#141" title="((de)-&gt;key)" data-ref="_M/dictGetKey">dictGetKey</a>(<a class="local col1 ref" href="#121de" title='de' data-ref="121de">de</a>);</td></tr>
<tr><th id="777">777</th><td>                <a class="local col8 ref" href="#118ele2" title='ele2' data-ref="118ele2">ele2</a> = <a class="macro" href="dict.h.html#142" title="((de)-&gt;v.val)" data-ref="_M/dictGetVal">dictGetVal</a>(<a class="local col1 ref" href="#121de" title='de' data-ref="121de">de</a>);</td></tr>
<tr><th id="778">778</th><td>                <a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a> += <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col7 ref" href="#117ele" title='ele' data-ref="117ele">ele</a>) + <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col8 ref" href="#118ele2" title='ele2' data-ref="118ele2">ele2</a>);</td></tr>
<tr><th id="779">779</th><td>                <a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a> += <b>sizeof</b>(<b>struct</b> <a class="type" href="dict.h.html#dictEntry" title='dictEntry' data-ref="dictEntry">dictEntry</a>);</td></tr>
<tr><th id="780">780</th><td>                <a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>++;</td></tr>
<tr><th id="781">781</th><td>            }</td></tr>
<tr><th id="782">782</th><td>            <a class="ref" href="dict.h.html#dictReleaseIterator" title='dictReleaseIterator' data-ref="dictReleaseIterator">dictReleaseIterator</a>(<a class="local col0 ref" href="#120di" title='di' data-ref="120di">di</a>);</td></tr>
<tr><th id="783">783</th><td>            <b>if</b> (<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>) <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> += (<em>double</em>)<a class="local col3 ref" href="#123elesize" title='elesize' data-ref="123elesize">elesize</a>/<a class="local col4 ref" href="#124samples" title='samples' data-ref="124samples">samples</a>*<a class="macro" href="dict.h.html#147" title="((d)-&gt;ht[0].used+(d)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col9 ref" href="#119d" title='d' data-ref="119d">d</a>);</td></tr>
<tr><th id="784">784</th><td>        } <b>else</b> {</td></tr>
<tr><th id="785">785</th><td>            <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,785,&quot;Unknown hash encoding&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown hash encoding"</q>);</td></tr>
<tr><th id="786">786</th><td>        }</td></tr>
<tr><th id="787">787</th><td>    } <b>else</b> <b>if</b> (<a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::type" title='redisObject::type' data-ref="redisObject::type">type</a> == <a class="macro" href="server.h.html#466" title="5" data-ref="_M/OBJ_MODULE">OBJ_MODULE</a>) {</td></tr>
<tr><th id="788">788</th><td>        <a class="typedef" href="server.h.html#moduleValue" title='moduleValue' data-type='struct moduleValue' data-ref="moduleValue">moduleValue</a> *<dfn class="local col0 decl" id="130mv" title='mv' data-type='moduleValue *' data-ref="130mv">mv</dfn> = <a class="local col5 ref" href="#115o" title='o' data-ref="115o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>;</td></tr>
<tr><th id="789">789</th><td>        <a class="typedef" href="server.h.html#moduleType" title='moduleType' data-type='struct RedisModuleType' data-ref="moduleType">moduleType</a> *<dfn class="local col1 decl" id="131mt" title='mt' data-type='moduleType *' data-ref="131mt">mt</dfn> = <a class="local col0 ref" href="#130mv" title='mv' data-ref="130mv">mv</a>-&gt;<a class="ref" href="server.h.html#moduleValue::type" title='moduleValue::type' data-ref="moduleValue::type">type</a>;</td></tr>
<tr><th id="790">790</th><td>        <b>if</b> (<a class="local col1 ref" href="#131mt" title='mt' data-ref="131mt">mt</a>-&gt;<a class="ref" href="server.h.html#RedisModuleType::mem_usage" title='RedisModuleType::mem_usage' data-ref="RedisModuleType::mem_usage">mem_usage</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="791">791</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <a class="local col1 ref" href="#131mt" title='mt' data-ref="131mt">mt</a>-&gt;<a class="ref" href="server.h.html#RedisModuleType::mem_usage" title='RedisModuleType::mem_usage' data-ref="RedisModuleType::mem_usage">mem_usage</a>(<a class="local col0 ref" href="#130mv" title='mv' data-ref="130mv">mv</a>-&gt;<a class="ref" href="server.h.html#moduleValue::value" title='moduleValue::value' data-ref="moduleValue::value">value</a>);</td></tr>
<tr><th id="792">792</th><td>        } <b>else</b> {</td></tr>
<tr><th id="793">793</th><td>            <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a> = <var>0</var>;</td></tr>
<tr><th id="794">794</th><td>        }</td></tr>
<tr><th id="795">795</th><td>    } <b>else</b> {</td></tr>
<tr><th id="796">796</th><td>        <a class="macro" href="server.h.html#440" title="_serverPanic(&quot;/home/jon/workspace/redis/src/object.c&quot;,796,&quot;Unknown object type&quot;),_exit(1)" data-ref="_M/serverPanic">serverPanic</a>(<q>"Unknown object type"</q>);</td></tr>
<tr><th id="797">797</th><td>    }</td></tr>
<tr><th id="798">798</th><td>    <b>return</b> <a class="local col2 ref" href="#122asize" title='asize' data-ref="122asize">asize</a>;</td></tr>
<tr><th id="799">799</th><td>}</td></tr>
<tr><th id="800">800</th><td></td></tr>
<tr><th id="801">801</th><td><i>/* Release data obtained with getMemoryOverheadData(). */</i></td></tr>
<tr><th id="802">802</th><td><em>void</em> <dfn class="decl def" id="freeMemoryOverheadData" title='freeMemoryOverheadData' data-ref="freeMemoryOverheadData">freeMemoryOverheadData</dfn>(<b>struct</b> <a class="type" href="server.h.html#redisMemOverhead" title='redisMemOverhead' data-ref="redisMemOverhead">redisMemOverhead</a> *<dfn class="local col2 decl" id="132mh" title='mh' data-type='struct redisMemOverhead *' data-ref="132mh">mh</dfn>) {</td></tr>
<tr><th id="803">803</th><td>    <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col2 ref" href="#132mh" title='mh' data-ref="132mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>);</td></tr>
<tr><th id="804">804</th><td>    <a class="ref" href="zmalloc.h.html#zfree" title='zfree' data-ref="zfree">zfree</a>(<a class="local col2 ref" href="#132mh" title='mh' data-ref="132mh">mh</a>);</td></tr>
<tr><th id="805">805</th><td>}</td></tr>
<tr><th id="806">806</th><td></td></tr>
<tr><th id="807">807</th><td><i>/* Return a struct redisMemOverhead filled with memory overhead</i></td></tr>
<tr><th id="808">808</th><td><i> * information used for the MEMORY OVERHEAD and INFO command. The returned</i></td></tr>
<tr><th id="809">809</th><td><i> * structure pointer should be freed calling freeMemoryOverheadData(). */</i></td></tr>
<tr><th id="810">810</th><td><b>struct</b> <a class="type" href="server.h.html#redisMemOverhead" title='redisMemOverhead' data-ref="redisMemOverhead">redisMemOverhead</a> *<dfn class="decl def" id="getMemoryOverheadData" title='getMemoryOverheadData' data-ref="getMemoryOverheadData">getMemoryOverheadData</dfn>(<em>void</em>) {</td></tr>
<tr><th id="811">811</th><td>    <em>int</em> <dfn class="local col3 decl" id="133j" title='j' data-type='int' data-ref="133j">j</dfn>;</td></tr>
<tr><th id="812">812</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col4 decl" id="134mem_total" title='mem_total' data-type='size_t' data-ref="134mem_total">mem_total</dfn> = <var>0</var>;</td></tr>
<tr><th id="813">813</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col5 decl" id="135mem" title='mem' data-type='size_t' data-ref="135mem">mem</dfn> = <var>0</var>;</td></tr>
<tr><th id="814">814</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col6 decl" id="136zmalloc_used" title='zmalloc_used' data-type='size_t' data-ref="136zmalloc_used">zmalloc_used</dfn> = <a class="ref" href="zmalloc.h.html#zmalloc_used_memory" title='zmalloc_used_memory' data-ref="zmalloc_used_memory">zmalloc_used_memory</a>();</td></tr>
<tr><th id="815">815</th><td>    <b>struct</b> <a class="type" href="server.h.html#redisMemOverhead" title='redisMemOverhead' data-ref="redisMemOverhead">redisMemOverhead</a> *<dfn class="local col7 decl" id="137mh" title='mh' data-type='struct redisMemOverhead *' data-ref="137mh">mh</dfn> = <a class="ref" href="zmalloc.h.html#zcalloc" title='zcalloc' data-ref="zcalloc">zcalloc</a>(<b>sizeof</b>(*<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>));</td></tr>
<tr><th id="816">816</th><td></td></tr>
<tr><th id="817">817</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_allocated" title='redisMemOverhead::total_allocated' data-ref="redisMemOverhead::total_allocated">total_allocated</a> = <a class="local col6 ref" href="#136zmalloc_used" title='zmalloc_used' data-ref="136zmalloc_used">zmalloc_used</a>;</td></tr>
<tr><th id="818">818</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::startup_allocated" title='redisMemOverhead::startup_allocated' data-ref="redisMemOverhead::startup_allocated">startup_allocated</a> = <a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::initial_memory_usage" title='redisServer::initial_memory_usage' data-ref="redisServer::initial_memory_usage">initial_memory_usage</a>;</td></tr>
<tr><th id="819">819</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::peak_allocated" title='redisMemOverhead::peak_allocated' data-ref="redisMemOverhead::peak_allocated">peak_allocated</a> = <a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::stat_peak_memory" title='redisServer::stat_peak_memory' data-ref="redisServer::stat_peak_memory">stat_peak_memory</a>;</td></tr>
<tr><th id="820">820</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::fragmentation" title='redisMemOverhead::fragmentation' data-ref="redisMemOverhead::fragmentation">fragmentation</a> =</td></tr>
<tr><th id="821">821</th><td>        <a class="ref" href="zmalloc.h.html#zmalloc_get_fragmentation_ratio" title='zmalloc_get_fragmentation_ratio' data-ref="zmalloc_get_fragmentation_ratio">zmalloc_get_fragmentation_ratio</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::resident_set_size" title='redisServer::resident_set_size' data-ref="redisServer::resident_set_size">resident_set_size</a>);</td></tr>
<tr><th id="822">822</th><td>    <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a> += <a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::initial_memory_usage" title='redisServer::initial_memory_usage' data-ref="redisServer::initial_memory_usage">initial_memory_usage</a>;</td></tr>
<tr><th id="823">823</th><td></td></tr>
<tr><th id="824">824</th><td>    <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> = <var>0</var>;</td></tr>
<tr><th id="825">825</th><td>    <b>if</b> (<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::repl_backlog" title='redisServer::repl_backlog' data-ref="redisServer::repl_backlog">repl_backlog</a>)</td></tr>
<tr><th id="826">826</th><td>        <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="macro" href="zmalloc.h.html#53" title="je_malloc_usable_size(server.repl_backlog)" data-ref="_M/zmalloc_size">zmalloc_size</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::repl_backlog" title='redisServer::repl_backlog' data-ref="redisServer::repl_backlog">repl_backlog</a>);</td></tr>
<tr><th id="827">827</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::repl_backlog" title='redisMemOverhead::repl_backlog' data-ref="redisMemOverhead::repl_backlog">repl_backlog</a> = <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="828">828</th><td>    <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a> += <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="829">829</th><td></td></tr>
<tr><th id="830">830</th><td>    <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> = <var>0</var>;</td></tr>
<tr><th id="831">831</th><td>    <b>if</b> (<a class="macro" href="adlist.h.html#57" title="((server.slaves)-&gt;len)" data-ref="_M/listLength">listLength</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::slaves" title='redisServer::slaves' data-ref="redisServer::slaves">slaves</a>)) {</td></tr>
<tr><th id="832">832</th><td>        <a class="typedef" href="adlist.h.html#listIter" title='listIter' data-type='struct listIter' data-ref="listIter">listIter</a> <dfn class="local col8 decl" id="138li" title='li' data-type='listIter' data-ref="138li">li</dfn>;</td></tr>
<tr><th id="833">833</th><td>        <a class="typedef" href="adlist.h.html#listNode" title='listNode' data-type='struct listNode' data-ref="listNode">listNode</a> *<dfn class="local col9 decl" id="139ln" title='ln' data-type='listNode *' data-ref="139ln">ln</dfn>;</td></tr>
<tr><th id="834">834</th><td></td></tr>
<tr><th id="835">835</th><td>        <a class="ref" href="adlist.h.html#listRewind" title='listRewind' data-ref="listRewind">listRewind</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::slaves" title='redisServer::slaves' data-ref="redisServer::slaves">slaves</a>,&amp;<a class="local col8 ref" href="#138li" title='li' data-ref="138li">li</a>);</td></tr>
<tr><th id="836">836</th><td>        <b>while</b>((<a class="local col9 ref" href="#139ln" title='ln' data-ref="139ln">ln</a> = <a class="ref" href="adlist.h.html#listNext" title='listNext' data-ref="listNext">listNext</a>(&amp;<a class="local col8 ref" href="#138li" title='li' data-ref="138li">li</a>))) {</td></tr>
<tr><th id="837">837</th><td>            <a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col0 decl" id="140c" title='c' data-type='client *' data-ref="140c">c</dfn> = <a class="macro" href="adlist.h.html#62" title="((ln)-&gt;value)" data-ref="_M/listNodeValue">listNodeValue</a>(<a class="local col9 ref" href="#139ln" title='ln' data-ref="139ln">ln</a>);</td></tr>
<tr><th id="838">838</th><td>            <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="ref" href="server.h.html#getClientOutputBufferMemoryUsage" title='getClientOutputBufferMemoryUsage' data-ref="getClientOutputBufferMemoryUsage">getClientOutputBufferMemoryUsage</a>(<a class="local col0 ref" href="#140c" title='c' data-ref="140c">c</a>);</td></tr>
<tr><th id="839">839</th><td>            <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col0 ref" href="#140c" title='c' data-ref="140c">c</a>-&gt;<a class="ref" href="server.h.html#client::querybuf" title='client::querybuf' data-ref="client::querybuf">querybuf</a>);</td></tr>
<tr><th id="840">840</th><td>            <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <b>sizeof</b>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a>);</td></tr>
<tr><th id="841">841</th><td>        }</td></tr>
<tr><th id="842">842</th><td>    }</td></tr>
<tr><th id="843">843</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::clients_slaves" title='redisMemOverhead::clients_slaves' data-ref="redisMemOverhead::clients_slaves">clients_slaves</a> = <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="844">844</th><td>    <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>+=<a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="845">845</th><td></td></tr>
<tr><th id="846">846</th><td>    <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> = <var>0</var>;</td></tr>
<tr><th id="847">847</th><td>    <b>if</b> (<a class="macro" href="adlist.h.html#57" title="((server.clients)-&gt;len)" data-ref="_M/listLength">listLength</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::clients" title='redisServer::clients' data-ref="redisServer::clients">clients</a>)) {</td></tr>
<tr><th id="848">848</th><td>        <a class="typedef" href="adlist.h.html#listIter" title='listIter' data-type='struct listIter' data-ref="listIter">listIter</a> <dfn class="local col1 decl" id="141li" title='li' data-type='listIter' data-ref="141li">li</dfn>;</td></tr>
<tr><th id="849">849</th><td>        <a class="typedef" href="adlist.h.html#listNode" title='listNode' data-type='struct listNode' data-ref="listNode">listNode</a> *<dfn class="local col2 decl" id="142ln" title='ln' data-type='listNode *' data-ref="142ln">ln</dfn>;</td></tr>
<tr><th id="850">850</th><td></td></tr>
<tr><th id="851">851</th><td>        <a class="ref" href="adlist.h.html#listRewind" title='listRewind' data-ref="listRewind">listRewind</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::clients" title='redisServer::clients' data-ref="redisServer::clients">clients</a>,&amp;<a class="local col1 ref" href="#141li" title='li' data-ref="141li">li</a>);</td></tr>
<tr><th id="852">852</th><td>        <b>while</b>((<a class="local col2 ref" href="#142ln" title='ln' data-ref="142ln">ln</a> = <a class="ref" href="adlist.h.html#listNext" title='listNext' data-ref="listNext">listNext</a>(&amp;<a class="local col1 ref" href="#141li" title='li' data-ref="141li">li</a>))) {</td></tr>
<tr><th id="853">853</th><td>            <a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col3 decl" id="143c" title='c' data-type='client *' data-ref="143c">c</dfn> = <a class="macro" href="adlist.h.html#62" title="((ln)-&gt;value)" data-ref="_M/listNodeValue">listNodeValue</a>(<a class="local col2 ref" href="#142ln" title='ln' data-ref="142ln">ln</a>);</td></tr>
<tr><th id="854">854</th><td>            <b>if</b> (<a class="local col3 ref" href="#143c" title='c' data-ref="143c">c</a>-&gt;<a class="ref" href="server.h.html#client::flags" title='client::flags' data-ref="client::flags">flags</a> &amp; <a class="macro" href="server.h.html#220" title="(1&lt;&lt;0)" data-ref="_M/CLIENT_SLAVE">CLIENT_SLAVE</a>)</td></tr>
<tr><th id="855">855</th><td>                <b>continue</b>;</td></tr>
<tr><th id="856">856</th><td>            <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="ref" href="server.h.html#getClientOutputBufferMemoryUsage" title='getClientOutputBufferMemoryUsage' data-ref="getClientOutputBufferMemoryUsage">getClientOutputBufferMemoryUsage</a>(<a class="local col3 ref" href="#143c" title='c' data-ref="143c">c</a>);</td></tr>
<tr><th id="857">857</th><td>            <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col3 ref" href="#143c" title='c' data-ref="143c">c</a>-&gt;<a class="ref" href="server.h.html#client::querybuf" title='client::querybuf' data-ref="client::querybuf">querybuf</a>);</td></tr>
<tr><th id="858">858</th><td>            <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <b>sizeof</b>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a>);</td></tr>
<tr><th id="859">859</th><td>        }</td></tr>
<tr><th id="860">860</th><td>    }</td></tr>
<tr><th id="861">861</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::clients_normal" title='redisMemOverhead::clients_normal' data-ref="redisMemOverhead::clients_normal">clients_normal</a> = <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="862">862</th><td>    <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>+=<a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="863">863</th><td></td></tr>
<tr><th id="864">864</th><td>    <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> = <var>0</var>;</td></tr>
<tr><th id="865">865</th><td>    <b>if</b> (<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::aof_state" title='redisServer::aof_state' data-ref="redisServer::aof_state">aof_state</a> != <a class="macro" href="server.h.html#215" title="0" data-ref="_M/AOF_OFF">AOF_OFF</a>) {</td></tr>
<tr><th id="866">866</th><td>        <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="ref" href="sds.h.html#sdslen" title='sdslen' data-ref="sdslen">sdslen</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::aof_buf" title='redisServer::aof_buf' data-ref="redisServer::aof_buf">aof_buf</a>);</td></tr>
<tr><th id="867">867</th><td>        <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> += <a class="ref" href="server.h.html#aofRewriteBufferSize" title='aofRewriteBufferSize' data-ref="aofRewriteBufferSize">aofRewriteBufferSize</a>();</td></tr>
<tr><th id="868">868</th><td>    }</td></tr>
<tr><th id="869">869</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::aof_buffer" title='redisMemOverhead::aof_buffer' data-ref="redisMemOverhead::aof_buffer">aof_buffer</a> = <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="870">870</th><td>    <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>+=<a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="871">871</th><td></td></tr>
<tr><th id="872">872</th><td>    <b>for</b> (<a class="local col3 ref" href="#133j" title='j' data-ref="133j">j</a> = <var>0</var>; <a class="local col3 ref" href="#133j" title='j' data-ref="133j">j</a> &lt; <a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::dbnum" title='redisServer::dbnum' data-ref="redisServer::dbnum">dbnum</a>; <a class="local col3 ref" href="#133j" title='j' data-ref="133j">j</a>++) {</td></tr>
<tr><th id="873">873</th><td>        <a class="typedef" href="server.h.html#redisDb" title='redisDb' data-type='struct redisDb' data-ref="redisDb">redisDb</a> *<dfn class="local col4 decl" id="144db" title='db' data-type='redisDb *' data-ref="144db">db</dfn> = <a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::db" title='redisServer::db' data-ref="redisServer::db">db</a>+<a class="local col3 ref" href="#133j" title='j' data-ref="133j">j</a>;</td></tr>
<tr><th id="874">874</th><td>        <em>long</em> <em>long</em> <dfn class="local col5 decl" id="145keyscount" title='keyscount' data-type='long long' data-ref="145keyscount">keyscount</dfn> = <a class="macro" href="dict.h.html#147" title="((db-&gt;dict)-&gt;ht[0].used+(db-&gt;dict)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col4 ref" href="#144db" title='db' data-ref="144db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::dict" title='redisDb::dict' data-ref="redisDb::dict">dict</a>);</td></tr>
<tr><th id="875">875</th><td>        <b>if</b> (<a class="local col5 ref" href="#145keyscount" title='keyscount' data-ref="145keyscount">keyscount</a>==<var>0</var>) <b>continue</b>;</td></tr>
<tr><th id="876">876</th><td></td></tr>
<tr><th id="877">877</th><td>        <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_keys" title='redisMemOverhead::total_keys' data-ref="redisMemOverhead::total_keys">total_keys</a> += <a class="local col5 ref" href="#145keyscount" title='keyscount' data-ref="145keyscount">keyscount</a>;</td></tr>
<tr><th id="878">878</th><td>        <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a> = <a class="ref" href="zmalloc.h.html#zrealloc" title='zrealloc' data-ref="zrealloc">zrealloc</a>(<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>,<b>sizeof</b>(<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<var>0</var>])*(<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>+<var>1</var>));</td></tr>
<tr><th id="879">879</th><td>        <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>].<a class="ref" href="server.h.html#redisMemOverhead::(anonymous)::dbid" title='redisMemOverhead::(anonymous struct)::dbid' data-ref="redisMemOverhead::(anonymous)::dbid">dbid</a> = <a class="local col3 ref" href="#133j" title='j' data-ref="133j">j</a>;</td></tr>
<tr><th id="880">880</th><td></td></tr>
<tr><th id="881">881</th><td>        <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> = <a class="macro" href="dict.h.html#147" title="((db-&gt;dict)-&gt;ht[0].used+(db-&gt;dict)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col4 ref" href="#144db" title='db' data-ref="144db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::dict" title='redisDb::dict' data-ref="redisDb::dict">dict</a>) * <b>sizeof</b>(<a class="typedef" href="dict.h.html#dictEntry" title='dictEntry' data-type='struct dictEntry' data-ref="dictEntry">dictEntry</a>) +</td></tr>
<tr><th id="882">882</th><td>              <a class="macro" href="dict.h.html#146" title="((db-&gt;dict)-&gt;ht[0].size+(db-&gt;dict)-&gt;ht[1].size)" data-ref="_M/dictSlots">dictSlots</a>(<a class="local col4 ref" href="#144db" title='db' data-ref="144db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::dict" title='redisDb::dict' data-ref="redisDb::dict">dict</a>) * <b>sizeof</b>(<a class="typedef" href="dict.h.html#dictEntry" title='dictEntry' data-type='struct dictEntry' data-ref="dictEntry">dictEntry</a>*) +</td></tr>
<tr><th id="883">883</th><td>              <a class="macro" href="dict.h.html#147" title="((db-&gt;dict)-&gt;ht[0].used+(db-&gt;dict)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col4 ref" href="#144db" title='db' data-ref="144db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::dict" title='redisDb::dict' data-ref="redisDb::dict">dict</a>) * <b>sizeof</b>(<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a>);</td></tr>
<tr><th id="884">884</th><td>        <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>].<a class="ref" href="server.h.html#redisMemOverhead::(anonymous)::overhead_ht_main" title='redisMemOverhead::(anonymous struct)::overhead_ht_main' data-ref="redisMemOverhead::(anonymous)::overhead_ht_main">overhead_ht_main</a> = <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="885">885</th><td>        <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>+=<a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="886">886</th><td></td></tr>
<tr><th id="887">887</th><td>        <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a> = <a class="macro" href="dict.h.html#147" title="((db-&gt;expires)-&gt;ht[0].used+(db-&gt;expires)-&gt;ht[1].used)" data-ref="_M/dictSize">dictSize</a>(<a class="local col4 ref" href="#144db" title='db' data-ref="144db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::expires" title='redisDb::expires' data-ref="redisDb::expires">expires</a>) * <b>sizeof</b>(<a class="typedef" href="dict.h.html#dictEntry" title='dictEntry' data-type='struct dictEntry' data-ref="dictEntry">dictEntry</a>) +</td></tr>
<tr><th id="888">888</th><td>              <a class="macro" href="dict.h.html#146" title="((db-&gt;expires)-&gt;ht[0].size+(db-&gt;expires)-&gt;ht[1].size)" data-ref="_M/dictSlots">dictSlots</a>(<a class="local col4 ref" href="#144db" title='db' data-ref="144db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::expires" title='redisDb::expires' data-ref="redisDb::expires">expires</a>) * <b>sizeof</b>(<a class="typedef" href="dict.h.html#dictEntry" title='dictEntry' data-type='struct dictEntry' data-ref="dictEntry">dictEntry</a>*);</td></tr>
<tr><th id="889">889</th><td>        <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>].<a class="ref" href="server.h.html#redisMemOverhead::(anonymous)::overhead_ht_expires" title='redisMemOverhead::(anonymous struct)::overhead_ht_expires' data-ref="redisMemOverhead::(anonymous)::overhead_ht_expires">overhead_ht_expires</a> = <a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="890">890</th><td>        <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>+=<a class="local col5 ref" href="#135mem" title='mem' data-ref="135mem">mem</a>;</td></tr>
<tr><th id="891">891</th><td></td></tr>
<tr><th id="892">892</th><td>        <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>++;</td></tr>
<tr><th id="893">893</th><td>    }</td></tr>
<tr><th id="894">894</th><td></td></tr>
<tr><th id="895">895</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::overhead_total" title='redisMemOverhead::overhead_total' data-ref="redisMemOverhead::overhead_total">overhead_total</a> = <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>;</td></tr>
<tr><th id="896">896</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::dataset" title='redisMemOverhead::dataset' data-ref="redisMemOverhead::dataset">dataset</a> = <a class="local col6 ref" href="#136zmalloc_used" title='zmalloc_used' data-ref="136zmalloc_used">zmalloc_used</a> - <a class="local col4 ref" href="#134mem_total" title='mem_total' data-ref="134mem_total">mem_total</a>;</td></tr>
<tr><th id="897">897</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::peak_perc" title='redisMemOverhead::peak_perc' data-ref="redisMemOverhead::peak_perc">peak_perc</a> = (<em>float</em>)<a class="local col6 ref" href="#136zmalloc_used" title='zmalloc_used' data-ref="136zmalloc_used">zmalloc_used</a>*<var>100</var>/<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::peak_allocated" title='redisMemOverhead::peak_allocated' data-ref="redisMemOverhead::peak_allocated">peak_allocated</a>;</td></tr>
<tr><th id="898">898</th><td></td></tr>
<tr><th id="899">899</th><td>    <i>/* Metrics computed after subtracting the startup memory from</i></td></tr>
<tr><th id="900">900</th><td><i>     * the total memory. */</i></td></tr>
<tr><th id="901">901</th><td>    <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col6 decl" id="146net_usage" title='net_usage' data-type='size_t' data-ref="146net_usage">net_usage</dfn> = <var>1</var>;</td></tr>
<tr><th id="902">902</th><td>    <b>if</b> (<a class="local col6 ref" href="#136zmalloc_used" title='zmalloc_used' data-ref="136zmalloc_used">zmalloc_used</a> &gt; <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::startup_allocated" title='redisMemOverhead::startup_allocated' data-ref="redisMemOverhead::startup_allocated">startup_allocated</a>)</td></tr>
<tr><th id="903">903</th><td>        <a class="local col6 ref" href="#146net_usage" title='net_usage' data-ref="146net_usage">net_usage</a> = <a class="local col6 ref" href="#136zmalloc_used" title='zmalloc_used' data-ref="136zmalloc_used">zmalloc_used</a> - <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::startup_allocated" title='redisMemOverhead::startup_allocated' data-ref="redisMemOverhead::startup_allocated">startup_allocated</a>;</td></tr>
<tr><th id="904">904</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::dataset_perc" title='redisMemOverhead::dataset_perc' data-ref="redisMemOverhead::dataset_perc">dataset_perc</a> = (<em>float</em>)<a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::dataset" title='redisMemOverhead::dataset' data-ref="redisMemOverhead::dataset">dataset</a>*<var>100</var>/<a class="local col6 ref" href="#146net_usage" title='net_usage' data-ref="146net_usage">net_usage</a>;</td></tr>
<tr><th id="905">905</th><td>    <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::bytes_per_key" title='redisMemOverhead::bytes_per_key' data-ref="redisMemOverhead::bytes_per_key">bytes_per_key</a> = <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_keys" title='redisMemOverhead::total_keys' data-ref="redisMemOverhead::total_keys">total_keys</a> ? (<a class="local col6 ref" href="#146net_usage" title='net_usage' data-ref="146net_usage">net_usage</a> / <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_keys" title='redisMemOverhead::total_keys' data-ref="redisMemOverhead::total_keys">total_keys</a>) : <var>0</var>;</td></tr>
<tr><th id="906">906</th><td></td></tr>
<tr><th id="907">907</th><td>    <b>return</b> <a class="local col7 ref" href="#137mh" title='mh' data-ref="137mh">mh</a>;</td></tr>
<tr><th id="908">908</th><td>}</td></tr>
<tr><th id="909">909</th><td></td></tr>
<tr><th id="910">910</th><td><i>/* Helper for "MEMORY allocator-stats", used as a callback for the jemalloc</i></td></tr>
<tr><th id="911">911</th><td><i> * stats output. */</i></td></tr>
<tr><th id="912">912</th><td><em>void</em> <dfn class="decl def" id="inputCatSds" title='inputCatSds' data-ref="inputCatSds">inputCatSds</dfn>(<em>void</em> *<dfn class="local col7 decl" id="147result" title='result' data-type='void *' data-ref="147result">result</dfn>, <em>const</em> <em>char</em> *<dfn class="local col8 decl" id="148str" title='str' data-type='const char *' data-ref="148str">str</dfn>) {</td></tr>
<tr><th id="913">913</th><td>    <i>/* result is actually a (sds *), so re-cast it here */</i></td></tr>
<tr><th id="914">914</th><td>    <a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> *<dfn class="local col9 decl" id="149info" title='info' data-type='sds *' data-ref="149info">info</dfn> = (<a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> *)<a class="local col7 ref" href="#147result" title='result' data-ref="147result">result</a>;</td></tr>
<tr><th id="915">915</th><td>    *<a class="local col9 ref" href="#149info" title='info' data-ref="149info">info</a> = <a class="ref" href="sds.h.html#sdscat" title='sdscat' data-ref="sdscat">sdscat</a>(*<a class="local col9 ref" href="#149info" title='info' data-ref="149info">info</a>, <a class="local col8 ref" href="#148str" title='str' data-ref="148str">str</a>);</td></tr>
<tr><th id="916">916</th><td>}</td></tr>
<tr><th id="917">917</th><td></td></tr>
<tr><th id="918">918</th><td><i>/* This implements MEMORY DOCTOR. An human readable analysis of the Redis</i></td></tr>
<tr><th id="919">919</th><td><i> * memory condition. */</i></td></tr>
<tr><th id="920">920</th><td><a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="decl def" id="getMemoryDoctorReport" title='getMemoryDoctorReport' data-ref="getMemoryDoctorReport">getMemoryDoctorReport</dfn>(<em>void</em>) {</td></tr>
<tr><th id="921">921</th><td>    <em>int</em> <dfn class="local col0 decl" id="150empty" title='empty' data-type='int' data-ref="150empty">empty</dfn> = <var>0</var>;          <i>/* Instance is empty or almost empty. */</i></td></tr>
<tr><th id="922">922</th><td>    <em>int</em> <dfn class="local col1 decl" id="151big_peak" title='big_peak' data-type='int' data-ref="151big_peak">big_peak</dfn> = <var>0</var>;       <i>/* Memory peak is much larger than used mem. */</i></td></tr>
<tr><th id="923">923</th><td>    <em>int</em> <dfn class="local col2 decl" id="152high_frag" title='high_frag' data-type='int' data-ref="152high_frag">high_frag</dfn> = <var>0</var>;      <i>/* High fragmentation. */</i></td></tr>
<tr><th id="924">924</th><td>    <em>int</em> <dfn class="local col3 decl" id="153big_slave_buf" title='big_slave_buf' data-type='int' data-ref="153big_slave_buf">big_slave_buf</dfn> = <var>0</var>;  <i>/* Slave buffers are too big. */</i></td></tr>
<tr><th id="925">925</th><td>    <em>int</em> <dfn class="local col4 decl" id="154big_client_buf" title='big_client_buf' data-type='int' data-ref="154big_client_buf">big_client_buf</dfn> = <var>0</var>; <i>/* Client buffers are too big. */</i></td></tr>
<tr><th id="926">926</th><td>    <em>int</em> <dfn class="local col5 decl" id="155num_reports" title='num_reports' data-type='int' data-ref="155num_reports">num_reports</dfn> = <var>0</var>;</td></tr>
<tr><th id="927">927</th><td>    <b>struct</b> <a class="type" href="server.h.html#redisMemOverhead" title='redisMemOverhead' data-ref="redisMemOverhead">redisMemOverhead</a> *<dfn class="local col6 decl" id="156mh" title='mh' data-type='struct redisMemOverhead *' data-ref="156mh">mh</dfn> = <a class="ref" href="#getMemoryOverheadData" title='getMemoryOverheadData' data-ref="getMemoryOverheadData">getMemoryOverheadData</a>();</td></tr>
<tr><th id="928">928</th><td></td></tr>
<tr><th id="929">929</th><td>    <b>if</b> (<a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_allocated" title='redisMemOverhead::total_allocated' data-ref="redisMemOverhead::total_allocated">total_allocated</a> &lt; (<var>1024</var>*<var>1024</var>*<var>5</var>)) {</td></tr>
<tr><th id="930">930</th><td>        <a class="local col0 ref" href="#150empty" title='empty' data-ref="150empty">empty</a> = <var>1</var>;</td></tr>
<tr><th id="931">931</th><td>        <a class="local col5 ref" href="#155num_reports" title='num_reports' data-ref="155num_reports">num_reports</a>++;</td></tr>
<tr><th id="932">932</th><td>    } <b>else</b> {</td></tr>
<tr><th id="933">933</th><td>        <i>/* Peak is &gt; 150% of current used memory? */</i></td></tr>
<tr><th id="934">934</th><td>        <b>if</b> (((<em>float</em>)<a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::peak_allocated" title='redisMemOverhead::peak_allocated' data-ref="redisMemOverhead::peak_allocated">peak_allocated</a> / <a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_allocated" title='redisMemOverhead::total_allocated' data-ref="redisMemOverhead::total_allocated">total_allocated</a>) &gt; <var>1.5</var>) {</td></tr>
<tr><th id="935">935</th><td>            <a class="local col1 ref" href="#151big_peak" title='big_peak' data-ref="151big_peak">big_peak</a> = <var>1</var>;</td></tr>
<tr><th id="936">936</th><td>            <a class="local col5 ref" href="#155num_reports" title='num_reports' data-ref="155num_reports">num_reports</a>++;</td></tr>
<tr><th id="937">937</th><td>        }</td></tr>
<tr><th id="938">938</th><td></td></tr>
<tr><th id="939">939</th><td>        <i>/* Fragmentation is higher than 1.4? */</i></td></tr>
<tr><th id="940">940</th><td>        <b>if</b> (<a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::fragmentation" title='redisMemOverhead::fragmentation' data-ref="redisMemOverhead::fragmentation">fragmentation</a> &gt; <var>1.4</var>) {</td></tr>
<tr><th id="941">941</th><td>            <a class="local col2 ref" href="#152high_frag" title='high_frag' data-ref="152high_frag">high_frag</a> = <var>1</var>;</td></tr>
<tr><th id="942">942</th><td>            <a class="local col5 ref" href="#155num_reports" title='num_reports' data-ref="155num_reports">num_reports</a>++;</td></tr>
<tr><th id="943">943</th><td>        }</td></tr>
<tr><th id="944">944</th><td></td></tr>
<tr><th id="945">945</th><td>        <i>/* Clients using more than 200k each average? */</i></td></tr>
<tr><th id="946">946</th><td>        <em>long</em> <dfn class="local col7 decl" id="157numslaves" title='numslaves' data-type='long' data-ref="157numslaves">numslaves</dfn> = <a class="macro" href="adlist.h.html#57" title="((server.slaves)-&gt;len)" data-ref="_M/listLength">listLength</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::slaves" title='redisServer::slaves' data-ref="redisServer::slaves">slaves</a>);</td></tr>
<tr><th id="947">947</th><td>        <em>long</em> <dfn class="local col8 decl" id="158numclients" title='numclients' data-type='long' data-ref="158numclients">numclients</dfn> = <a class="macro" href="adlist.h.html#57" title="((server.clients)-&gt;len)" data-ref="_M/listLength">listLength</a>(<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::clients" title='redisServer::clients' data-ref="redisServer::clients">clients</a>)-<a class="local col7 ref" href="#157numslaves" title='numslaves' data-ref="157numslaves">numslaves</a>;</td></tr>
<tr><th id="948">948</th><td>        <b>if</b> (<a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::clients_normal" title='redisMemOverhead::clients_normal' data-ref="redisMemOverhead::clients_normal">clients_normal</a> / <a class="local col8 ref" href="#158numclients" title='numclients' data-ref="158numclients">numclients</a> &gt; (<var>1024</var>*<var>200</var>)) {</td></tr>
<tr><th id="949">949</th><td>            <a class="local col4 ref" href="#154big_client_buf" title='big_client_buf' data-ref="154big_client_buf">big_client_buf</a> = <var>1</var>;</td></tr>
<tr><th id="950">950</th><td>            <a class="local col5 ref" href="#155num_reports" title='num_reports' data-ref="155num_reports">num_reports</a>++;</td></tr>
<tr><th id="951">951</th><td>        }</td></tr>
<tr><th id="952">952</th><td></td></tr>
<tr><th id="953">953</th><td>        <i>/* Slaves using more than 10 MB each? */</i></td></tr>
<tr><th id="954">954</th><td>        <b>if</b> (<a class="local col7 ref" href="#157numslaves" title='numslaves' data-ref="157numslaves">numslaves</a> &gt; <var>0</var> &amp;&amp; <a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::clients_slaves" title='redisMemOverhead::clients_slaves' data-ref="redisMemOverhead::clients_slaves">clients_slaves</a> / <a class="local col7 ref" href="#157numslaves" title='numslaves' data-ref="157numslaves">numslaves</a> &gt; (<var>1024</var>*<var>1024</var>*<var>10</var>)) {</td></tr>
<tr><th id="955">955</th><td>            <a class="local col3 ref" href="#153big_slave_buf" title='big_slave_buf' data-ref="153big_slave_buf">big_slave_buf</a> = <var>1</var>;</td></tr>
<tr><th id="956">956</th><td>            <a class="local col5 ref" href="#155num_reports" title='num_reports' data-ref="155num_reports">num_reports</a>++;</td></tr>
<tr><th id="957">957</th><td>        }</td></tr>
<tr><th id="958">958</th><td>    }</td></tr>
<tr><th id="959">959</th><td></td></tr>
<tr><th id="960">960</th><td>    <a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="local col9 decl" id="159s" title='s' data-type='sds' data-ref="159s">s</dfn>;</td></tr>
<tr><th id="961">961</th><td>    <b>if</b> (<a class="local col5 ref" href="#155num_reports" title='num_reports' data-ref="155num_reports">num_reports</a> == <var>0</var>) {</td></tr>
<tr><th id="962">962</th><td>        <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdsnew" title='sdsnew' data-ref="sdsnew">sdsnew</a>(</td></tr>
<tr><th id="963">963</th><td>        <q>"Hi Sam, I can't find any memory issue in your instance. "</q></td></tr>
<tr><th id="964">964</th><td>        <q>"I can only account for what occurs on this base.\n"</q>);</td></tr>
<tr><th id="965">965</th><td>    } <b>else</b> <b>if</b> (<a class="local col0 ref" href="#150empty" title='empty' data-ref="150empty">empty</a> == <var>1</var>) {</td></tr>
<tr><th id="966">966</th><td>        <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdsnew" title='sdsnew' data-ref="sdsnew">sdsnew</a>(</td></tr>
<tr><th id="967">967</th><td>        <q>"Hi Sam, this instance is empty or is using very little memory, "</q></td></tr>
<tr><th id="968">968</th><td>        <q>"my issues detector can't be used in these conditions. "</q></td></tr>
<tr><th id="969">969</th><td>        <q>"Please, leave for your mission on Earth and fill it with some data. "</q></td></tr>
<tr><th id="970">970</th><td>        <q>"The new Sam and I will be back to our programming as soon as I "</q></td></tr>
<tr><th id="971">971</th><td>        <q>"finished rebooting.\n"</q>);</td></tr>
<tr><th id="972">972</th><td>    } <b>else</b> {</td></tr>
<tr><th id="973">973</th><td>        <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdsnew" title='sdsnew' data-ref="sdsnew">sdsnew</a>(<q>"Sam, I detected a few issues in this Redis instance memory implants:\n\n"</q>);</td></tr>
<tr><th id="974">974</th><td>        <b>if</b> (<a class="local col1 ref" href="#151big_peak" title='big_peak' data-ref="151big_peak">big_peak</a>) {</td></tr>
<tr><th id="975">975</th><td>            <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdscat" title='sdscat' data-ref="sdscat">sdscat</a>(<a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a>,<q>" * Peak memory: In the past this instance used more than 150% the memory that is currently using. The allocator is normally not able to release memory after a peak, so you can expect to see a big fragmentation ratio, however this is actually harmless and is only due to the memory peak, and if the Redis instance Resident Set Size (RSS) is currently bigger than expected, the memory will be used as soon as you fill the Redis instance with more data. If the memory peak was only occasional and you want to try to reclaim memory, please try the MEMORY PURGE command, otherwise the only other option is to shutdown and restart the instance.\n\n"</q>);</td></tr>
<tr><th id="976">976</th><td>        }</td></tr>
<tr><th id="977">977</th><td>        <b>if</b> (<a class="local col2 ref" href="#152high_frag" title='high_frag' data-ref="152high_frag">high_frag</a>) {</td></tr>
<tr><th id="978">978</th><td>            <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdscatprintf" title='sdscatprintf' data-ref="sdscatprintf">sdscatprintf</a>(<a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a>,<q>" * High fragmentation: This instance has a memory fragmentation greater than 1.4 (this means that the Resident Set Size of the Redis process is much larger than the sum of the logical allocations Redis performed). This problem is usually due either to a large peak memory (check if there is a peak memory entry above in the report) or may result from a workload that causes the allocator to fragment memory a lot. If the problem is a large peak memory, then there is no issue. Otherwise, make sure you are using the Jemalloc allocator and not the default libc malloc. Note: The currently used allocator is \"%s\".\n\n"</q>, <a class="macro" href="zmalloc.h.html#49" title="(&quot;jemalloc-&quot; &quot;4&quot; &quot;.&quot; &quot;0&quot; &quot;.&quot; &quot;3&quot;)" data-ref="_M/ZMALLOC_LIB">ZMALLOC_LIB</a>);</td></tr>
<tr><th id="979">979</th><td>        }</td></tr>
<tr><th id="980">980</th><td>        <b>if</b> (<a class="local col3 ref" href="#153big_slave_buf" title='big_slave_buf' data-ref="153big_slave_buf">big_slave_buf</a>) {</td></tr>
<tr><th id="981">981</th><td>            <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdscat" title='sdscat' data-ref="sdscat">sdscat</a>(<a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a>,<q>" * Big slave buffers: The slave output buffers in this instance are greater than 10MB for each slave (on average). This likely means that there is some slave instance that is struggling receiving data, either because it is too slow or because of networking issues. As a result, data piles on the master output buffers. Please try to identify what slave is not receiving data correctly and why. You can use the INFO output in order to check the slaves delays and the CLIENT LIST command to check the output buffers of each slave.\n\n"</q>);</td></tr>
<tr><th id="982">982</th><td>        }</td></tr>
<tr><th id="983">983</th><td>        <b>if</b> (<a class="local col4 ref" href="#154big_client_buf" title='big_client_buf' data-ref="154big_client_buf">big_client_buf</a>) {</td></tr>
<tr><th id="984">984</th><td>            <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdscat" title='sdscat' data-ref="sdscat">sdscat</a>(<a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a>,<q>" * Big client buffers: The clients output buffers in this instance are greater than 200K per client (on average). This may result from different causes, like Pub/Sub clients subscribed to channels bot not receiving data fast enough, so that data piles on the Redis instance output buffer, or clients sending commands with large replies or very large sequences of commands in the same pipeline. Please use the CLIENT LIST command in order to investigate the issue if it causes problems in your instance, or to understand better why certain clients are using a big amount of memory.\n\n"</q>);</td></tr>
<tr><th id="985">985</th><td>        }</td></tr>
<tr><th id="986">986</th><td>        <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a> = <a class="ref" href="sds.h.html#sdscat" title='sdscat' data-ref="sdscat">sdscat</a>(<a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a>,<q>"I'm here to keep you safe, Sam. I want to help you.\n"</q>);</td></tr>
<tr><th id="987">987</th><td>    }</td></tr>
<tr><th id="988">988</th><td>    <a class="ref" href="#freeMemoryOverheadData" title='freeMemoryOverheadData' data-ref="freeMemoryOverheadData">freeMemoryOverheadData</a>(<a class="local col6 ref" href="#156mh" title='mh' data-ref="156mh">mh</a>);</td></tr>
<tr><th id="989">989</th><td>    <b>return</b> <a class="local col9 ref" href="#159s" title='s' data-ref="159s">s</a>;</td></tr>
<tr><th id="990">990</th><td>}</td></tr>
<tr><th id="991">991</th><td></td></tr>
<tr><th id="992">992</th><td><i>/* ======================= The OBJECT and MEMORY commands =================== */</i></td></tr>
<tr><th id="993">993</th><td></td></tr>
<tr><th id="994">994</th><td><i>/* This is a helper function for the OBJECT command. We need to lookup keys</i></td></tr>
<tr><th id="995">995</th><td><i> * without any modification of LRU or other parameters. */</i></td></tr>
<tr><th id="996">996</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="objectCommandLookup" title='objectCommandLookup' data-ref="objectCommandLookup">objectCommandLookup</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col0 decl" id="160c" title='c' data-type='client *' data-ref="160c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col1 decl" id="161key" title='key' data-type='robj *' data-ref="161key">key</dfn>) {</td></tr>
<tr><th id="997">997</th><td>    <a class="typedef" href="dict.h.html#dictEntry" title='dictEntry' data-type='struct dictEntry' data-ref="dictEntry">dictEntry</a> *<dfn class="local col2 decl" id="162de" title='de' data-type='dictEntry *' data-ref="162de">de</dfn>;</td></tr>
<tr><th id="998">998</th><td></td></tr>
<tr><th id="999">999</th><td>    <b>if</b> ((<a class="local col2 ref" href="#162de" title='de' data-ref="162de">de</a> = <a class="ref" href="dict.h.html#dictFind" title='dictFind' data-ref="dictFind">dictFind</a>(<a class="local col0 ref" href="#160c" title='c' data-ref="160c">c</a>-&gt;<a class="ref" href="server.h.html#client::db" title='client::db' data-ref="client::db">db</a>-&gt;<a class="ref" href="server.h.html#redisDb::dict" title='redisDb::dict' data-ref="redisDb::dict">dict</a>,<a class="local col1 ref" href="#161key" title='key' data-ref="161key">key</a>-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>)) == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="1000">1000</th><td>    <b>return</b> (<a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a>*) <a class="macro" href="dict.h.html#142" title="((de)-&gt;v.val)" data-ref="_M/dictGetVal">dictGetVal</a>(<a class="local col2 ref" href="#162de" title='de' data-ref="162de">de</a>);</td></tr>
<tr><th id="1001">1001</th><td>}</td></tr>
<tr><th id="1002">1002</th><td></td></tr>
<tr><th id="1003">1003</th><td><a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="decl def" id="objectCommandLookupOrReply" title='objectCommandLookupOrReply' data-ref="objectCommandLookupOrReply">objectCommandLookupOrReply</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col3 decl" id="163c" title='c' data-type='client *' data-ref="163c">c</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col4 decl" id="164key" title='key' data-type='robj *' data-ref="164key">key</dfn>, <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col5 decl" id="165reply" title='reply' data-type='robj *' data-ref="165reply">reply</dfn>) {</td></tr>
<tr><th id="1004">1004</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col6 decl" id="166o" title='o' data-type='robj *' data-ref="166o">o</dfn> = <a class="ref" href="#objectCommandLookup" title='objectCommandLookup' data-ref="objectCommandLookup">objectCommandLookup</a>(<a class="local col3 ref" href="#163c" title='c' data-ref="163c">c</a>,<a class="local col4 ref" href="#164key" title='key' data-ref="164key">key</a>);</td></tr>
<tr><th id="1005">1005</th><td></td></tr>
<tr><th id="1006">1006</th><td>    <b>if</b> (!<a class="local col6 ref" href="#166o" title='o' data-ref="166o">o</a>) <a class="ref" href="server.h.html#addReply" title='addReply' data-ref="addReply">addReply</a>(<a class="local col3 ref" href="#163c" title='c' data-ref="163c">c</a>, <a class="local col5 ref" href="#165reply" title='reply' data-ref="165reply">reply</a>);</td></tr>
<tr><th id="1007">1007</th><td>    <b>return</b> <a class="local col6 ref" href="#166o" title='o' data-ref="166o">o</a>;</td></tr>
<tr><th id="1008">1008</th><td>}</td></tr>
<tr><th id="1009">1009</th><td></td></tr>
<tr><th id="1010">1010</th><td><i>/* Object command allows to inspect the internals of an Redis Object.</i></td></tr>
<tr><th id="1011">1011</th><td><i> * Usage: OBJECT &lt;refcount|encoding|idletime&gt; &lt;key&gt; */</i></td></tr>
<tr><th id="1012">1012</th><td><em>void</em> <dfn class="decl def" id="objectCommand" title='objectCommand' data-ref="objectCommand">objectCommand</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col7 decl" id="167c" title='c' data-type='client *' data-ref="167c">c</dfn>) {</td></tr>
<tr><th id="1013">1013</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col8 decl" id="168o" title='o' data-type='robj *' data-ref="168o">o</dfn>;</td></tr>
<tr><th id="1014">1014</th><td></td></tr>
<tr><th id="1015">1015</th><td>    <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"refcount"</q>) &amp;&amp; <a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>3</var>) {</td></tr>
<tr><th id="1016">1016</th><td>        <b>if</b> ((<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a> = <a class="ref" href="#objectCommandLookupOrReply" title='objectCommandLookupOrReply' data-ref="objectCommandLookupOrReply">objectCommandLookupOrReply</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>2</var>],<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::nullbulk" title='sharedObjectsStruct::nullbulk' data-ref="sharedObjectsStruct::nullbulk">nullbulk</a>))</td></tr>
<tr><th id="1017">1017</th><td>                == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <b>return</b>;</td></tr>
<tr><th id="1018">1018</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::refcount" title='redisObject::refcount' data-ref="redisObject::refcount">refcount</a>);</td></tr>
<tr><th id="1019">1019</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"encoding"</q>) &amp;&amp; <a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>3</var>) {</td></tr>
<tr><th id="1020">1020</th><td>        <b>if</b> ((<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a> = <a class="ref" href="#objectCommandLookupOrReply" title='objectCommandLookupOrReply' data-ref="objectCommandLookupOrReply">objectCommandLookupOrReply</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>2</var>],<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::nullbulk" title='sharedObjectsStruct::nullbulk' data-ref="sharedObjectsStruct::nullbulk">nullbulk</a>))</td></tr>
<tr><th id="1021">1021</th><td>                == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <b>return</b>;</td></tr>
<tr><th id="1022">1022</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="ref" href="#strEncoding" title='strEncoding' data-ref="strEncoding">strEncoding</a>(<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::encoding" title='redisObject::encoding' data-ref="redisObject::encoding">encoding</a>));</td></tr>
<tr><th id="1023">1023</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"idletime"</q>) &amp;&amp; <a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>3</var>) {</td></tr>
<tr><th id="1024">1024</th><td>        <b>if</b> ((<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a> = <a class="ref" href="#objectCommandLookupOrReply" title='objectCommandLookupOrReply' data-ref="objectCommandLookupOrReply">objectCommandLookupOrReply</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>2</var>],<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::nullbulk" title='sharedObjectsStruct::nullbulk' data-ref="sharedObjectsStruct::nullbulk">nullbulk</a>))</td></tr>
<tr><th id="1025">1025</th><td>                == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <b>return</b>;</td></tr>
<tr><th id="1026">1026</th><td>        <b>if</b> (<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::maxmemory_policy" title='redisServer::maxmemory_policy' data-ref="redisServer::maxmemory_policy">maxmemory_policy</a> &amp; <a class="macro" href="server.h.html#367" title="(1&lt;&lt;1)" data-ref="_M/MAXMEMORY_FLAG_LFU">MAXMEMORY_FLAG_LFU</a>) {</td></tr>
<tr><th id="1027">1027</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<q>"An LFU maxmemory policy is selected, idle time not tracked. Please note that when switching between policies at runtime LRU and LFU data will take some time to adjust."</q>);</td></tr>
<tr><th id="1028">1028</th><td>            <b>return</b>;</td></tr>
<tr><th id="1029">1029</th><td>        }</td></tr>
<tr><th id="1030">1030</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="ref" href="server.h.html#estimateObjectIdleTime" title='estimateObjectIdleTime' data-ref="estimateObjectIdleTime">estimateObjectIdleTime</a>(<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a>)/<var>1000</var>);</td></tr>
<tr><th id="1031">1031</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"freq"</q>) &amp;&amp; <a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>3</var>) {</td></tr>
<tr><th id="1032">1032</th><td>        <b>if</b> ((<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a> = <a class="ref" href="#objectCommandLookupOrReply" title='objectCommandLookupOrReply' data-ref="objectCommandLookupOrReply">objectCommandLookupOrReply</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>2</var>],<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::nullbulk" title='sharedObjectsStruct::nullbulk' data-ref="sharedObjectsStruct::nullbulk">nullbulk</a>))</td></tr>
<tr><th id="1033">1033</th><td>                == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <b>return</b>;</td></tr>
<tr><th id="1034">1034</th><td>        <b>if</b> (<a class="ref" href="server.h.html#server" title='server' data-ref="server">server</a>.<a class="ref" href="server.h.html#redisServer::maxmemory_policy" title='redisServer::maxmemory_policy' data-ref="redisServer::maxmemory_policy">maxmemory_policy</a> &amp; <a class="macro" href="server.h.html#366" title="(1&lt;&lt;0)" data-ref="_M/MAXMEMORY_FLAG_LRU">MAXMEMORY_FLAG_LRU</a>) {</td></tr>
<tr><th id="1035">1035</th><td>            <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<q>"An LRU maxmemory policy is selected, access frequency not tracked. Please note that when switching between policies at runtime LRU and LFU data will take some time to adjust."</q>);</td></tr>
<tr><th id="1036">1036</th><td>            <b>return</b>;</td></tr>
<tr><th id="1037">1037</th><td>        }</td></tr>
<tr><th id="1038">1038</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<a class="local col8 ref" href="#168o" title='o' data-ref="168o">o</a>-&gt;<a class="ref" href="server.h.html#redisObject::lru" title='redisObject::lru' data-ref="redisObject::lru">lru</a>&amp;<var>255</var>);</td></tr>
<tr><th id="1039">1039</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1040">1040</th><td>        <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col7 ref" href="#167c" title='c' data-ref="167c">c</a>,<q>"Syntax error. Try OBJECT (refcount|encoding|idletime|freq)"</q>);</td></tr>
<tr><th id="1041">1041</th><td>    }</td></tr>
<tr><th id="1042">1042</th><td>}</td></tr>
<tr><th id="1043">1043</th><td></td></tr>
<tr><th id="1044">1044</th><td><i>/* The memory command will eventually be a complete interface for the</i></td></tr>
<tr><th id="1045">1045</th><td><i> * memory introspection capabilities of Redis.</i></td></tr>
<tr><th id="1046">1046</th><td><i> *</i></td></tr>
<tr><th id="1047">1047</th><td><i> * Usage: MEMORY usage &lt;key&gt; */</i></td></tr>
<tr><th id="1048">1048</th><td><em>void</em> <dfn class="decl def" id="memoryCommand" title='memoryCommand' data-ref="memoryCommand">memoryCommand</dfn>(<a class="typedef" href="server.h.html#client" title='client' data-type='struct client' data-ref="client">client</a> *<dfn class="local col9 decl" id="169c" title='c' data-type='client *' data-ref="169c">c</dfn>) {</td></tr>
<tr><th id="1049">1049</th><td>    <a class="typedef" href="server.h.html#robj" title='robj' data-type='struct redisObject' data-ref="robj">robj</a> *<dfn class="local col0 decl" id="170o" title='o' data-type='robj *' data-ref="170o">o</dfn>;</td></tr>
<tr><th id="1050">1050</th><td></td></tr>
<tr><th id="1051">1051</th><td>    <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"usage"</q>) &amp;&amp; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> &gt;= <var>3</var>) {</td></tr>
<tr><th id="1052">1052</th><td>        <em>long</em> <em>long</em> <dfn class="local col1 decl" id="171samples" title='samples' data-type='long long' data-ref="171samples">samples</dfn> = <a class="macro" href="#699" title="5" data-ref="_M/OBJ_COMPUTE_SIZE_DEF_SAMPLES">OBJ_COMPUTE_SIZE_DEF_SAMPLES</a>;</td></tr>
<tr><th id="1053">1053</th><td>        <b>for</b> (<em>int</em> <dfn class="local col2 decl" id="172j" title='j' data-type='int' data-ref="172j">j</dfn> = <var>3</var>; <a class="local col2 ref" href="#172j" title='j' data-ref="172j">j</a> &lt; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a>; <a class="local col2 ref" href="#172j" title='j' data-ref="172j">j</a>++) {</td></tr>
<tr><th id="1054">1054</th><td>            <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<a class="local col2 ref" href="#172j" title='j' data-ref="172j">j</a>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"samples"</q>) &amp;&amp;</td></tr>
<tr><th id="1055">1055</th><td>                <a class="local col2 ref" href="#172j" title='j' data-ref="172j">j</a>+<var>1</var> &lt; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a>)</td></tr>
<tr><th id="1056">1056</th><td>            {</td></tr>
<tr><th id="1057">1057</th><td>                <b>if</b> (<a class="ref" href="#getLongLongFromObjectOrReply" title='getLongLongFromObjectOrReply' data-ref="getLongLongFromObjectOrReply">getLongLongFromObjectOrReply</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<a class="local col2 ref" href="#172j" title='j' data-ref="172j">j</a>+<var>1</var>],&amp;<a class="local col1 ref" href="#171samples" title='samples' data-ref="171samples">samples</a>,<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="1058">1058</th><td>                     == <a class="macro" href="server.h.html#78" title="-1" data-ref="_M/C_ERR">C_ERR</a>) <b>return</b>;</td></tr>
<tr><th id="1059">1059</th><td>                <b>if</b> (<a class="local col1 ref" href="#171samples" title='samples' data-ref="171samples">samples</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="1060">1060</th><td>                    <a class="ref" href="server.h.html#addReply" title='addReply' data-ref="addReply">addReply</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::syntaxerr" title='sharedObjectsStruct::syntaxerr' data-ref="sharedObjectsStruct::syntaxerr">syntaxerr</a>);</td></tr>
<tr><th id="1061">1061</th><td>                    <b>return</b>;</td></tr>
<tr><th id="1062">1062</th><td>                }</td></tr>
<tr><th id="1063">1063</th><td>                <b>if</b> (<a class="local col1 ref" href="#171samples" title='samples' data-ref="171samples">samples</a> == <var>0</var>) <a class="local col1 ref" href="#171samples" title='samples' data-ref="171samples">samples</a> = <span class="macro" title="9223372036854775807LL" data-ref="_M/LLONG_MAX">LLONG_MAX</span>;;</td></tr>
<tr><th id="1064">1064</th><td>                <a class="local col2 ref" href="#172j" title='j' data-ref="172j">j</a>++; <i>/* skip option argument. */</i></td></tr>
<tr><th id="1065">1065</th><td>            } <b>else</b> {</td></tr>
<tr><th id="1066">1066</th><td>                <a class="ref" href="server.h.html#addReply" title='addReply' data-ref="addReply">addReply</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::syntaxerr" title='sharedObjectsStruct::syntaxerr' data-ref="sharedObjectsStruct::syntaxerr">syntaxerr</a>);</td></tr>
<tr><th id="1067">1067</th><td>                <b>return</b>;</td></tr>
<tr><th id="1068">1068</th><td>            }</td></tr>
<tr><th id="1069">1069</th><td>        }</td></tr>
<tr><th id="1070">1070</th><td>        <b>if</b> ((<a class="local col0 ref" href="#170o" title='o' data-ref="170o">o</a> = <a class="ref" href="#objectCommandLookupOrReply" title='objectCommandLookupOrReply' data-ref="objectCommandLookupOrReply">objectCommandLookupOrReply</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>2</var>],<a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::nullbulk" title='sharedObjectsStruct::nullbulk' data-ref="sharedObjectsStruct::nullbulk">nullbulk</a>))</td></tr>
<tr><th id="1071">1071</th><td>                == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) <b>return</b>;</td></tr>
<tr><th id="1072">1072</th><td>        <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col3 decl" id="173usage" title='usage' data-type='size_t' data-ref="173usage">usage</dfn> = <a class="ref" href="#objectComputeSize" title='objectComputeSize' data-ref="objectComputeSize">objectComputeSize</a>(<a class="local col0 ref" href="#170o" title='o' data-ref="170o">o</a>,<a class="local col1 ref" href="#171samples" title='samples' data-ref="171samples">samples</a>);</td></tr>
<tr><th id="1073">1073</th><td>        <a class="local col3 ref" href="#173usage" title='usage' data-ref="173usage">usage</a> += <a class="ref" href="sds.h.html#sdsAllocSize" title='sdsAllocSize' data-ref="sdsAllocSize">sdsAllocSize</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>);</td></tr>
<tr><th id="1074">1074</th><td>        <a class="local col3 ref" href="#173usage" title='usage' data-ref="173usage">usage</a> += <b>sizeof</b>(<a class="typedef" href="dict.h.html#dictEntry" title='dictEntry' data-type='struct dictEntry' data-ref="dictEntry">dictEntry</a>);</td></tr>
<tr><th id="1075">1075</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col3 ref" href="#173usage" title='usage' data-ref="173usage">usage</a>);</td></tr>
<tr><th id="1076">1076</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"stats"</q>) &amp;&amp; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>2</var>) {</td></tr>
<tr><th id="1077">1077</th><td>        <b>struct</b> <a class="type" href="server.h.html#redisMemOverhead" title='redisMemOverhead' data-ref="redisMemOverhead">redisMemOverhead</a> *<dfn class="local col4 decl" id="174mh" title='mh' data-type='struct redisMemOverhead *' data-ref="174mh">mh</dfn> = <a class="ref" href="#getMemoryOverheadData" title='getMemoryOverheadData' data-ref="getMemoryOverheadData">getMemoryOverheadData</a>();</td></tr>
<tr><th id="1078">1078</th><td></td></tr>
<tr><th id="1079">1079</th><td>        <a class="ref" href="server.h.html#addReplyMultiBulkLen" title='addReplyMultiBulkLen' data-ref="addReplyMultiBulkLen">addReplyMultiBulkLen</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,(<var>14</var>+<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>)*<var>2</var>);</td></tr>
<tr><th id="1080">1080</th><td></td></tr>
<tr><th id="1081">1081</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"peak.allocated"</q>);</td></tr>
<tr><th id="1082">1082</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::peak_allocated" title='redisMemOverhead::peak_allocated' data-ref="redisMemOverhead::peak_allocated">peak_allocated</a>);</td></tr>
<tr><th id="1083">1083</th><td></td></tr>
<tr><th id="1084">1084</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"total.allocated"</q>);</td></tr>
<tr><th id="1085">1085</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_allocated" title='redisMemOverhead::total_allocated' data-ref="redisMemOverhead::total_allocated">total_allocated</a>);</td></tr>
<tr><th id="1086">1086</th><td></td></tr>
<tr><th id="1087">1087</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"startup.allocated"</q>);</td></tr>
<tr><th id="1088">1088</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::startup_allocated" title='redisMemOverhead::startup_allocated' data-ref="redisMemOverhead::startup_allocated">startup_allocated</a>);</td></tr>
<tr><th id="1089">1089</th><td></td></tr>
<tr><th id="1090">1090</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"replication.backlog"</q>);</td></tr>
<tr><th id="1091">1091</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::repl_backlog" title='redisMemOverhead::repl_backlog' data-ref="redisMemOverhead::repl_backlog">repl_backlog</a>);</td></tr>
<tr><th id="1092">1092</th><td></td></tr>
<tr><th id="1093">1093</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"clients.slaves"</q>);</td></tr>
<tr><th id="1094">1094</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::clients_slaves" title='redisMemOverhead::clients_slaves' data-ref="redisMemOverhead::clients_slaves">clients_slaves</a>);</td></tr>
<tr><th id="1095">1095</th><td></td></tr>
<tr><th id="1096">1096</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"clients.normal"</q>);</td></tr>
<tr><th id="1097">1097</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::clients_normal" title='redisMemOverhead::clients_normal' data-ref="redisMemOverhead::clients_normal">clients_normal</a>);</td></tr>
<tr><th id="1098">1098</th><td></td></tr>
<tr><th id="1099">1099</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"aof.buffer"</q>);</td></tr>
<tr><th id="1100">1100</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::aof_buffer" title='redisMemOverhead::aof_buffer' data-ref="redisMemOverhead::aof_buffer">aof_buffer</a>);</td></tr>
<tr><th id="1101">1101</th><td></td></tr>
<tr><th id="1102">1102</th><td>        <b>for</b> (<span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col5 decl" id="175j" title='j' data-type='size_t' data-ref="175j">j</dfn> = <var>0</var>; <a class="local col5 ref" href="#175j" title='j' data-ref="175j">j</a> &lt; <a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::num_dbs" title='redisMemOverhead::num_dbs' data-ref="redisMemOverhead::num_dbs">num_dbs</a>; <a class="local col5 ref" href="#175j" title='j' data-ref="175j">j</a>++) {</td></tr>
<tr><th id="1103">1103</th><td>            <em>char</em> <dfn class="local col6 decl" id="176dbname" title='dbname' data-type='char [32]' data-ref="176dbname">dbname</dfn>[<var>32</var>];</td></tr>
<tr><th id="1104">1104</th><td>            <a class="ref" href="../../include/stdio.h.html#snprintf" title='snprintf' data-ref="snprintf">snprintf</a>(<a class="local col6 ref" href="#176dbname" title='dbname' data-ref="176dbname">dbname</a>,<b>sizeof</b>(<a class="local col6 ref" href="#176dbname" title='dbname' data-ref="176dbname">dbname</a>),<q>"db.%zd"</q>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<a class="local col5 ref" href="#175j" title='j' data-ref="175j">j</a>].<a class="ref" href="server.h.html#redisMemOverhead::(anonymous)::dbid" title='redisMemOverhead::(anonymous struct)::dbid' data-ref="redisMemOverhead::(anonymous)::dbid">dbid</a>);</td></tr>
<tr><th id="1105">1105</th><td>            <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col6 ref" href="#176dbname" title='dbname' data-ref="176dbname">dbname</a>);</td></tr>
<tr><th id="1106">1106</th><td>            <a class="ref" href="server.h.html#addReplyMultiBulkLen" title='addReplyMultiBulkLen' data-ref="addReplyMultiBulkLen">addReplyMultiBulkLen</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<var>4</var>);</td></tr>
<tr><th id="1107">1107</th><td></td></tr>
<tr><th id="1108">1108</th><td>            <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"overhead.hashtable.main"</q>);</td></tr>
<tr><th id="1109">1109</th><td>            <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<a class="local col5 ref" href="#175j" title='j' data-ref="175j">j</a>].<a class="ref" href="server.h.html#redisMemOverhead::(anonymous)::overhead_ht_main" title='redisMemOverhead::(anonymous struct)::overhead_ht_main' data-ref="redisMemOverhead::(anonymous)::overhead_ht_main">overhead_ht_main</a>);</td></tr>
<tr><th id="1110">1110</th><td></td></tr>
<tr><th id="1111">1111</th><td>            <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"overhead.hashtable.expires"</q>);</td></tr>
<tr><th id="1112">1112</th><td>            <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::db" title='redisMemOverhead::db' data-ref="redisMemOverhead::db">db</a>[<a class="local col5 ref" href="#175j" title='j' data-ref="175j">j</a>].<a class="ref" href="server.h.html#redisMemOverhead::(anonymous)::overhead_ht_expires" title='redisMemOverhead::(anonymous struct)::overhead_ht_expires' data-ref="redisMemOverhead::(anonymous)::overhead_ht_expires">overhead_ht_expires</a>);</td></tr>
<tr><th id="1113">1113</th><td>        }</td></tr>
<tr><th id="1114">1114</th><td></td></tr>
<tr><th id="1115">1115</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"overhead.total"</q>);</td></tr>
<tr><th id="1116">1116</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::overhead_total" title='redisMemOverhead::overhead_total' data-ref="redisMemOverhead::overhead_total">overhead_total</a>);</td></tr>
<tr><th id="1117">1117</th><td></td></tr>
<tr><th id="1118">1118</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"keys.count"</q>);</td></tr>
<tr><th id="1119">1119</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::total_keys" title='redisMemOverhead::total_keys' data-ref="redisMemOverhead::total_keys">total_keys</a>);</td></tr>
<tr><th id="1120">1120</th><td></td></tr>
<tr><th id="1121">1121</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"keys.bytes-per-key"</q>);</td></tr>
<tr><th id="1122">1122</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::bytes_per_key" title='redisMemOverhead::bytes_per_key' data-ref="redisMemOverhead::bytes_per_key">bytes_per_key</a>);</td></tr>
<tr><th id="1123">1123</th><td></td></tr>
<tr><th id="1124">1124</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"dataset.bytes"</q>);</td></tr>
<tr><th id="1125">1125</th><td>        <a class="ref" href="server.h.html#addReplyLongLong" title='addReplyLongLong' data-ref="addReplyLongLong">addReplyLongLong</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::dataset" title='redisMemOverhead::dataset' data-ref="redisMemOverhead::dataset">dataset</a>);</td></tr>
<tr><th id="1126">1126</th><td></td></tr>
<tr><th id="1127">1127</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"dataset.percentage"</q>);</td></tr>
<tr><th id="1128">1128</th><td>        <a class="ref" href="server.h.html#addReplyDouble" title='addReplyDouble' data-ref="addReplyDouble">addReplyDouble</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::dataset_perc" title='redisMemOverhead::dataset_perc' data-ref="redisMemOverhead::dataset_perc">dataset_perc</a>);</td></tr>
<tr><th id="1129">1129</th><td></td></tr>
<tr><th id="1130">1130</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"peak.percentage"</q>);</td></tr>
<tr><th id="1131">1131</th><td>        <a class="ref" href="server.h.html#addReplyDouble" title='addReplyDouble' data-ref="addReplyDouble">addReplyDouble</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::peak_perc" title='redisMemOverhead::peak_perc' data-ref="redisMemOverhead::peak_perc">peak_perc</a>);</td></tr>
<tr><th id="1132">1132</th><td></td></tr>
<tr><th id="1133">1133</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"fragmentation"</q>);</td></tr>
<tr><th id="1134">1134</th><td>        <a class="ref" href="server.h.html#addReplyDouble" title='addReplyDouble' data-ref="addReplyDouble">addReplyDouble</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>-&gt;<a class="ref" href="server.h.html#redisMemOverhead::fragmentation" title='redisMemOverhead::fragmentation' data-ref="redisMemOverhead::fragmentation">fragmentation</a>);</td></tr>
<tr><th id="1135">1135</th><td></td></tr>
<tr><th id="1136">1136</th><td>        <a class="ref" href="#freeMemoryOverheadData" title='freeMemoryOverheadData' data-ref="freeMemoryOverheadData">freeMemoryOverheadData</a>(<a class="local col4 ref" href="#174mh" title='mh' data-ref="174mh">mh</a>);</td></tr>
<tr><th id="1137">1137</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"malloc-stats"</q>) &amp;&amp; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>2</var>) {</td></tr>
<tr><th id="1138">1138</th><td><u>#<span data-ppcond="1138">if</span> defined(<span class="macro" data-ref="_M/USE_JEMALLOC">USE_JEMALLOC</span>)</u></td></tr>
<tr><th id="1139">1139</th><td>        <a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="local col7 decl" id="177info" title='info' data-type='sds' data-ref="177info">info</dfn> = <a class="ref" href="sds.h.html#sdsempty" title='sdsempty' data-ref="sdsempty">sdsempty</a>();</td></tr>
<tr><th id="1140">1140</th><td>        <a class="ref" href="../deps/jemalloc/include/jemalloc/jemalloc.h.html#231" title='je_malloc_stats_print' data-ref="je_malloc_stats_print">je_malloc_stats_print</a>(<a class="ref" href="#inputCatSds" title='inputCatSds' data-ref="inputCatSds">inputCatSds</a>, &amp;<a class="local col7 ref" href="#177info" title='info' data-ref="177info">info</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="1141">1141</th><td>        <a class="ref" href="server.h.html#addReplyBulkSds" title='addReplyBulkSds' data-ref="addReplyBulkSds">addReplyBulkSds</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>, <a class="local col7 ref" href="#177info" title='info' data-ref="177info">info</a>);</td></tr>
<tr><th id="1142">1142</th><td><u>#<span data-ppcond="1138">else</span></u></td></tr>
<tr><th id="1143">1143</th><td>        addReplyBulkCString(c,<q>"Stats not supported for the current allocator"</q>);</td></tr>
<tr><th id="1144">1144</th><td><u>#<span data-ppcond="1138">endif</span></u></td></tr>
<tr><th id="1145">1145</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"doctor"</q>) &amp;&amp; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>2</var>) {</td></tr>
<tr><th id="1146">1146</th><td>        <a class="typedef" href="sds.h.html#sds" title='sds' data-type='char *' data-ref="sds">sds</a> <dfn class="local col8 decl" id="178report" title='report' data-type='sds' data-ref="178report">report</dfn> = <a class="ref" href="#getMemoryDoctorReport" title='getMemoryDoctorReport' data-ref="getMemoryDoctorReport">getMemoryDoctorReport</a>();</td></tr>
<tr><th id="1147">1147</th><td>        <a class="ref" href="server.h.html#addReplyBulkSds" title='addReplyBulkSds' data-ref="addReplyBulkSds">addReplyBulkSds</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<a class="local col8 ref" href="#178report" title='report' data-ref="178report">report</a>);</td></tr>
<tr><th id="1148">1148</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"purge"</q>) &amp;&amp; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>2</var>) {</td></tr>
<tr><th id="1149">1149</th><td><u>#<span data-ppcond="1149">if</span> defined(<span class="macro" data-ref="_M/USE_JEMALLOC">USE_JEMALLOC</span>)</u></td></tr>
<tr><th id="1150">1150</th><td>        <em>char</em> <dfn class="local col9 decl" id="179tmp" title='tmp' data-type='char [32]' data-ref="179tmp">tmp</dfn>[<var>32</var>];</td></tr>
<tr><th id="1151">1151</th><td>        <em>unsigned</em> <dfn class="local col0 decl" id="180narenas" title='narenas' data-type='unsigned int' data-ref="180narenas">narenas</dfn> = <var>0</var>;</td></tr>
<tr><th id="1152">1152</th><td>        <span class='typedef' title='size_t' data-type='unsigned long' data-ref="size_t">size_t</span> <dfn class="local col1 decl" id="181sz" title='sz' data-type='size_t' data-ref="181sz">sz</dfn> = <b>sizeof</b>(<em>unsigned</em>);</td></tr>
<tr><th id="1153">1153</th><td>        <b>if</b> (!<a class="ref" href="../deps/jemalloc/include/jemalloc/jemalloc.h.html#225" title='je_mallctl' data-ref="je_mallctl">je_mallctl</a>(<q>"arenas.narenas"</q>, &amp;<a class="local col0 ref" href="#180narenas" title='narenas' data-ref="180narenas">narenas</a>, &amp;<a class="local col1 ref" href="#181sz" title='sz' data-ref="181sz">sz</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>)) {</td></tr>
<tr><th id="1154">1154</th><td>            <a class="ref" href="../../include/stdio.h.html#sprintf" title='sprintf' data-ref="sprintf">sprintf</a>(<a class="local col9 ref" href="#179tmp" title='tmp' data-ref="179tmp">tmp</a>, <q>"arena.%d.purge"</q>, <a class="local col0 ref" href="#180narenas" title='narenas' data-ref="180narenas">narenas</a>);</td></tr>
<tr><th id="1155">1155</th><td>            <b>if</b> (!<a class="ref" href="../deps/jemalloc/include/jemalloc/jemalloc.h.html#225" title='je_mallctl' data-ref="je_mallctl">je_mallctl</a>(<a class="local col9 ref" href="#179tmp" title='tmp' data-ref="179tmp">tmp</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>)) {</td></tr>
<tr><th id="1156">1156</th><td>                <a class="ref" href="server.h.html#addReply" title='addReply' data-ref="addReply">addReply</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>, <a class="ref" href="server.h.html#shared" title='shared' data-ref="shared">shared</a>.<a class="ref" href="server.h.html#sharedObjectsStruct::ok" title='sharedObjectsStruct::ok' data-ref="sharedObjectsStruct::ok">ok</a>);</td></tr>
<tr><th id="1157">1157</th><td>                <b>return</b>;</td></tr>
<tr><th id="1158">1158</th><td>            }</td></tr>
<tr><th id="1159">1159</th><td>        }</td></tr>
<tr><th id="1160">1160</th><td>        <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>, <q>"Error purging dirty pages"</q>);</td></tr>
<tr><th id="1161">1161</th><td><u>#<span data-ppcond="1149">else</span></u></td></tr>
<tr><th id="1162">1162</th><td>        addReply(c, shared.ok);</td></tr>
<tr><th id="1163">1163</th><td>        <i>/* Nothing to do for other allocators. */</i></td></tr>
<tr><th id="1164">1164</th><td><u>#<span data-ppcond="1149">endif</span></u></td></tr>
<tr><th id="1165">1165</th><td>    } <b>else</b> <b>if</b> (!<a class="ref" href="../../include/string.h.html#strcasecmp" title='strcasecmp' data-ref="strcasecmp">strcasecmp</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argv" title='client::argv' data-ref="client::argv">argv</a>[<var>1</var>]-&gt;<a class="ref" href="server.h.html#redisObject::ptr" title='redisObject::ptr' data-ref="redisObject::ptr">ptr</a>,<q>"help"</q>) &amp;&amp; <a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>-&gt;<a class="ref" href="server.h.html#client::argc" title='client::argc' data-ref="client::argc">argc</a> == <var>2</var>) {</td></tr>
<tr><th id="1166">1166</th><td>        <a class="ref" href="server.h.html#addReplyMultiBulkLen" title='addReplyMultiBulkLen' data-ref="addReplyMultiBulkLen">addReplyMultiBulkLen</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<var>5</var>);</td></tr>
<tr><th id="1167">1167</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,</td></tr>
<tr><th id="1168">1168</th><td><q>"MEMORY DOCTOR                        - Outputs memory problems report"</q>);</td></tr>
<tr><th id="1169">1169</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,</td></tr>
<tr><th id="1170">1170</th><td><q>"MEMORY USAGE &lt;key&gt; [SAMPLES &lt;count&gt;] - Estimate memory usage of key"</q>);</td></tr>
<tr><th id="1171">1171</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,</td></tr>
<tr><th id="1172">1172</th><td><q>"MEMORY STATS                         - Show memory usage details"</q>);</td></tr>
<tr><th id="1173">1173</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,</td></tr>
<tr><th id="1174">1174</th><td><q>"MEMORY PURGE                         - Ask the allocator to release memory"</q>);</td></tr>
<tr><th id="1175">1175</th><td>        <a class="ref" href="server.h.html#addReplyBulkCString" title='addReplyBulkCString' data-ref="addReplyBulkCString">addReplyBulkCString</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,</td></tr>
<tr><th id="1176">1176</th><td><q>"MEMORY MALLOC-STATS                  - Show allocator internal stats"</q>);</td></tr>
<tr><th id="1177">1177</th><td>    } <b>else</b> {</td></tr>
<tr><th id="1178">1178</th><td>        <a class="ref" href="server.h.html#addReplyError" title='addReplyError' data-ref="addReplyError">addReplyError</a>(<a class="local col9 ref" href="#169c" title='c' data-ref="169c">c</a>,<q>"Syntax error. Try MEMORY HELP"</q>);</td></tr>
<tr><th id="1179">1179</th><td>    }</td></tr>
<tr><th id="1180">1180</th><td>}</td></tr>
<tr><th id="1181">1181</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2017-Oct-16</em> from project codebrowser revision <em>with-deprecated-diskstore-4466-g2bf8c2c</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
